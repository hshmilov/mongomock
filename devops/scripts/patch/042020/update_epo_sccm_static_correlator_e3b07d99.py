#!/home/ubuntu/cortex/venv/bin/python

import sys
import subprocess
import base64
import os

from testing.services.plugins import core_service

CORTEX = '/home/ubuntu/cortex'
FILES_TO_UPDATE = {
    f'{CORTEX}/adapters/epo_adapter/service.py': b'aW1wb3J0IGlwYWRkcmVzcwppbXBvcnQganNvbgppbXBvcnQgbG9nZ2luZwpmcm9tIHVybGxpYjMudXRpbC51cmwgaW1wb3J0IHBhcnNlX3VybAoKCmZyb20gYXhvbml1cy5hZGFwdGVyX2Jhc2UgaW1wb3J0IEFkYXB0ZXJCYXNlLCBBZGFwdGVyUHJvcGVydHkKZnJvbSBheG9uaXVzLmFkYXB0ZXJfZXhjZXB0aW9ucyBpbXBvcnQgQ2xpZW50Q29ubmVjdGlvbkV4Y2VwdGlvbgpmcm9tIGF4b25pdXMuY2xpZW50cy5yZXN0LmNvbm5lY3Rpb24gaW1wb3J0IFJFU1RDb25uZWN0aW9uCmZyb20gYXhvbml1cy5kZXZpY2VzLmRldmljZV9hZGFwdGVyIGltcG9ydCBEZXZpY2VBZGFwdGVyLCBBR0VOVF9OQU1FUwpmcm9tIGF4b25pdXMubWl4aW5zLmNvbmZpZ3VyYWJsZSBpbXBvcnQgQ29uZmlndXJhYmxlCmZyb20gYXhvbml1cy5maWVsZHMgaW1wb3J0IEZpZWxkLCBMaXN0RmllbGQKZnJvbSBheG9uaXVzLnV0aWxzLmRhdGV0aW1lIGltcG9ydCBwYXJzZV9kYXRlCmZyb20gYXhvbml1cy51dGlscy5maWxlcyBpbXBvcnQgZ2V0X2xvY2FsX2NvbmZpZ19maWxlCmZyb20gYXhvbml1cy51dGlscy5wYXJzaW5nIGltcG9ydCBpc19ob3N0bmFtZV92YWxpZCwgZm9ybWF0X21hYywgaXNfdmFsaWRfaXAsIGlzX2RvbWFpbl92YWxpZCwgaXNfdmFsaWRfaXB2Ngpmcm9tIGVwb19hZGFwdGVyLm1jYWZlZSBpbXBvcnQgY2xpZW50Cgpsb2dnZXIgPSBsb2dnaW5nLmdldExvZ2dlcihmJ2F4b25pdXMue19fbmFtZV9ffScpCgoKRVBPX0hPU1QgPSAnaG9zdCcKRVBPX1BPUlQgPSAncG9ydCcKUEFTUyA9ICdwYXNzd29yZCcKVVNFUiA9ICd1c2VyJwoKTEVBRl9OT0RFX1RBQkxFID0gJ0VQT0xlYWZOb2RlJwoKCmRlZiBnZXRfYWxsX2xpbmtlZF90YWJsZXModGFibGUpOgogICAgIiIiCiAgICA6cGFyYW0gdGFibGU6IHRhYmxlIGRhdGEKICAgIDpyZXR1cm46IGxpc3Qgb2YgdGFibGVzIGxpbmtlZCBieSBhIGZvcmVpZ24ga2V5CiAgICAiIiIKICAgIGJ5X2xpbmVzID0gdGFibGVbJ2ZvcmVpZ25LZXlzJ10uc3RyaXAoKS5zcGxpdCgiXG4iKVsyOl0KICAgIGZvcmVpZ25fdGFibGVzID0gW2xpbmUuc3BsaXQoKVsyXSBmb3IgbGluZSBpbiBieV9saW5lc10KICAgIGFsbF9saW5rZWRfdGFibGVzID0gIiwiLmpvaW4oZm9yZWlnbl90YWJsZXMpCiAgICByZXR1cm4gYWxsX2xpbmtlZF90YWJsZXMKCgpkZWYgcGFyc2VfbmV0d29yayhkZXZpY2VfcmF3LCBkZXZpY2UsIGV4Y2x1ZGVfaXB2Nj1GYWxzZSk6CiAgICBtYWMgPSAnJwogICAgaXBfbGlzdCA9IHNldCgpCgogICAgcmF3X2lwdjQgPSBkZXZpY2VfcmF3LmdldCgnRVBPQ29tcHV0ZXJQcm9wZXJ0aWVzLklQVjR4JykKICAgIHBhcnNlZF9pcHY0ID0gTm9uZQogICAgdHJ5OgogICAgICAgICMgZXBvIGlzIGEgbW90aGVyZnVja2VyPyBTZWVtcyBsaWtlIGhlIGZsaXBzIHRoZSBtc2Igb2YgdGhlIGJpbmFyeSByZXByIG9mIGlwIGFkZHIuLi4KICAgICAgICBpZiByYXdfaXB2NCBpcyBub3QgTm9uZToKICAgICAgICAgICAgaXB2NCA9IChyYXdfaXB2NCAmIDB4ZmZmZmZmZmYpIF4gMHg4MDAwMDAwMAogICAgICAgICAgICBwYXJzZWRfaXB2NCA9IHN0cihpcGFkZHJlc3MuSVB2NEFkZHJlc3MoaXB2NCkpCiAgICAgICAgICAgIGlwX2xpc3QuYWRkKHBhcnNlZF9pcHY0KQogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICBsb2dnZXIuaW5mbyhmIkVycm9yIHJlYWRpbmcgSVB2NCB7cmF3X2lwdjR9IikKCiAgICByYXdfaXB2NiA9IGRldmljZV9yYXcuZ2V0KCdFUE9Db21wdXRlclByb3BlcnRpZXMuSVBWNicpCiAgICBpZiBpc192YWxpZF9pcChyYXdfaXB2NikgYW5kIHJhd19pcHY2IGlzIG5vdCBOb25lOgogICAgICAgIGlwX2xpc3QuYWRkKHJhd19pcHY2Lmxvd2VyKCkpCgogICAgdHJ5OgogICAgICAgIGlwdjRtYXBwZWQgPSBpcGFkZHJlc3MuSVB2NkFkZHJlc3MocmF3X2lwdjYpLmlwdjRfbWFwcGVkIGlmIGlzX3ZhbGlkX2lwKHJhd19pcHY2KSBlbHNlIE5vbmUKICAgICAgICBpZiBpcHY0bWFwcGVkIGFuZCBzdHIoaXB2NG1hcHBlZCkgIT0gcGFyc2VkX2lwdjQ6CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKAogICAgICAgICAgICAgICAgZiJpcHY0LzYgbWlzbWF0Y2g6IHJhdzQ9e3Jhd19pcHY0fSByYXc2PXtyYXdfaXB2Nn0gcGFyc2VkND17cGFyc2VkX2lwdjR9IGlwNC02bWFwcGVkPXtpcHY0bWFwcGVkfSIpCiAgICAgICAgICAgIGlmIGlwdjRtYXBwZWQ6CiAgICAgICAgICAgICAgICAjIGVwbydzIGlwdjQgcmVwb3J0aW5nIGlzIHByb2JsZW1hdGljLgogICAgICAgICAgICAgICAgIyBCdXQgd2Ugbm90aWNlZCB0aGF0IG1hcHBlZCBpcHY2IGFkZHJlc3NlcyB0ZW5kIHRvIGhhdmUgdGhlIGNvcnJlY3QgdmFsdWUKICAgICAgICAgICAgICAgICMgSW4gc3VjaCBhIGNhc2Ugd2UgYWRkIHRoZSBtYXBwZWQgaXB2NCBhZGRyZXNzCiAgICAgICAgICAgICAgICBpcF9saXN0LmFkZChzdHIoaXB2NG1hcHBlZCkpCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgIGxvZ2dlci53YXJuaW5nKGYiRmFpbGVkIHRvIHBvcHVsYXRlIHBvcHVsYXRlIGlwdjQvNiBhZGRyZXNzIHJhd19pcHY0PXtyYXdfaXB2NH0gcmF3X2lwdjY9e3Jhd19pcHY2fSIpCgogICAgcmF3X21hYyA9IGRldmljZV9yYXcuZ2V0KCdFUE9Db21wdXRlclByb3BlcnRpZXMuTmV0QWRkcmVzcycpCiAgICB0cnk6CiAgICAgICAgbWFjID0gZm9ybWF0X21hYyhyYXdfbWFjKQogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICBsb2dnZXIuaW5mbyhmIkZhaWxlZCBmb3JtYXR0aW5nIHtyYXdfbWFjfSIpCgogICAgaXBzID0gbGlzdChpcF9saXN0KQogICAgaWYgZXhjbHVkZV9pcHY2OgogICAgICAgIGlwcyA9IFtpcCBmb3IgaXAgaW4gaXBzIGlmIG5vdCBpc192YWxpZF9pcHY2KGlwKV0KICAgIGRldmljZS5hZGRfbmljKG1hYywgaXBzKQoKCmNsYXNzIEVwb0FkYXB0ZXIoQWRhcHRlckJhc2UsIENvbmZpZ3VyYWJsZSk6CiAgICAiIiIKICAgIENvbm5lY3RzIGF4b25pdXMgdG8gbWNhZmVlIGVwbwogICAgIiIiCgogICAgY2xhc3MgTXlEZXZpY2VBZGFwdGVyKERldmljZUFkYXB0ZXIpOgogICAgICAgIGVwb19wcm9kdWN0cyA9IExpc3RGaWVsZChzdHIsICJFUE8gUHJvZHVjdHMiKQogICAgICAgIG5vZGVfbmFtZSA9IEZpZWxkKHN0ciwgJ05vZGUgTmFtZScpCiAgICAgICAgZXBvX3RhZ3MgPSBMaXN0RmllbGQoc3RyLCAnRVBPIFRhZ3MnKQogICAgICAgIGVwb19ob3N0ID0gRmllbGQoc3RyLCAnRVBPIEhvc3QnKQogICAgICAgIG5vZGVfdGV4dF9wYXRoID0gRmllbGQoc3RyLCAnTm9kZSBUZXh0IFBhdGgnKQoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCAqYXJncywgKiprd2FyZ3MpOgogICAgICAgIHN1cGVyKCkuX19pbml0X18oY29uZmlnX2ZpbGVfcGF0aD1nZXRfbG9jYWxfY29uZmlnX2ZpbGUoX19maWxlX18pLCAqYXJncywgKiprd2FyZ3MpCgogICAgZGVmIF9jbGllbnRzX3NjaGVtYShzZWxmKToKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiaXRlbXMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiBFUE9fSE9TVCwKICAgICAgICAgICAgICAgICAgICAidGl0bGUiOiAiSG9zdCIsCiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAic3RyaW5nIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibmFtZSI6IEVQT19QT1JULAogICAgICAgICAgICAgICAgICAgICJ0aXRsZSI6ICJQb3J0IiwKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJudW1iZXIiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJuYW1lIjogVVNFUiwKICAgICAgICAgICAgICAgICAgICAidGl0bGUiOiAiVXNlciIsCiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAic3RyaW5nIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibmFtZSI6IFBBU1MsCiAgICAgICAgICAgICAgICAgICAgInRpdGxlIjogIlBhc3N3b3JkIiwKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJzdHJpbmciLAogICAgICAgICAgICAgICAgICAgICJmb3JtYXQiOiAicGFzc3dvcmQiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJyZXF1aXJlZCI6IFsKICAgICAgICAgICAgICAgIEVQT19QT1JULAogICAgICAgICAgICAgICAgRVBPX0hPU1QsCiAgICAgICAgICAgICAgICBQQVNTLAogICAgICAgICAgICAgICAgVVNFUgogICAgICAgICAgICBdLAogICAgICAgICAgICAidHlwZSI6ICJhcnJheSIKICAgICAgICB9CgogICAgZGVmIF9wYXJzZV9yYXdfZGF0YShzZWxmLCBkZXZpY2VzX3Jhd19kYXRhKToKICAgICAgICBpZiBkZXZpY2VzX3Jhd19kYXRhIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIGRldmljZXNfcmF3X2RhdGFfanNvbiwgZXBvX2hvc3QgPSBkZXZpY2VzX3Jhd19kYXRhCiAgICAgICAgZm9yIGRldmljZV9yYXcgaW4ganNvbi5sb2FkcyhkZXZpY2VzX3Jhd19kYXRhX2pzb24pOgogICAgICAgICAgICBlcG9faWQgPSBkZXZpY2VfcmF3LmdldCgnRVBPTGVhZk5vZGUuQWdlbnRHVUlEJykKICAgICAgICAgICAgaWYgZXBvX2lkIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAjIHNraXBwaW5nIGRldmljZXMgd2l0aG91dCBBZ2VudC1JRAogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIG5hbWUgPSBkZXZpY2VfcmF3LmdldCgnRVBPQ29tcHV0ZXJQcm9wZXJ0aWVzLkNvbXB1dGVyTmFtZScpCiAgICAgICAgICAgIGlmIG5vdCBpc19ob3N0bmFtZV92YWxpZChuYW1lKToKICAgICAgICAgICAgICAgIG5hbWUgPSBOb25lCiAgICAgICAgICAgIGhvc3RuYW1lID0gZGV2aWNlX3Jhdy5nZXQoJ0VQT0NvbXB1dGVyUHJvcGVydGllcy5JUEhvc3ROYW1lJykKICAgICAgICAgICAgaWYgbm90IGlzX2hvc3RuYW1lX3ZhbGlkKGhvc3RuYW1lKToKICAgICAgICAgICAgICAgIGhvc3RuYW1lID0gZGV2aWNlX3Jhdy5nZXQoJ0VQT0NvbXB1dGVyUHJvcGVydGllcy5Db21wdXRlck5hbWUnKQogICAgICAgICAgICBpZiBzdHIoaG9zdG5hbWUpLmxvd2VyKCkuZW5kc3dpdGgoJy5sb2NhbCcpIGFuZCBcCiAgICAgICAgICAgICAgICAgICAgKCdkYz1sb2NhbCcgbm90IGluICgoZGV2aWNlX3Jhdy5nZXQoJ0VQT0NvbXB1dGVyTGRhcFByb3BlcnRpZXMuTGRhcE9yZ1VuaXQnKSBvciAnJykubG93ZXIoKSkpOgogICAgICAgICAgICAgICAgaG9zdG5hbWUgPSBzdHIoaG9zdG5hbWUpWzotbGVuKCcubG9jYWwnKV0KICAgICAgICAgICAgaWYgIk1hYyBPUyBYIiBpbiBzdHIoZGV2aWNlX3Jhdy5nZXQoJ0VQT0xlYWZOb2RlLm9zJywgJycpKSBhbmQgc3RyKGhvc3RuYW1lKS5zdHJpcCgpLmxvd2VyKCkgPT0gJ2xvY2FsaG9zdCc6CiAgICAgICAgICAgICAgICBob3N0bmFtZSA9IE5vbmUKCiAgICAgICAgICAgIGlmICdFUE9MZWFmTm9kZS5MYXN0VXBkYXRlJyBub3QgaW4gZGV2aWNlX3JhdzoKICAgICAgICAgICAgICAgICMgTm8gZGF0ZSBmb3IgdGhpcyBkZXZpY2UsIHdlIGRvbid0IHdhbnQgdG8gZW50ZXIgZGV2aWNlcyB3aXRoIG5vIGRhdGUgc28gY29udGludWluZy4KICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiRm91bmQgZGV2aWNlIHdpdGggbm8gZGF0ZS4gTm90IGluc2VydGluZyB0byBkYi4gZGV2aWNlIG5hbWU6IHtob3N0bmFtZX0iKQogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIGRldmljZSA9IHNlbGYuX25ld19kZXZpY2VfYWRhcHRlcigpCiAgICAgICAgICAgIGRldmljZS5lcG9faG9zdCA9IGVwb19ob3N0CiAgICAgICAgICAgIGlmIGhvc3RuYW1lIGFuZCBob3N0bmFtZS5lbmRzd2l0aCgnOjoxJyk6CiAgICAgICAgICAgICAgICBob3N0bmFtZSA9IGhvc3RuYW1lWzotbGVuKCc6OjEnKV0KICAgICAgICAgICAgZGV2aWNlLmhvc3RuYW1lID0gaG9zdG5hbWUKICAgICAgICAgICAgZGV2aWNlLm5hbWUgPSBuYW1lCiAgICAgICAgICAgIGRldmljZS5maWd1cmVfb3MoZGV2aWNlX3Jhdy5nZXQoJ0VQT0xlYWZOb2RlLm9zJywgJycpKQogICAgICAgICAgICBkZXZpY2Uub3MuYml0bmVzcyA9IDY0IGlmIGRldmljZV9yYXcuZ2V0KCdFUE9Db21wdXRlclByb3BlcnRpZXMuT1NCaXRNb2RlJywgJycpID09IDEgZWxzZSAzMgogICAgICAgICAgICAjIEkgdGhpbmsgdGhhdCB3ZSBnZXQgZVBPIGR1cGxpY2F0aW9ucyBhbHNvIGluIHRoZSBmaWVsZAogICAgICAgICAgICBkZXZpY2UuaWQgPSBlcG9faWQgKyAoaG9zdG5hbWUgaWYgaG9zdG5hbWUgZWxzZSAnJykKICAgICAgICAgICAgcGFyc2VfbmV0d29yayhkZXZpY2VfcmF3LCBkZXZpY2UsIGV4Y2x1ZGVfaXB2Nj1zZWxmLl9fZXhjbHVkZV9pcHY2KQogICAgICAgICAgICBsYXN0X3NlZW4gPSBwYXJzZV9kYXRlKGRldmljZV9yYXdbJ0VQT0xlYWZOb2RlLkxhc3RVcGRhdGUnXSkKICAgICAgICAgICAgaWYgbGFzdF9zZWVuOgogICAgICAgICAgICAgICAgZGV2aWNlLmxhc3Rfc2VlbiA9IGxhc3Rfc2VlbgoKICAgICAgICAgICAgZG9tYWluID0gZGV2aWNlX3Jhdy5nZXQoIkVQT0NvbXB1dGVyUHJvcGVydGllcy5Eb21haW5OYW1lIikKICAgICAgICAgICAgaWYgaXNfZG9tYWluX3ZhbGlkKGRvbWFpbik6CiAgICAgICAgICAgICAgICBkZXZpY2UuZG9tYWluID0gZG9tYWluCiAgICAgICAgICAgICAgICBkZXZpY2UucGFydF9vZl9kb21haW4gPSBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBkZXZpY2UucGFydF9vZl9kb21haW4gPSBGYWxzZQogICAgICAgICAgICBkZXZpY2UuYWRkX2FnZW50X3ZlcnNpb24oYWdlbnQ9QUdFTlRfTkFNRVMuZXBvLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbj1kZXZpY2VfcmF3LmdldCgiRVBPTGVhZk5vZGUuQWdlbnRWZXJzaW9uIikpCgogICAgICAgICAgICAjIFRPRE86IFVuZGVyc3RhbmQgaWYgdGhlIG5leHQgbGluZSBpcyBhbHdheXMgaW5jbHVkZWQgaW4gaG9zdG5hbWUuIERvIHdlIG5lZWQgaXQ/CiAgICAgICAgICAgICMgZGV2aWNlLmNvbXB1dGVyX25hbWUgPSBkZXZpY2VfcmF3LmdldCgiRVBPQ29tcHV0ZXJQcm9wZXJ0aWVzLkNvbXB1dGVyTmFtZSIpCgogICAgICAgICAgICAjIFRoZSBuZXh0IHRoaW5nLCBpJ20gYWZyYWlkLCBjb3VsZCBnbyBiYWQKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBTZXQgdXAgZXBvIHByb2R1Y3RzCiAgICAgICAgICAgICAgICBmb3IgcHJvZHVjdCBpbiAoZGV2aWNlX3Jhdy5nZXQoIkVQT1Byb2R1Y3RQcm9wZXJ0eVByb2R1Y3RzLlByb2R1Y3RzIikgb3IgJycpLnNwbGl0KCIsICIpOgogICAgICAgICAgICAgICAgICAgIGRldmljZS5lcG9fcHJvZHVjdHMuYXBwZW5kKHByb2R1Y3QpCgogICAgICAgICAgICAgICAgIyBTZXQgdXAgb3MgdmVyc2lvbgogICAgICAgICAgICAgICAgb3NfdmVyc2lvbiA9IGRldmljZV9yYXcuZ2V0KCJFUE9Db21wdXRlclByb3BlcnRpZXMuT1NWZXJzaW9uIikKICAgICAgICAgICAgICAgIGlmIG9zX3ZlcnNpb246CiAgICAgICAgICAgICAgICAgICAgbWFqb3IsICptaW5vciA9IG9zX3ZlcnNpb24uc3BsaXQoIi4iKQogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlLm9zLm1ham9yID0gaW50KG1ham9yKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4obWlub3IpID4gMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5vcy5taW5vciA9IGludChtaW5vclswXSkKICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgICAgICAgICAgb3NfYnVpbGRfbnVtID0gZGV2aWNlX3Jhdy5nZXQoIkVQT0NvbXB1dGVyUHJvcGVydGllcy5PU0J1aWxkTnVtIikKICAgICAgICAgICAgICAgIGlmIG9zX2J1aWxkX251bSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBkZXZpY2Uub3MuYnVpbGQgPSBzdHIob3NfYnVpbGRfbnVtKQoKICAgICAgICAgICAgICAgICMgU2V0IHVwIG1lbW9yeQogICAgICAgICAgICAgICAgaWYgZGV2aWNlX3Jhdy5nZXQoIkVQT0NvbXB1dGVyUHJvcGVydGllcy5GcmVlTWVtb3J5Iik6CiAgICAgICAgICAgICAgICAgICAgZGV2aWNlLmZyZWVfcGh5c2ljYWxfbWVtb3J5ID0gaW50KGRldmljZV9yYXcuZ2V0KCJFUE9Db21wdXRlclByb3BlcnRpZXMuRnJlZU1lbW9yeSIpKSAvICgxMDI0KiozKQogICAgICAgICAgICAgICAgaWYgZGV2aWNlX3Jhdy5nZXQoIkVQT0NvbXB1dGVyUHJvcGVydGllcy5Ub3RhbFBoeXNpY2FsTWVtb3J5Iik6CiAgICAgICAgICAgICAgICAgICAgZGV2aWNlLnRvdGFsX3BoeXNpY2FsX21lbW9yeSA9IGludChkZXZpY2VfcmF3LmdldCgKICAgICAgICAgICAgICAgICAgICAgICAgIkVQT0NvbXB1dGVyUHJvcGVydGllcy5Ub3RhbFBoeXNpY2FsTWVtb3J5IikpIC8gKDEwMjQqKjMpCgogICAgICAgICAgICAgICAgIyBTZXQgdXAgaGFyZCBkaXNrcwogICAgICAgICAgICAgICAgaWYgZGV2aWNlX3Jhdy5nZXQoIkVQT0NvbXB1dGVyUHJvcGVydGllcy5Ub3RhbERpc2tTcGFjZSIpIGFuZCBcCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZV9yYXcuZ2V0KCJFUE9Db21wdXRlclByb3BlcnRpZXMuRnJlZURpc2tTcGFjZSIpOgogICAgICAgICAgICAgICAgICAgIGRldmljZS5hZGRfaGQoCiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsX3NpemU9KGludChkZXZpY2VfcmF3LmdldCgiRVBPQ29tcHV0ZXJQcm9wZXJ0aWVzLlRvdGFsRGlza1NwYWNlIikpIC8gMTAyNCksCiAgICAgICAgICAgICAgICAgICAgICAgIGZyZWVfc2l6ZT0oaW50KGRldmljZV9yYXcuZ2V0KCJFUE9Db21wdXRlclByb3BlcnRpZXMuRnJlZURpc2tTcGFjZSIpKSAvIDEwMjQpCiAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgICMgU2V0IHVwIGNwdSdzCiAgICAgICAgICAgICAgICBpZiBkZXZpY2VfcmF3LmdldCgiRVBPQ29tcHV0ZXJQcm9wZXJ0aWVzLk51bU9mQ1BVIik6CiAgICAgICAgICAgICAgICAgICAgZGV2aWNlLnRvdGFsX251bWJlcl9vZl9jb3JlcyA9IGludChkZXZpY2VfcmF3LmdldCgiRVBPQ29tcHV0ZXJQcm9wZXJ0aWVzLk51bU9mQ1BVIikpCiAgICAgICAgICAgICAgICBpZiBkZXZpY2VfcmF3LmdldCgiRVBPQ29tcHV0ZXJQcm9wZXJ0aWVzLkNQVVNwZWVkIik6CiAgICAgICAgICAgICAgICAgICAgZGV2aWNlLmFkZF9jcHUoCiAgICAgICAgICAgICAgICAgICAgICAgIGdoej1yb3VuZChpbnQoZGV2aWNlX3Jhdy5nZXQoIkVQT0NvbXB1dGVyUHJvcGVydGllcy5DUFVTcGVlZCIpKSAvIDEwMjQsIDIpLAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lPWRldmljZV9yYXcuZ2V0KCJFUE9Db21wdXRlclByb3BlcnRpZXMuQ1BVVHlwZSIpCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgZGV2aWNlLmRlc2NyaXB0aW9uID0gZGV2aWNlX3Jhdy5nZXQoIkVQT0NvbXB1dGVyUHJvcGVydGllcy5EZXNjcmlwdGlvbiIpCiAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGRldmljZV9yYXcuZ2V0KCdFUE9Db21wdXRlclByb3BlcnRpZXMuVXNlck5hbWUnKSwgc3RyKSBhbmQgXAogICAgICAgICAgICAgICAgICAgICAgICAnTi9BJyBub3QgaW4gZGV2aWNlX3Jhdy5nZXQoJ0VQT0NvbXB1dGVyUHJvcGVydGllcy5Vc2VyTmFtZScpOgogICAgICAgICAgICAgICAgICAgIGRldmljZS5sYXN0X3VzZWRfdXNlcnMgPSAoZGV2aWNlX3Jhdy5nZXQoJ0VQT0NvbXB1dGVyUHJvcGVydGllcy5Vc2VyTmFtZScpIG9yICcnKS5zcGxpdCgnLCcpCiAgICAgICAgICAgICAgICBkZXZpY2Uubm9kZV9uYW1lID0gZGV2aWNlX3Jhdy5nZXQoJ0VQT0xlYWZOb2RlLk5vZGVOYW1lJykKICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoZGV2aWNlX3Jhdy5nZXQoJ0VQT0xlYWZOb2RlLlRhZ3MnKSwgc3RyKToKICAgICAgICAgICAgICAgICAgICBkZXZpY2UuZXBvX3RhZ3MgPSBbZXBvX3RhZy5zdHJpcCgpIGZvciBlcG9fdGFnIGluICgKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlX3Jhdy5nZXQoJ0VQT0xlYWZOb2RlLlRhZ3MnKSBvciAnJykuc3BsaXQoJywnKSBpZiBlcG9fdGFnLnN0cmlwKCldCiAgICAgICAgICAgICAgICBkZXZpY2Uubm9kZV90ZXh0X3BhdGggPSBkZXZpY2VfcmF3LmdldCgnRVBPQnJhbmNoTm9kZS5Ob2RlVGV4dFBhdGgnKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbigiQ291bGRuJ3Qgc2V0IHNvbWUgZXBvIGluZm8iKQogICAgICAgICAgICBpZiBsZW4oc3RyKGRldmljZV9yYXcpKSA8IDEwMDAwMDA6CiAgICAgICAgICAgICAgICBkZXZpY2Uuc2V0X3JhdyhkZXZpY2VfcmF3KQogICAgICAgICAgICB5aWVsZCBkZXZpY2UKCiAgICBkZWYgX3F1ZXJ5X2RldmljZXNfYnlfY2xpZW50KHNlbGYsIGNsaWVudF9uYW1lLCBjbGllbnRfZGF0YSk6CiAgICAgICAgbWMgPSBjbGllbnQocGFyc2VfdXJsKGNsaWVudF9kYXRhW0VQT19IT1NUXSkuaG9zdCwgY2xpZW50X2RhdGFbRVBPX1BPUlRdLAogICAgICAgICAgICAgICAgICAgIGNsaWVudF9kYXRhW1VTRVJdLCBjbGllbnRfZGF0YVtQQVNTXSkKCiAgICAgICAgdHJ5OgogICAgICAgICAgICB0YWJsZSA9IG1jLnJ1bigiY29yZS5saXN0VGFibGVzIiwgdGFibGU9TEVBRl9OT0RFX1RBQkxFKQoKICAgICAgICAgICAgYWxsX2xpbmtlZF90YWJsZXMgPSBnZXRfYWxsX2xpbmtlZF90YWJsZXModGFibGUpCiAgICAgICAgICAgICMgYWxsIGRldmljZXMgYXJlIGZldGNoZWQgYXQgb25jZSBzbyBubyBwcm9ncmVzcyBpcyBsb2dnZWQKICAgICAgICAgICAgcmF3ID0gbWMucnVuKCJjb3JlLmV4ZWN1dGVRdWVyeSIsIHRhcmdldD1MRUFGX05PREVfVEFCTEUsIGpvaW5UYWJsZXM9YWxsX2xpbmtlZF90YWJsZXMpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYiRmFpbGVkIHRvIHF1ZXJ5IGFsbCBsaW5rZWQgdGFibGVzIC0ge2V9IikKICAgICAgICAgICAgICAgIHJhdyA9IG1jLnJ1bigiY29yZS5leGVjdXRlUXVlcnkiLCB0YXJnZXQ9TEVBRl9OT0RFX1RBQkxFLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5UYWJsZXM9IkVQT0NvbXB1dGVyUHJvcGVydGllcywgRVBPUHJvZHVjdFByb3BlcnR5UHJvZHVjdHMiKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYiRmFpbGVkIHRvIHF1ZXJ5IEVQT0NvbXB1dGVyUHJvcGVydGllcywgRVBPUHJvZHVjdFByb3BlcnR5UHJvZHVjdHMgLSB7ZX0uIFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdpbGwgZmV0Y2ggb25seSBiYXNpYyBpbmZvIGZyb20gRVBPQ29tcHV0ZXJQcm9wZXJ0aWVzIikKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICByYXcgPSBtYy5ydW4oImNvcmUuZXhlY3V0ZVF1ZXJ5IiwgdGFyZ2V0PUxFQUZfTk9ERV9UQUJMRSwgam9pblRhYmxlcz0iRVBPQ29tcHV0ZXJQcm9wZXJ0aWVzIikKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbignRXhjZXB0aW9uIGFsc28gaW4gaGVyZScpCiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICByZXR1cm4ganNvbi5kdW1wcyhyYXcpLCBjbGllbnRfZGF0YVtFUE9fSE9TVF0KCiAgICBkZWYgX2dldF9jbGllbnRfaWQoc2VsZiwgY2xpZW50X2NvbmZpZyk6CiAgICAgICAgcmV0dXJuIGNsaWVudF9jb25maWdbRVBPX0hPU1RdCgogICAgZGVmIF90ZXN0X3JlYWNoYWJpbGl0eShzZWxmLCBjbGllbnRfY29uZmlnKToKICAgICAgICByZXR1cm4gUkVTVENvbm5lY3Rpb24udGVzdF9yZWFjaGFiaWxpdHkoY2xpZW50X2NvbmZpZy5nZXQoRVBPX0hPU1QpLCBjbGllbnRfY29uZmlnLmdldChFUE9fUE9SVCkpCgogICAgZGVmIF9jb25uZWN0X2NsaWVudChzZWxmLCBjbGllbnRfY29uZmlnKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNsaWVudChwYXJzZV91cmwoY2xpZW50X2NvbmZpZ1tFUE9fSE9TVF0pLmhvc3QsIGNsaWVudF9jb25maWdbRVBPX1BPUlRdLAogICAgICAgICAgICAgICAgICAgY2xpZW50X2NvbmZpZ1tVU0VSXSwgY2xpZW50X2NvbmZpZ1tQQVNTXSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIG1lc3NhZ2UgPSAiRXJyb3IgY29ubmVjdGluZyB0byBjbGllbnQgezB9LCByZWFzb246IHsxfSIuZm9ybWF0KHNlbGYuX2dldF9jbGllbnRfaWQoY2xpZW50X2NvbmZpZyksIHN0cihlKSkKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihtZXNzYWdlKQogICAgICAgICAgICByYWlzZSBDbGllbnRDb25uZWN0aW9uRXhjZXB0aW9uKG1lc3NhZ2UpCiAgICAgICAgcmV0dXJuIGNsaWVudF9jb25maWcKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBhZGFwdGVyX3Byb3BlcnRpZXMoY2xzKToKICAgICAgICByZXR1cm4gW0FkYXB0ZXJQcm9wZXJ0eS5FbmRwb2ludF9Qcm90ZWN0aW9uX1BsYXRmb3JtLCBBZGFwdGVyUHJvcGVydHkuQWdlbnQsIEFkYXB0ZXJQcm9wZXJ0eS5NYW5hZ2VyXQoKICAgIEBjbGFzc21ldGhvZAogICAgZGVmIF9kYl9jb25maWdfc2NoZW1hKGNscykgLT4gZGljdDoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiaXRlbXMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJ25hbWUnOiAnZXhjbHVkZV9pcHY2JywKICAgICAgICAgICAgICAgICAgICAndGl0bGUnOiAnRXhjbHVkZSBJUHY2IGFkZHJlc3NlcycsCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnOiAnYm9vbCcKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICAgICAgInJlcXVpcmVkIjogWydleGNsdWRlX2lwdjYnXSwKICAgICAgICAgICAgInByZXR0eV9uYW1lIjogIk1jQWZlZSBlUE8gQ29uZmlndXJhdGlvbiIsCiAgICAgICAgICAgICJ0eXBlIjogImFycmF5IgogICAgICAgIH0KCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBfZGJfY29uZmlnX2RlZmF1bHQoY2xzKToKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAnZXhjbHVkZV9pcHY2JzogRmFsc2UsCiAgICAgICAgfQoKICAgIGRlZiBfb25fY29uZmlnX3VwZGF0ZShzZWxmLCBjb25maWcpOgogICAgICAgIHNlbGYuX19leGNsdWRlX2lwdjYgPSBjb25maWcuZ2V0KCdleGNsdWRlX2lwdjYnKSBvciBGYWxzZQo=',
    f'{CORTEX}/adapters/sccm_adapter/service.py': b'aW1wb3J0IGRhdGV0aW1lCmltcG9ydCBsb2dnaW5nCgpmcm9tIGF4b25pdXMuYWRhcHRlcl9iYXNlIGltcG9ydCBBZGFwdGVyQmFzZSwgQWRhcHRlclByb3BlcnR5CmZyb20gYXhvbml1cy5hZGFwdGVyX2V4Y2VwdGlvbnMgaW1wb3J0IENsaWVudENvbm5lY3Rpb25FeGNlcHRpb24KZnJvbSBheG9uaXVzLmNsaWVudHMubXNzcWwuY29ubmVjdGlvbiBpbXBvcnQgTVNTUUxDb25uZWN0aW9uCmZyb20gYXhvbml1cy5kZXZpY2VzLmFkX2VudGl0eSBpbXBvcnQgQURFbnRpdHkKZnJvbSBheG9uaXVzLmRldmljZXMuZGV2aWNlX2FkYXB0ZXIgaW1wb3J0IERldmljZUFkYXB0ZXIsIEFHRU5UX05BTUVTCmZyb20gYXhvbml1cy51dGlscy5wYXJzaW5nIGltcG9ydCBpc19kb21haW5fdmFsaWQKZnJvbSBheG9uaXVzLmZpZWxkcyBpbXBvcnQgRmllbGQsIExpc3RGaWVsZApmcm9tIGF4b25pdXMubWl4aW5zLmNvbmZpZ3VyYWJsZSBpbXBvcnQgQ29uZmlndXJhYmxlCmZyb20gYXhvbml1cy5jbGllbnRzLnJlc3QuY29ubmVjdGlvbiBpbXBvcnQgUkVTVENvbm5lY3Rpb24KZnJvbSBheG9uaXVzLnNtYXJ0X2pzb25fY2xhc3MgaW1wb3J0IFNtYXJ0SnNvbkNsYXNzCmZyb20gYXhvbml1cy51dGlscy5kYXRldGltZSBpbXBvcnQgcGFyc2VfZGF0ZQpmcm9tIGF4b25pdXMudXRpbHMuZmlsZXMgaW1wb3J0IGdldF9sb2NhbF9jb25maWdfZmlsZQpmcm9tIGF4b25pdXMudXRpbHMucGFyc2luZyBpbXBvcnQgZ2V0X29yZ2FuaXphdGlvbmFsX3VuaXRzX2Zyb21fZG4sIGdldF9leGNlcHRpb25fc3RyaW5nLCBpc192YWxpZF9pcHY2CmltcG9ydCBzY2NtX2FkYXB0ZXIuY29uc3RzIGFzIGNvbnN0cwoKbG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoZidheG9uaXVzLntfX25hbWVfX30nKQoKREVTS1RPUF9DSEFTSVNfVkFMVUUgPSBbJzMnLCAnNCcsICc2JywgJzcnLCAnMTUnXQpMQVBUT1BfQ0hBU0lTX1ZBTFVFID0gWyc4JywgJzknLCAnMTAnLCAnMjEnXQpDSEFTSVNfVkFMVUVfRlVMTF9ESUNUID0gewogICAgJzEnOiAnVmlydHVhbCBNYWNoaW5lJywKICAgICcyJzogJ0JsYWRlIFNlcnZlcicsCiAgICAnMyc6ICdEZXNrdG9wJywKICAgICc0JzogJ0xvdy1Qcm9maWxlIERlc2t0b3AnLAogICAgJzUnOiAnUGl6emEgQm94JywKICAgICc2JzogJ01pbmkgVG93ZXInLAogICAgJzcnOiAnVG93ZXInLAogICAgJzgnOiAnUG9ydGFibGUnLAogICAgJzknOiAnTGFwdG9wJywKICAgICcxMCc6ICdOb3RlYm9vaycsCiAgICAnMTEnOiAnSGFuZCBIZWxkJywKICAgICcxMic6ICdEb2NraW5nIFN0YXRpb24nLAogICAgJzEzJzogJ0FsbC1pbi1PbmUnLAogICAgJzE0JzogJ1N1YiBOb3RlYm9vaycsCiAgICAnMTUnOiAnU3BhY2UgU2F2aW5nIENoYXNzaXMnLAogICAgJzE2JzogJ1VsdHJhIFNtYWxsIEZvcm0gRmFjdG9yJywKICAgICcxNyc6ICdTZXJ2ZXIgVG93ZXIgQ2hhc3NpcycsCiAgICAnMTgnOiAnTW9iaWxlIERldmljZSBpbiBEb2NraW5nIFN0YXRpb24nLAogICAgJzE5JzogJ1N1Yi1DaGFzc2lzJywKICAgICcyMCc6ICdCdXMtRXhwYW5zaW9uIENoYXNzaXMnLAogICAgJzIxJzogJ1BlcmlwaGVyYWwgQ2hhc3NpcycsCiAgICAnMjInOiAnU3RvcmFnZSBDaGFzc2lzJywKICAgICcyMyc6ICdSYWNrIE1vdW50IFVuaXQnLAogICAgJzI0JzogJ1NlYWxlZC1DYXNlIFBDJywKfQoKCmNsYXNzIERyaXZlckRhdGEoU21hcnRKc29uQ2xhc3MpOgogICAgZHJpdmVyX25hbWUgPSBGaWVsZChzdHIsICdEcml2ZXIgTmFtZScpCiAgICBkcml2ZXJfZGVzY3JpcHRpb24gPSBGaWVsZChzdHIsICdEcml2ZXIgRGVzY3JpcHRpb24nKQogICAgZHJpdmVyX3ZlcnNpb24gPSBGaWVsZChzdHIsICdEcml2ZXIgVmVyc2lvbicpCiAgICBkcml2ZXJfcHJvdmlkZXIgPSBGaWVsZChzdHIsICdEcml2ZXIgUHJvdmlkZXInKQogICAgZHJpdmVyX2RhdGUgPSBGaWVsZChkYXRldGltZS5kYXRldGltZSwgJ0RyaXZlciBEYXRlJykKCgpjbGFzcyBTY2NtVm0oU21hcnRKc29uQ2xhc3MpOgogICAgdm1fZG5zX25hbWUgPSBGaWVsZChzdHIsICdWTSBETlMgTmFtZScpCiAgICB2bV9pcCA9IEZpZWxkKHN0ciwgJ1ZNIElQIEFkZHJlc3MnKQogICAgdm1fc3RhdGUgPSBGaWVsZChzdHIsICdWTSBTdGF0ZScpCiAgICB2bV9uYW1lID0gRmllbGQoc3RyLCAnVk0gTmFtZScpCiAgICB2bV9wYXRoID0gRmllbGQoc3RyLCAnVk0gUGF0aCcpCiAgICB2bV90eXBlID0gRmllbGQoc3RyLCAnVk0gVHlwZScpCiAgICB2bV90aW1lc3RhbXAgPSBGaWVsZChzdHIsICdWTSBUaW1lc3RhbXAnKQoKCmNsYXNzIFNjY21BZGFwdGVyKEFkYXB0ZXJCYXNlLCBDb25maWd1cmFibGUpOgogICAgY2xhc3MgTXlEZXZpY2VBZGFwdGVyKERldmljZUFkYXB0ZXIsIEFERW50aXR5KToKICAgICAgICByZXNvdXJjZV9pZCA9IEZpZWxkKHN0ciwgJ1Jlc291cmNlIElEJykKICAgICAgICBzY2NtX3NlcnZlciA9IEZpZWxkKHN0ciwgJ1NDQ00gU2VydmVyJykKICAgICAgICB0b3BfdXNlciA9IEZpZWxkKHN0ciwgJ1RvcCBDb25zb2xlIFVzZXInKQogICAgICAgIG1hY3Nfbm9faXAgPSBMaXN0RmllbGQoc3RyLCAnTUFDIGFkZHJlc3NlcyB3aXRoIE5vIElQJykKICAgICAgICBzY2NtX3R5cGUgPSBGaWVsZChzdHIsICdTQ0NNIENvbXB1dGVyIFR5cGUnKQogICAgICAgIHNjY21fcHJvZHVjdF90eXBlID0gRmllbGQoc3RyLCAnU0NDTSBQcm9kdWN0IFR5cGUnKQogICAgICAgIG1hbHdhcmVfZW5naW5lX3ZlcnNpb24gPSBGaWVsZChzdHIsICdNYWx3YXJlIFByb3RlY3Rpb24gRW5naW5lIFZlcnNpb24nKQogICAgICAgIG1hbHdhcmVfdmVyc2lvbiA9IEZpZWxkKHN0ciwgJ01hbHdhcmUgUHJvdGVjdGlvbiBWZXJzaW9uJykKICAgICAgICBtYWx3YXJlX3Byb2R1Y3Rfc3RhdHVzID0gRmllbGQoc3RyLCAnTWFsd2FyZSBQcm90ZWN0aW9uIFByb2R1Y3QgU3RhdHVzJykKICAgICAgICBtYWx3YXJlX2xhc3RfZnVsbF9zY2FuID0gRmllbGQoZGF0ZXRpbWUuZGF0ZXRpbWUsICdNYWx3YXJlIFByb3RlY2lvbiBMYXN0IEZ1bGwgU2NhbicpCiAgICAgICAgbWFsd2FyZV9sYXN0X3F1aWNrX3NjYW4gPSBGaWVsZChkYXRldGltZS5kYXRldGltZSwgJ01hbHdhcmUgUHJvdGVjaW9uIExhc3QgUXVpY2sgU2NhbicpCiAgICAgICAgbWFsd2FyZV9lbmFibGVkID0gRmllbGQoc3RyLCAnTWFsd2FyZSBQcm90ZWNpb24gRW5hYmxlZCBTdGF0dXMnKQogICAgICAgIGRlc2t0b3Bfb3JfbGFwdG9wID0gRmllbGQoc3RyLCAnRGVza3RvcCBPciBMYXB0b3AnLCBlbnVtPVsnRGVza3RvcCcsICdMYXB0b3AnXSkKICAgICAgICBjaGFzaXNfdmFsdWUgPSBGaWVsZChzdHIsICdDaGFzaXMgVmFsdWUnKQogICAgICAgIHNjY21fdm1zID0gTGlzdEZpZWxkKFNjY21WbSwgJ1NDQ00gVk1zJykKICAgICAgICBvd25lciA9IEZpZWxkKHN0ciwgJ093bmVyJykKICAgICAgICBkZXBhcnRtZW50ID0gRmllbGQoc3RyLCAnRGVwYXJ0bWVudCcpCiAgICAgICAgcHVycG9zZSA9IEZpZWxkKHN0ciwgJ1B1cnBvc2UnKQogICAgICAgIHRwbV9pc19hY3RpdmF0ZWQgPSBGaWVsZChib29sLCAnVFBNIElzIEFjdGl2YXRlZCcpCiAgICAgICAgdHBtX2lzX2VuYWJsZWQgPSBGaWVsZChib29sLCAnVFBNIElzIEVuYWJsZWQnKQogICAgICAgIHRwbV9pc19vd25lZCA9IEZpZWxkKGJvb2wsICdUUE0gSXMgT3duZWQnKQogICAgICAgIGNvbGxlY3Rpb25zID0gTGlzdEZpZWxkKHN0ciwgJ0NvbGxlY3Rpb25zJykKICAgICAgICBjb21wbGlhbmNlX3N0YXR1cyA9IEZpZWxkKHN0ciwgJ0NvbXBsaWFuY2UgU3RhdHVzJykKICAgICAgICBkcml2ZXJzX2RhdGEgPSBMaXN0RmllbGQoRHJpdmVyRGF0YSwgJ0RyaXZlcnMgRGF0YScpCiAgICAgICAgbmV0d29ya19kcml2ZXJzX2RhdGEgPSBMaXN0RmllbGQoRHJpdmVyRGF0YSwgJ05ldHdvcmsgRHJpdmVycyBEYXRhJykKCiAgICAgICAgZGVmIGFkZF9zY2NtX3ZtKHNlbGYsICoqa3dhcmdzKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZi5zY2NtX3Ztcy5hcHBlbmQoU2NjbVZtKCoqa3dhcmdzKSkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIGFkZGluZyBzY2NtIHZtJykKCiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXyhnZXRfbG9jYWxfY29uZmlnX2ZpbGUoX19maWxlX18pKQoKICAgIGRlZiBfZ2V0X2NsaWVudF9pZChzZWxmLCBjbGllbnRfY29uZmlnKToKICAgICAgICByZXR1cm4gY2xpZW50X2NvbmZpZ1tjb25zdHMuU0NDTV9IT1NUXQoKICAgIGRlZiBfdGVzdF9yZWFjaGFiaWxpdHkoc2VsZiwgY2xpZW50X2NvbmZpZyk6CiAgICAgICAgcmV0dXJuIFJFU1RDb25uZWN0aW9uLnRlc3RfcmVhY2hhYmlsaXR5KGNsaWVudF9jb25maWcuZ2V0KCdzZXJ2ZXInKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9ydD1jbGllbnRfY29uZmlnLmdldCgncG9ydCcpKQoKICAgIGRlZiBfY29ubmVjdF9jbGllbnQoc2VsZiwgY2xpZW50X2NvbmZpZyk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBjb25uZWN0aW9uID0gTVNTUUxDb25uZWN0aW9uKAogICAgICAgICAgICAgICAgZGF0YWJhc2U9Y2xpZW50X2NvbmZpZ1tjb25zdHMuU0NDTV9EQVRBQkFTRV0sCiAgICAgICAgICAgICAgICBzZXJ2ZXI9Y2xpZW50X2NvbmZpZ1tjb25zdHMuU0NDTV9IT1NUXSwKICAgICAgICAgICAgICAgIHBvcnQ9Y2xpZW50X2NvbmZpZy5nZXQoY29uc3RzLlNDQ01fUE9SVCkgb3IgY29uc3RzLkRFRkFVTFRfU0NDTV9QT1JULAogICAgICAgICAgICAgICAgZGV2aWNlc19wYWdpbmc9c2VsZi5fX2RldmljZXNfZmV0Y2hlZF9hdF9hX3RpbWUsCiAgICAgICAgICAgICkKICAgICAgICAgICAgY29ubmVjdGlvbi5zZXRfY3JlZGVudGlhbHModXNlcm5hbWU9Y2xpZW50X2NvbmZpZ1tjb25zdHMuVVNFUl0sIHBhc3N3b3JkPWNsaWVudF9jb25maWdbY29uc3RzLlBBU1NXT1JEXSkKICAgICAgICAgICAgd2l0aCBjb25uZWN0aW9uOgogICAgICAgICAgICAgICAgZm9yIF8gaW4gY29ubmVjdGlvbi5xdWVyeSgnc2VsZWN0IFJlc291cmNlSUQgZnJvbSB2X1JfU1lTVEVNJyk6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgcmV0dXJuIGNvbm5lY3Rpb24KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGVycjoKICAgICAgICAgICAgbWVzc2FnZSA9ICgKICAgICAgICAgICAgICAgIGYiRXJyb3IgY29ubmVjdGluZyB0byBjbGllbnQgaG9zdDoge3N0cihjbGllbnRfY29uZmlnW2NvbnN0cy5TQ0NNX0hPU1RdKX0gICIKICAgICAgICAgICAgICAgIGYiZGF0YWJhc2U6IHtzdHIoY2xpZW50X2NvbmZpZ1tjb25zdHMuU0NDTV9EQVRBQkFTRV0pfSIKICAgICAgICAgICAgKQogICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKG1lc3NhZ2UpCiAgICAgICAgICAgIGlmICdwZXJtaXNzaW9uIHdhcyBkZW5pZWQnIGluIHN0cihyZXByKGVycikpLmxvd2VyKCk6CiAgICAgICAgICAgICAgICByYWlzZSBDbGllbnRDb25uZWN0aW9uRXhjZXB0aW9uKGYnRXJyb3IgY29ubmVjdGluZyB0byBTQ0NNOiB7c3RyKGVycil9JykKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJhaXNlIENsaWVudENvbm5lY3Rpb25FeGNlcHRpb24oZ2V0X2V4Y2VwdGlvbl9zdHJpbmcoKSkKCiAgICBkZWYgX3F1ZXJ5X2RldmljZXNfYnlfY2xpZW50KHNlbGYsIGNsaWVudF9uYW1lLCBjbGllbnRfZGF0YSk6CiAgICAgICAgY2xpZW50X2RhdGEuc2V0X2RldmljZXNfcGFnaW5nKHNlbGYuX19kZXZpY2VzX2ZldGNoZWRfYXRfYV90aW1lKQogICAgICAgIHdpdGggY2xpZW50X2RhdGE6CgogICAgICAgICAgICBsb2NhbF9hZG1pbnNfZGljdCA9IGRpY3QoKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmb3IgbG9jYWxfYWRtaW5fZGF0YSBpbiBjbGllbnRfZGF0YS5xdWVyeShjb25zdHMuTE9DQUxfQURNSU5fUVVFUlkpOgogICAgICAgICAgICAgICAgICAgIGFzc2V0X2lkID0gbG9jYWxfYWRtaW5fZGF0YS5nZXQoJ1Jlc291cmNlSUQnKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBhc3NldF9pZDoKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICBpZiBsb2NhbF9hZG1pbl9kYXRhLmdldCgnbmFtZTAnKSAhPSAnQWRtaW5pc3RyYXRvcnMnOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGlmIGFzc2V0X2lkIG5vdCBpbiBsb2NhbF9hZG1pbnNfZGljdDoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfYWRtaW5zX2RpY3RbYXNzZXRfaWRdID0gW10KICAgICAgICAgICAgICAgICAgICBsb2NhbF9hZG1pbnNfZGljdFthc3NldF9pZF0uYXBwZW5kKGxvY2FsX2FkbWluX2RhdGEpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gZ2V0dGluZyBsb2NhbCBhZG1pbnMgZGljdCcsIGV4Y19pbmZvPVRydWUpCgogICAgICAgICAgICByYW1fZGljdCA9IGRpY3QoKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmb3IgcmFtX2RhdGEgaW4gY2xpZW50X2RhdGEucXVlcnkoY29uc3RzLlJBTV9RVUVSWSk6CiAgICAgICAgICAgICAgICAgICAgYXNzZXRfaWQgPSByYW1fZGF0YS5nZXQoJ1Jlc291cmNlSUQnKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBhc3NldF9pZCBvciBub3QgcmFtX2RhdGEuZ2V0KCdDYXBhY2l0eTAnKToKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICByYW1fZGljdFthc3NldF9pZF0gPSByYW1fZGF0YS5nZXQoJ0NhcGFjaXR5MCcpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gZ2V0dGluZyBjb2xsZWN0aW9ucyBkYXRhJywgZXhjX2luZm89VHJ1ZSkKICAgICAgICAgICAgY29sbGVjdGlvbnNfZGF0YV9kaWN0ID0gZGljdCgpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZvciBjb2xsZWN0aW9uX2RhdGFfZGF0YSBpbiBjbGllbnRfZGF0YS5xdWVyeShjb25zdHMuQ09MTEVDVElPTlNfREFUQV9RVUVSWSk6CiAgICAgICAgICAgICAgICAgICAgY29sbGVjdGlvbl9pZCA9IGNvbGxlY3Rpb25fZGF0YV9kYXRhLmdldCgnQ29sbGVjdGlvbklEJykKICAgICAgICAgICAgICAgICAgICBpZiBub3QgY29sbGVjdGlvbl9pZDoKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uc19kYXRhX2RpY3RbY29sbGVjdGlvbl9pZF0gPSBjb2xsZWN0aW9uX2RhdGFfZGF0YQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZidQcm9ibGVtIGdldHRpbmcgY29sbGVjdGlvbnMgZGF0YScsIGV4Y19pbmZvPVRydWUpCgogICAgICAgICAgICBjb2xsZWN0aW9uc19kaWN0ID0gZGljdCgpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZvciBjb2xsZWN0aW9uX2RhdGEgaW4gY2xpZW50X2RhdGEucXVlcnkoY29uc3RzLkNPTExFQ1RJT05TX1FVRVJZKToKICAgICAgICAgICAgICAgICAgICBhc3NldF9pZCA9IGNvbGxlY3Rpb25fZGF0YS5nZXQoJ1Jlc291cmNlSUQnKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBhc3NldF9pZDoKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICBpZiBhc3NldF9pZCBub3QgaW4gY29sbGVjdGlvbnNfZGljdDoKICAgICAgICAgICAgICAgICAgICAgICAgY29sbGVjdGlvbnNfZGljdFthc3NldF9pZF0gPSBbXQogICAgICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25zX2RpY3RbYXNzZXRfaWRdLmFwcGVuZChjb2xsZWN0aW9uX2RhdGEpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gZ2V0dGluZyBjb2xsZWN0aW9ucycsIGV4Y19pbmZvPVRydWUpCgogICAgICAgICAgICBuaWNzX2RpY3QgPSBkaWN0KCkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZm9yIG5pY19kYXRhIGluIGNsaWVudF9kYXRhLnF1ZXJ5KGNvbnN0cy5OSUNTX1FVRVJZKToKICAgICAgICAgICAgICAgICAgICBhc3NldF9pZCA9IG5pY19kYXRhLmdldCgnUmVzb3VyY2VJRCcpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGFzc2V0X2lkOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGlmIGFzc2V0X2lkIG5vdCBpbiBuaWNzX2RpY3Q6CiAgICAgICAgICAgICAgICAgICAgICAgIG5pY3NfZGljdFthc3NldF9pZF0gPSBbXQogICAgICAgICAgICAgICAgICAgIG5pY3NfZGljdFthc3NldF9pZF0uYXBwZW5kKG5pY19kYXRhKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZidQcm9ibGVtIGdldHRpbmcgbmljcyBkaWN0JywgZXhjX2luZm89VHJ1ZSkKCiAgICAgICAgICAgIGNsaWVudHNfZGljdCA9IGRpY3QoKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmb3IgY2xpZW50c19kYXRhIGluIGNsaWVudF9kYXRhLnF1ZXJ5KGNvbnN0cy5DTElFTlRfU1VNTUFSWV9RVUVSWSk6CiAgICAgICAgICAgICAgICAgICAgYXNzZXRfaWQgPSBjbGllbnRzX2RhdGEuZ2V0KCdSZXNvdXJjZUlEJykKICAgICAgICAgICAgICAgICAgICBpZiBub3QgYXNzZXRfaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgY2xpZW50c19kaWN0W2Fzc2V0X2lkXSA9IGNsaWVudHNfZGF0YQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZidQcm9ibGVtIGdldHRpbmcgY2xpZXRucyBkYXRhJywgZXhjX2luZm89VHJ1ZSkKCiAgICAgICAgICAgIG9zX2RpY3QgPSBkaWN0KCkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZm9yIG9zX2RhdGEgaW4gY2xpZW50X2RhdGEucXVlcnkoY29uc3RzLk9TX0RBVEFfUVVFUlkpOgogICAgICAgICAgICAgICAgICAgIGFzc2V0X2lkID0gb3NfZGF0YS5nZXQoJ1Jlc291cmNlSUQnKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBhc3NldF9pZDoKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICBvc19kaWN0W2Fzc2V0X2lkXSA9IG9zX2RhdGEKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYnUHJvYmxlbSBnZXR0aW5nIG9zIGRhdGEnLCBleGNfaW5mbz1UcnVlKQoKICAgICAgICAgICAgY29tcHV0ZXJfZGljdCA9IGRpY3QoKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmb3IgY29tcHV0ZXJfZGF0YSBpbiBjbGllbnRfZGF0YS5xdWVyeShjb25zdHMuQ09NUFVURVJfU1lTVEVNX1FVRVJZKToKICAgICAgICAgICAgICAgICAgICBhc3NldF9pZCA9IGNvbXB1dGVyX2RhdGEuZ2V0KCdSZXNvdXJjZUlEJykKICAgICAgICAgICAgICAgICAgICBpZiBub3QgYXNzZXRfaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgY29tcHV0ZXJfZGljdFthc3NldF9pZF0gPSBjb21wdXRlcl9kYXRhCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gZ2V0dGluZyBjb21wdXRlciBkYXRhJywgZXhjX2luZm89VHJ1ZSkKCiAgICAgICAgICAgIHRwbV9kaWN0ID0gZGljdCgpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZvciB0cG1fZGF0YSBpbiBjbGllbnRfZGF0YS5xdWVyeShjb25zdHMuVFBNX1FVRVJZKToKICAgICAgICAgICAgICAgICAgICBhc3NldF9pZCA9IHRwbV9kYXRhLmdldCgnUmVzb3VyY2VJRCcpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGFzc2V0X2lkOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIHRwbV9kaWN0W2Fzc2V0X2lkXSA9IHRwbV9kYXRhCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gZ2V0dGluZyB0cG0nLCBleGNfaW5mbz1UcnVlKQoKICAgICAgICAgICAgb3duZXJfZGljdCA9IGRpY3QoKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmb3Igb3duZXJfZGF0YSBpbiBjbGllbnRfZGF0YS5xdWVyeShjb25zdHMuT1dORVJfUVVFUlkpOgogICAgICAgICAgICAgICAgICAgIGFzc2V0X2lkID0gb3duZXJfZGF0YS5nZXQoJ01hY2hpbmVJRCcpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGFzc2V0X2lkOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIG93bmVyX2RpY3RbYXNzZXRfaWRdID0gb3duZXJfZGF0YQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZidQcm9ibGVtIGdldHRpbmcgb3duZXInLCBleGNfaW5mbz1UcnVlKQoKICAgICAgICAgICAgYXNzZXRfZW5jcnlwdGlvbl9kaWN0ID0gZGljdCgpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZvciBhc3NldF9lbmNyeXB0aW9uX2RhdGEgaW4gY2xpZW50X2RhdGEucXVlcnkoY29uc3RzLkVOQ1JZUFRJT05fUVVFUlkpOgogICAgICAgICAgICAgICAgICAgIGFzc2V0X2lkID0gYXNzZXRfZW5jcnlwdGlvbl9kYXRhLmdldCgnUmVzb3VyY2VJRCcpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGFzc2V0X2lkOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGlmIGFzc2V0X2lkIG5vdCBpbiBhc3NldF9lbmNyeXB0aW9uX2RpY3Q6CiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2V0X2VuY3J5cHRpb25fZGljdFthc3NldF9pZF0gPSBbXQogICAgICAgICAgICAgICAgICAgIGFzc2V0X2VuY3J5cHRpb25fZGljdFthc3NldF9pZF0uYXBwZW5kKGFzc2V0X2VuY3J5cHRpb25fZGF0YSkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYnUHJvYmxlbSBnZXR0aW5nIHF1ZXJ5IGFzc2V0X2VuY3J5cHRpb25fZGljdCcsIGV4Y19pbmZvPVRydWUpCgogICAgICAgICAgICBhc3NldF92bV9kaWN0ID0gZGljdCgpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZvciBhc3NldF92bV9kYXRhIGluIGNsaWVudF9kYXRhLnF1ZXJ5KGNvbnN0cy5WTV9RVUVSWSk6CiAgICAgICAgICAgICAgICAgICAgYXNzZXRfaWQgPSBhc3NldF92bV9kYXRhLmdldCgnUmVzb3VyY2VJRCcpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGFzc2V0X2lkOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGlmIGFzc2V0X2lkIG5vdCBpbiBhc3NldF92bV9kaWN0OgogICAgICAgICAgICAgICAgICAgICAgICBhc3NldF92bV9kaWN0W2Fzc2V0X2lkXSA9IFtdCiAgICAgICAgICAgICAgICAgICAgYXNzZXRfdm1fZGljdFthc3NldF9pZF0uYXBwZW5kKGFzc2V0X3ZtX2RhdGEpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gZ2V0dGluZyB2bScsIGV4Y19pbmZvPVRydWUpCgogICAgICAgICAgICBhc3NldF9jaGFzaXNfZGljdCA9IGRpY3QoKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmb3IgYXNzZXRfY2hhc2lzX2RhdGEgaW4gY2xpZW50X2RhdGEucXVlcnkoY29uc3RzLkNIQVNJU19RVUVSWSk6CiAgICAgICAgICAgICAgICAgICAgYXNzZXRfaWQgPSBhc3NldF9jaGFzaXNfZGF0YS5nZXQoJ1Jlc291cmNlSUQnKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBhc3NldF9pZDoKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICBhc3NldF9jaGFzaXNfZGljdFthc3NldF9pZF0gPSBhc3NldF9jaGFzaXNfZGF0YQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZidQcm9ibGVtIGdldHRpbmcgY2hhc2lzJywgZXhjX2luZm89VHJ1ZSkKCiAgICAgICAgICAgIGFzc2V0X2xlbm92b19kaWN0ID0gZGljdCgpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZvciBhc3NldF9sZW5vdm9fZGF0YSBpbiBjbGllbnRfZGF0YS5xdWVyeShjb25zdHMuTEVOT1ZPX1FVRVJZKToKICAgICAgICAgICAgICAgICAgICBhc3NldF9pZCA9IGFzc2V0X2xlbm92b19kYXRhLmdldCgnUmVzb3VyY2VJRCcpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGFzc2V0X2lkOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGFzc2V0X2xlbm92b19kaWN0W2Fzc2V0X2lkXSA9IGFzc2V0X2xlbm92b19kYXRhCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gZ2V0dGluZyBsZW5vdm8nLCBleGNfaW5mbz1UcnVlKQoKICAgICAgICAgICAgYXNzZXRfdG9wX2RpY3QgPSBkaWN0KCkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZm9yIGFzc2V0X3RvcF9kYXRhIGluIGNsaWVudF9kYXRhLnF1ZXJ5KGNvbnN0cy5VU0VSU19UT1BfUVVFUlkpOgogICAgICAgICAgICAgICAgICAgIGFzc2V0X2lkID0gYXNzZXRfdG9wX2RhdGEuZ2V0KCdSZXNvdXJjZUlEJykKICAgICAgICAgICAgICAgICAgICBpZiBub3QgYXNzZXRfaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgYXNzZXRfdG9wX2RpY3RbYXNzZXRfaWRdID0gYXNzZXRfdG9wX2RhdGEKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYnUHJvYmxlbSBnZXR0aW5nIHRvcCB1c2VycycsIGV4Y19pbmZvPVRydWUpCgogICAgICAgICAgICBhc3NldF9tYWx3YXJlX2RpY3QgPSBkaWN0KCkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZm9yIGFzc2V0X21hbHdhcmVfZGF0YSBpbiBjbGllbnRfZGF0YS5xdWVyeShjb25zdHMuTUFMV0FSRV9RVUVSWSk6CiAgICAgICAgICAgICAgICAgICAgYXNzZXRfaWQgPSBhc3NldF9tYWx3YXJlX2RhdGEuZ2V0KCdSZXNvdXJjZUlEJykKICAgICAgICAgICAgICAgICAgICBpZiBub3QgYXNzZXRfaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgYXNzZXRfbWFsd2FyZV9kaWN0W2Fzc2V0X2lkXSA9IGFzc2V0X21hbHdhcmVfZGF0YQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZidQcm9ibGVtIGdldHRpbmcgbWFsd2FyZSBkYXRhJywgZXhjX2luZm89VHJ1ZSkKCiAgICAgICAgICAgIGFzc2V0X3VzZXJzX2RpY3QgPSBkaWN0KCkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZm9yIGFzc2V0X3VzZXJzX2RhdGEgaW4gY2xpZW50X2RhdGEucXVlcnkoY29uc3RzLlVTRVJTX1FVRVJZKToKICAgICAgICAgICAgICAgICAgICBhc3NldF9pZCA9IGFzc2V0X3VzZXJzX2RhdGEuZ2V0KCdNYWNoaW5lUmVzb3VyY2VJRCcpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGFzc2V0X2lkOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGlmIGFzc2V0X2lkIG5vdCBpbiBhc3NldF91c2Vyc19kaWN0OgogICAgICAgICAgICAgICAgICAgICAgICBhc3NldF91c2Vyc19kaWN0W2Fzc2V0X2lkXSA9IFtdCiAgICAgICAgICAgICAgICAgICAgYXNzZXRfdXNlcnNfZGljdFthc3NldF9pZF0uYXBwZW5kKGFzc2V0X3VzZXJzX2RhdGEpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gZ2V0dGluZyBxdWVyeSB1c2VycycsIGV4Y19pbmZvPVRydWUpCgogICAgICAgICAgICBuZXdfc29mdHdhcmVfZGljdCA9IGRpY3QoKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmb3IgbmV3X3NvZnRfZGF0YSBpbiBjbGllbnRfZGF0YS5xdWVyeShjb25zdHMuTkVXX1NPRlRXQVJFX1FVRVJZKToKICAgICAgICAgICAgICAgICAgICBhc3NldF9pZCA9IG5ld19zb2Z0X2RhdGEuZ2V0KCdSZXNvdXJjZUlEJykKICAgICAgICAgICAgICAgICAgICBpZiBub3QgYXNzZXRfaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgaWYgYXNzZXRfaWQgbm90IGluIG5ld19zb2Z0d2FyZV9kaWN0OgogICAgICAgICAgICAgICAgICAgICAgICBuZXdfc29mdHdhcmVfZGljdFthc3NldF9pZF0gPSBbXQogICAgICAgICAgICAgICAgICAgIG5ld19zb2Z0d2FyZV9kaWN0W2Fzc2V0X2lkXS5hcHBlbmQobmV3X3NvZnRfZGF0YSkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYnUHJvYmxlbSBnZXR0aW5nIHF1ZXJ5IG5ldyBzb2Z0d2FyZScsIGV4Y19pbmZvPVRydWUpCgogICAgICAgICAgICBhc3NldF9zb2Z0d2FyZV9kaWN0ID0gZGljdCgpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZvciBhc3NldF9zb2Z0X2RhdGEgaW4gY2xpZW50X2RhdGEucXVlcnkoY29uc3RzLlFVRVJZX1NPRlRXQVJFKToKICAgICAgICAgICAgICAgICAgICBhc3NldF9pZCA9IGFzc2V0X3NvZnRfZGF0YS5nZXQoJ1Jlc291cmNlSUQnKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBhc3NldF9pZDoKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICBpZiBhc3NldF9pZCBub3QgaW4gYXNzZXRfc29mdHdhcmVfZGljdDoKICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXRfc29mdHdhcmVfZGljdFthc3NldF9pZF0gPSBbXQogICAgICAgICAgICAgICAgICAgIGFzc2V0X3NvZnR3YXJlX2RpY3RbYXNzZXRfaWRdLmFwcGVuZChhc3NldF9zb2Z0X2RhdGEpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gZ2V0dGluZyBxdWVyeSBzb2Z0d2FyZScsIGV4Y19pbmZvPVRydWUpCgogICAgICAgICAgICBhc3NldF9wcm9ncmFtX2RpY3QgPSBkaWN0KCkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZm9yIGFzc2V0X3Byb2dyYW1fZGF0YSBpbiBjbGllbnRfZGF0YS5xdWVyeShjb25zdHMuUVVFUllfUFJPR1JBTSk6CiAgICAgICAgICAgICAgICAgICAgYXNzZXRfaWQgPSBhc3NldF9wcm9ncmFtX2RhdGEuZ2V0KCdSZXNvdXJjZUlEJykKICAgICAgICAgICAgICAgICAgICBpZiBub3QgYXNzZXRfaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgaWYgYXNzZXRfaWQgbm90IGluIGFzc2V0X3Byb2dyYW1fZGljdDoKICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXRfcHJvZ3JhbV9kaWN0W2Fzc2V0X2lkXSA9IFtdCiAgICAgICAgICAgICAgICAgICAgYXNzZXRfcHJvZ3JhbV9kaWN0W2Fzc2V0X2lkXS5hcHBlbmQoYXNzZXRfcHJvZ3JhbV9kYXRhKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZidQcm9ibGVtIGdldHRpbmcgcXVlcnkgcHJvZ3JhbScsIGV4Y19pbmZvPVRydWUpCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmb3IgYXNzZXRfcHJvZ3JhbV9kYXRhIGluIGNsaWVudF9kYXRhLnF1ZXJ5KGNvbnN0cy5RVUVSWV9QUk9HUkFNXzIpOgogICAgICAgICAgICAgICAgICAgIGFzc2V0X2lkID0gYXNzZXRfcHJvZ3JhbV9kYXRhLmdldCgnUmVzb3VyY2VJRCcpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGFzc2V0X2lkOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGlmIGFzc2V0X2lkIG5vdCBpbiBhc3NldF9wcm9ncmFtX2RpY3Q6CiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2V0X3Byb2dyYW1fZGljdFthc3NldF9pZF0gPSBbXQogICAgICAgICAgICAgICAgICAgIGFzc2V0X3Byb2dyYW1fZGljdFthc3NldF9pZF0uYXBwZW5kKGFzc2V0X3Byb2dyYW1fZGF0YSkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYnUHJvYmxlbSBnZXR0aW5nIHF1ZXJ5IHByb2dyYW0nLCBleGNfaW5mbz1UcnVlKQoKICAgICAgICAgICAgZHJpdmVyc19kaWN0ID0gZGljdCgpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZvciBkcml2ZXJzX2RhdGEgaW4gY2xpZW50X2RhdGEucXVlcnkoY29uc3RzLkRSSVZFUlNfUVVFUlkpOgogICAgICAgICAgICAgICAgICAgIGFzc2V0X2lkID0gZHJpdmVyc19kYXRhLmdldCgnUmVzb3VyY2VJRCcpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGFzc2V0X2lkOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGlmIGFzc2V0X2lkIG5vdCBpbiBkcml2ZXJzX2RpY3Q6CiAgICAgICAgICAgICAgICAgICAgICAgIGRyaXZlcnNfZGljdFthc3NldF9pZF0gPSBbXQogICAgICAgICAgICAgICAgICAgIGRyaXZlcnNfZGljdFthc3NldF9pZF0uYXBwZW5kKGRyaXZlcnNfZGF0YSkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYnUHJvYmxlbSBnZXR0aW5nIHF1ZXJ5IHBhdGNoJywgZXhjX2luZm89VHJ1ZSkKCiAgICAgICAgICAgIG5ldHdvcmtfZHJpdmVyc19kaWN0ID0gZGljdCgpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZvciBuZXR3b3JrX2RyaXZlcnNfZGF0YSBpbiBjbGllbnRfZGF0YS5xdWVyeShjb25zdHMuTkVUV09SS19EUklWRVJTX1FVRVJZKToKICAgICAgICAgICAgICAgICAgICBhc3NldF9pZCA9IG5ldHdvcmtfZHJpdmVyc19kYXRhLmdldCgnUmVzb3VyY2VJRCcpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGFzc2V0X2lkOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGlmIGFzc2V0X2lkIG5vdCBpbiBuZXR3b3JrX2RyaXZlcnNfZGljdDoKICAgICAgICAgICAgICAgICAgICAgICAgbmV0d29ya19kcml2ZXJzX2RpY3RbYXNzZXRfaWRdID0gW10KICAgICAgICAgICAgICAgICAgICBuZXR3b3JrX2RyaXZlcnNfZGljdFthc3NldF9pZF0uYXBwZW5kKG5ldHdvcmtfZHJpdmVyc19kYXRhKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZidQcm9ibGVtIGdldHRpbmcgbmV0d29yayBxdWVyeSBwYXRjaCcsIGV4Y19pbmZvPVRydWUpCgogICAgICAgICAgICBhc3NldF9wYXRjaF9kaWN0ID0gZGljdCgpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZvciBhc3NldF9wYXRjaF9kYXRhIGluIGNsaWVudF9kYXRhLnF1ZXJ5KGNvbnN0cy5RVUVSWV9QQVRDSCk6CiAgICAgICAgICAgICAgICAgICAgYXNzZXRfaWQgPSBhc3NldF9wYXRjaF9kYXRhLmdldCgnUmVzb3VyY2VJRCcpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGFzc2V0X2lkOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGlmIGFzc2V0X2lkIG5vdCBpbiBhc3NldF9wYXRjaF9kaWN0OgogICAgICAgICAgICAgICAgICAgICAgICBhc3NldF9wYXRjaF9kaWN0W2Fzc2V0X2lkXSA9IFtdCiAgICAgICAgICAgICAgICAgICAgYXNzZXRfcGF0Y2hfZGljdFthc3NldF9pZF0uYXBwZW5kKGFzc2V0X3BhdGNoX2RhdGEpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gZ2V0dGluZyBxdWVyeSBwYXRjaCcsIGV4Y19pbmZvPVRydWUpCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmb3IgYXNzZXRfcGF0Y2hfZGF0YSBpbiBjbGllbnRfZGF0YS5xdWVyeShjb25zdHMuUVVFUllfUEFUQ0hfMik6CiAgICAgICAgICAgICAgICAgICAgYXNzZXRfaWQgPSBhc3NldF9wYXRjaF9kYXRhLmdldCgnUmVzb3VyY2VJRCcpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGFzc2V0X2lkOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGlmIGFzc2V0X2lkIG5vdCBpbiBhc3NldF9wYXRjaF9kaWN0OgogICAgICAgICAgICAgICAgICAgICAgICBhc3NldF9wYXRjaF9kaWN0W2Fzc2V0X2lkXSA9IFtdCiAgICAgICAgICAgICAgICAgICAgYXNzZXRfcGF0Y2hfZGljdFthc3NldF9pZF0uYXBwZW5kKGFzc2V0X3BhdGNoX2RhdGEpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gZ2V0dGluZyBxdWVyeSBwYXRjaCcsIGV4Y19pbmZvPVRydWUpCgogICAgICAgICAgICBjb21wbGlhbmNlX2RpY3QgPSBkaWN0KCkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZm9yIGNvbXBsaWFuY2VfZGF0YSBpbiBjbGllbnRfZGF0YS5xdWVyeShjb25zdHMuQ09NUExJQU5DRV9RVUVSWSk6CiAgICAgICAgICAgICAgICAgICAgYXNzZXRfaWQgPSBjb21wbGlhbmNlX2RhdGEuZ2V0KCdSZXNvdXJjZUlEJykKICAgICAgICAgICAgICAgICAgICBpZiBub3QgYXNzZXRfaWQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgY29tcGxpYW5jZV9kaWN0W2Fzc2V0X2lkXSA9IGNvbXBsaWFuY2VfZGF0YQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZidQcm9ibGVtIGdldHRpbmcgY29tcGxpYW5jZScsIGV4Y19pbmZvPVRydWUpCiAgICAgICAgICAgIGFzc2V0X2Jpb3NfZGljdCA9IGRpY3QoKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmb3IgYXNzZXRfYmlvc19kYXRhIGluIGNsaWVudF9kYXRhLnF1ZXJ5KGNvbnN0cy5CSU9TX1FVRVJZKToKICAgICAgICAgICAgICAgICAgICBhc3NldF9pZCA9IGFzc2V0X2Jpb3NfZGF0YS5nZXQoJ1Jlc291cmNlSUQnKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBhc3NldF9pZDoKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICBhc3NldF9iaW9zX2RpY3RbYXNzZXRfaWRdID0gYXNzZXRfYmlvc19kYXRhCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gZ2V0dGluZyBxdWVyeSBiaW9zJywgZXhjX2luZm89VHJ1ZSkKICAgICAgICAgICAgZGV2aWNlc19yYXdfcXVlcnkgPSBsaXN0KGNsaWVudF9kYXRhLnF1ZXJ5KGNvbnN0cy5TQ0NNX01BSU5fUVVFUlkpKQogICAgICAgICAgICBmb3IgZGV2aWNlX3JhdyBpbiBkZXZpY2VzX3Jhd19xdWVyeToKICAgICAgICAgICAgICAgIHlpZWxkIGRldmljZV9yYXcsIGNsaWVudF9kYXRhLnNlcnZlciwgYXNzZXRfc29mdHdhcmVfZGljdCwgYXNzZXRfcGF0Y2hfZGljdCwgYXNzZXRfcHJvZ3JhbV9kaWN0LCBcCiAgICAgICAgICAgICAgICAgICAgYXNzZXRfYmlvc19kaWN0LCBhc3NldF91c2Vyc19kaWN0LCBhc3NldF90b3BfZGljdCwgYXNzZXRfbWFsd2FyZV9kaWN0LCBcCiAgICAgICAgICAgICAgICAgICAgYXNzZXRfbGVub3ZvX2RpY3QsIGFzc2V0X2NoYXNpc19kaWN0LCBhc3NldF9lbmNyeXB0aW9uX2RpY3QsXAogICAgICAgICAgICAgICAgICAgIGFzc2V0X3ZtX2RpY3QsIG93bmVyX2RpY3QsIHRwbV9kaWN0LCBjb21wdXRlcl9kaWN0LFwKICAgICAgICAgICAgICAgICAgICBjbGllbnRzX2RpY3QsIG9zX2RpY3QsIG5pY3NfZGljdCwgY29sbGVjdGlvbnNfZGljdCxcCiAgICAgICAgICAgICAgICAgICAgY29sbGVjdGlvbnNfZGF0YV9kaWN0LCBjb21wbGlhbmNlX2RpY3QsIGxvY2FsX2FkbWluc19kaWN0LFwKICAgICAgICAgICAgICAgICAgICBkcml2ZXJzX2RpY3QsIHJhbV9kaWN0LCBuZXR3b3JrX2RyaXZlcnNfZGljdCwgbmV3X3NvZnR3YXJlX2RpY3QKCiAgICBkZWYgX2NsaWVudHNfc2NoZW1hKHNlbGYpOgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJpdGVtcyI6IFsKICAgICAgICAgICAgICAgIHsibmFtZSI6IGNvbnN0cy5TQ0NNX0hPU1QsICJ0aXRsZSI6ICJTQ0NNL01TU1FMIFNlcnZlciIsICJ0eXBlIjogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgeyJuYW1lIjogY29uc3RzLlNDQ01fUE9SVCwgInRpdGxlIjogIlBvcnQiLCAidHlwZSI6ICJpbnRlZ2VyIiwgImRlZmF1bHQiOiBjb25zdHMuREVGQVVMVF9TQ0NNX1BPUlR9LAogICAgICAgICAgICAgICAgeyJuYW1lIjogY29uc3RzLlNDQ01fREFUQUJBU0UsICJ0aXRsZSI6ICJEYXRhYmFzZSIsICJ0eXBlIjogInN0cmluZyJ9LAogICAgICAgICAgICAgICAgeyJuYW1lIjogY29uc3RzLlVTRVIsICJ0aXRsZSI6ICJVc2VyIE5hbWUiLCAidHlwZSI6ICJzdHJpbmcifSwKICAgICAgICAgICAgICAgIHsibmFtZSI6IGNvbnN0cy5QQVNTV09SRCwgInRpdGxlIjogIlBhc3N3b3JkIiwgInR5cGUiOiAic3RyaW5nIiwgImZvcm1hdCI6ICJwYXNzd29yZCJ9LAogICAgICAgICAgICBdLAogICAgICAgICAgICAicmVxdWlyZWQiOiBbY29uc3RzLlNDQ01fSE9TVCwgY29uc3RzLlVTRVIsIGNvbnN0cy5QQVNTV09SRCwgY29uc3RzLlNDQ01fREFUQUJBU0VdLAogICAgICAgICAgICAidHlwZSI6ICJhcnJheSIsCiAgICAgICAgfQoKICAgIGRlZiBfcGFyc2VfcmF3X2RhdGEoc2VsZiwgZGV2aWNlc19yYXdfZGF0YSk6CiAgICAgICAgZm9yICgKICAgICAgICAgICAgZGV2aWNlX3JhdywKICAgICAgICAgICAgc2NjbV9zZXJ2ZXIsCiAgICAgICAgICAgIGFzc2V0X3NvZnR3YXJlX2RpY3QsCiAgICAgICAgICAgIGFzc2V0X3BhdGNoX2RpY3QsCiAgICAgICAgICAgIGFzc2V0X3Byb2dyYW1fZGljdCwKICAgICAgICAgICAgYXNzZXRfYmlvc19kaWN0LAogICAgICAgICAgICBhc3NldF91c2Vyc19kaWN0LAogICAgICAgICAgICBhc3NldF90b3BfZGljdCwKICAgICAgICAgICAgYXNzZXRfbWFsd2FyZV9kaWN0LAogICAgICAgICAgICBhc3NldF9sZW5vdm9fZGljdCwKICAgICAgICAgICAgYXNzZXRfY2hhc2lzX2RpY3QsCiAgICAgICAgICAgIGFzc2V0X2VuY3J5cHRpb25fZGljdCwKICAgICAgICAgICAgYXNzZXRfdm1fZGljdCwKICAgICAgICAgICAgb3duZXJfZGljdCwKICAgICAgICAgICAgdHBtX2RpY3QsCiAgICAgICAgICAgIGNvbXB1dGVyX2RpY3QsCiAgICAgICAgICAgIGNsaWVudHNfZGljdCwKICAgICAgICAgICAgb3NfZGljdCwKICAgICAgICAgICAgbmljc19kaWN0LAogICAgICAgICAgICBjb2xsZWN0aW9uc19kaWN0LCBjb2xsZWN0aW9uc19kYXRhX2RpY3QsIGNvbXBsaWFuY2VfZGljdCwKICAgICAgICAgICAgbG9jYWxfYWRtaW5zX2RpY3QsIGRyaXZlcnNfZGljdCwgcmFtX2RpY3QsIG5ldHdvcmtfZHJpdmVyc19kaWN0LCBuZXdfc29mdHdhcmVfZGljdAogICAgICAgICkgaW4gZGV2aWNlc19yYXdfZGF0YToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZGV2aWNlX2lkID0gZGV2aWNlX3Jhdy5nZXQoJ0Rpc3Rpbmd1aXNoZWRfTmFtZTAnKQogICAgICAgICAgICAgICAgaWYgbm90IGRldmljZV9pZDoKICAgICAgICAgICAgICAgICAgICAjIEluIGNhc2Ugb2Ygbm8gQUQgZGlzdGluZ3Vpc2hlZCBuYW1lLCBhdCBsZWFzdCB3ZSBoYXZlIHRoZSBuZXRiaW9zIG5hbWUgcGx1cyByZXNvdXJjZSBJRCwKICAgICAgICAgICAgICAgICAgICAjIGJvdGggYXJlIG5vdCB0aGF0IGdvb2QsIGJ1dCB0b2dldGhlciB0aGV5IHNob3VsZCBtYWtlIGEgZ29vZCBpZC4KICAgICAgICAgICAgICAgICAgICBkZXZpY2VfaWQgPSAoZGV2aWNlX3Jhdy5nZXQoJ05ldGJpb3NfTmFtZTAnKSBvciAnJykgKyBzdHIoZGV2aWNlX3Jhdy5nZXQoJ1Jlc291cmNlSUQnKSBvciAnJykKICAgICAgICAgICAgICAgICAgICBpZiBub3QgZGV2aWNlX2lkOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZidHb3QgYSBkZXZpY2Ugd2l0aCBubyBkaXN0aW5ndWlzaGVkIG5hbWUge2RldmljZV9yYXd9JykKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIGRldmljZSA9IHNlbGYuX25ld19kZXZpY2VfYWRhcHRlcigpCiAgICAgICAgICAgICAgICBkZXZpY2Uuc2NjbV9zZXJ2ZXIgPSBzY2NtX3NlcnZlcgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGRldmljZS5hZF9kaXN0aW5ndWlzaGVkX25hbWUgPSBkZXZpY2VfcmF3LmdldCgnRGlzdGluZ3Vpc2hlZF9OYW1lMCcpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgIG9zX2RhdGEgPSBvc19kaWN0LmdldChkZXZpY2VfcmF3LmdldCgnUmVzb3VyY2VJRCcpKQogICAgICAgICAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob3NfZGF0YSwgZGljdCk6CiAgICAgICAgICAgICAgICAgICAgb3NfZGF0YSA9IHt9CiAgICAgICAgICAgICAgICBjb21wdXRlcl9kYXRhID0gY29tcHV0ZXJfZGljdC5nZXQoZGV2aWNlX3Jhdy5nZXQoJ1Jlc291cmNlSUQnKSkKICAgICAgICAgICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKGNvbXB1dGVyX2RhdGEsIGRpY3QpOgogICAgICAgICAgICAgICAgICAgIGNvbXB1dGVyX2RhdGEgPSB7fQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHVzZXJzX3JhdyA9IGFzc2V0X3VzZXJzX2RpY3QuZ2V0KGRldmljZV9yYXcuZ2V0KCdSZXNvdXJjZUlEJykpCiAgICAgICAgICAgICAgICAgICAgaWYgdXNlcnNfcmF3IGFuZCBpc2luc3RhbmNlKHVzZXJzX3JhdywgbGlzdCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5sYXN0X3VzZWRfdXNlcnMgPSBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX3Jhdy5nZXQoJ1VuaXF1ZVVzZXJOYW1lJykgZm9yIHVzZXJfcmF3IGluIHVzZXJzX3JhdyBpZiB1c2VyX3Jhdy5nZXQoJ1VuaXF1ZVVzZXJOYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnUHJvYmxlbSBhZGRpbmcgdXNlcnMgdG8ge2RldmljZV9yYXd9JykKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uc19kYXRhID0gY29sbGVjdGlvbnNfZGljdC5nZXQoZGV2aWNlX3Jhdy5nZXQoJ1Jlc291cmNlSUQnKSkKICAgICAgICAgICAgICAgICAgICBpZiBjb2xsZWN0aW9uc19kYXRhIGFuZCBpc2luc3RhbmNlKGNvbGxlY3Rpb25zX2RhdGEsIGxpc3QpOgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgY29sbGVjdGlvbl9yYXcgaW4gY29sbGVjdGlvbnNfZGF0YToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShjb2xsZWN0aW9uX3JhdywgZGljdCkgb3Igbm90IGNvbGxlY3Rpb25fcmF3LmdldCgnQ29sbGVjdGlvbklEJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sbGVjdGlvbl9pZCA9IGNvbGxlY3Rpb25fcmF3LmdldCgnQ29sbGVjdGlvbklEJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjb2xsZWN0aW9uc19kYXRhX2RpY3QuZ2V0KGNvbGxlY3Rpb25faWQpIGFuZCBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc2luc3RhbmNlKGNvbGxlY3Rpb25zX2RhdGFfZGljdC5nZXQoY29sbGVjdGlvbl9pZCksIGRpY3QpIGFuZCBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uc19kYXRhX2RpY3QuZ2V0KGNvbGxlY3Rpb25faWQpLmdldCgnTmFtZScpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2UuY29sbGVjdGlvbnMuYXBwZW5kKGNvbGxlY3Rpb25zX2RhdGFfZGljdC5nZXQoY29sbGVjdGlvbl9pZCkuZ2V0KCdOYW1lJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIHdpdGggY29sbGVjdGlvbl9yYXcge2NvbGxlY3Rpb25fcmF3fScpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIGdldHRpbmcgY29sbGVjdGlvbnMgZm9yIHtkZXZpY2VfcmF3fScpCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGVuY3J5cHRpb25zX3JhdyA9IGFzc2V0X2VuY3J5cHRpb25fZGljdC5nZXQoZGV2aWNlX3Jhdy5nZXQoJ1Jlc291cmNlSUQnKSkKICAgICAgICAgICAgICAgICAgICBpZiBlbmNyeXB0aW9uc19yYXcgYW5kIGlzaW5zdGFuY2UoZW5jcnlwdGlvbnNfcmF3LCBsaXN0KToKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGRyaXZlX2VuY19kYXRhIGluIGVuY3J5cHRpb25zX3JhdzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc19lbmNyeXB0ZWQgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc3RyKGRyaXZlX2VuY19kYXRhLmdldCgnUHJvdGVjdGlvblN0YXR1czAnKSkgPT0gJzEnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc19lbmNyeXB0ZWQgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBzdHIoZHJpdmVfZW5jX2RhdGEuZ2V0KCdQcm90ZWN0aW9uU3RhdHVzMCcpKSA9PSAnMCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX2VuY3J5cHRlZCA9IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZHJpdmVfZW5jX2RhdGEuZ2V0KCdEcml2ZUxldHRlcjAnKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlLmFkZF9oZChwYXRoPWRyaXZlX2VuY19kYXRhLmdldCgnRHJpdmVMZXR0ZXIwJyksIGlzX2VuY3J5cHRlZD1pc19lbmNyeXB0ZWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIGdldHRpbmcgZW5jIGRhdGEgZm9yIHtkcml2ZV9lbmNfZGF0YX0nKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnUHJvYmxlbSBhZGRpbmcgdXNlcnMgdG8ge2RldmljZV9yYXd9JykKICAgICAgICAgICAgICAgIGRldmljZS5yZXNvdXJjZV9pZCA9IHN0cihkZXZpY2VfcmF3LmdldCgnUmVzb3VyY2VJRCcpKQogICAgICAgICAgICAgICAgZGV2aWNlLm9yZ2FuaXphdGlvbmFsX3VuaXQgPSBnZXRfb3JnYW5pemF0aW9uYWxfdW5pdHNfZnJvbV9kbihkZXZpY2VfaWQpCiAgICAgICAgICAgICAgICBkb21haW4gPSBkZXZpY2VfcmF3LmdldCgnRnVsbF9Eb21haW5fTmFtZTAnKQogICAgICAgICAgICAgICAgaWYgZG9tYWluOgogICAgICAgICAgICAgICAgICAgIGRldmljZS5wYXJ0X29mX2RvbWFpbiA9IFRydWUKICAgICAgICAgICAgICAgICAgICBkZXZpY2UuZG9tYWluID0gZG9tYWluCiAgICAgICAgICAgICAgICBkZXZpY2UuYWRkX2FnZW50X3ZlcnNpb24odmVyc2lvbj1kZXZpY2VfcmF3LmdldCgnQ2xpZW50X1ZlcnNpb24wJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWdlbnQ9QUdFTlRfTkFNRVMuc2NjbSkKICAgICAgICAgICAgICAgIGlmIHNlbGYuX19tYWNoaW5lX2RvbWFpbl93aGl0ZWxpc3QgYW5kIGRvbWFpbiBhbmQgZG9tYWluLmxvd2VyKCkgbm90IGluIHNlbGYuX19tYWNoaW5lX2RvbWFpbl93aGl0ZWxpc3Q6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICBkZXZpY2VfZnVsbF9ob3N0bmFtZSA9IGRldmljZV9yYXcuZ2V0KCdOZXRiaW9zX05hbWUwJykKICAgICAgICAgICAgICAgIGlmIGRldmljZV9mdWxsX2hvc3RuYW1lID09ICdVbmtub3duJzoKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgaWYgZGV2aWNlX2Z1bGxfaG9zdG5hbWU6CiAgICAgICAgICAgICAgICAgICAgaWYgZG9tYWluOgogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VfZnVsbF9ob3N0bmFtZSArPSAnLicgKyBkb21haW4KICAgICAgICAgICAgICAgICAgICBkZXZpY2UuaG9zdG5hbWUgPSBkZXZpY2VfZnVsbF9ob3N0bmFtZQogICAgICAgICAgICAgICAgICAgIGRldmljZV9pZCArPSBmJyR7ZGV2aWNlLmhvc3RuYW1lfScKCiAgICAgICAgICAgICAgICBkZXZpY2UuaWQgPSBkZXZpY2VfaWQKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBkZXZpY2UuZmlndXJlX29zKChkZXZpY2VfcmF3LmdldCgnb3BlcmF0aW5nU3lzdGVtMCcpIG9yICcnKSArICcgJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZGV2aWNlX3Jhdy5nZXQoJ09wZXJhdGluZ19TeXN0ZW1fTmFtZV9hbmQwJykgb3IgJycpKQogICAgICAgICAgICAgICAgICAgIGRldmljZS5vcy5idWlsZCA9IGRldmljZV9yYXcuZ2V0KCdCdWlsZEV4dCcpIG9yIGRldmljZV9yYXcuZ2V0KCdCdWlsZDAxJykKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgbWFjX3RvdGFsID0gW10KICAgICAgICAgICAgICAgIGlwc190b3RhbCA9IFtdCiAgICAgICAgICAgICAgICBmb3IgbmljIGluIChkZXZpY2VfcmF3LmdldCgnTmV0d29yayBJbnRlcmZhY2VzJykgb3IgJycpLnNwbGl0KCc7Jyk6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBpZiBuaWMgPT0gJyc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZSAgIyBXZSBkb250IG5lZWQgZW1wdHkgbmljcyBvZiBjb3Vyc2UKICAgICAgICAgICAgICAgICAgICAgICAgbWFjLCBpcHMgPSBuaWMuc3BsaXQoJ0AnKQogICAgICAgICAgICAgICAgICAgICAgICBtYWMgPSBtYWMuc3RyaXAoKQogICAgICAgICAgICAgICAgICAgICAgICBpcHMgPSBbaXAuc3RyaXAoKSBmb3IgaXAgaW4gaXBzLnNwbGl0KCcsICcpXQogICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLl9fZXhjbHVkZV9pcHY2OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXBzID0gW2lwIGZvciBpcCBpbiBpcHMgaWYgbm90IGlzX3ZhbGlkX2lwdjYoaXApXQogICAgICAgICAgICAgICAgICAgICAgICBtYWNfdG90YWwuYXBwZW5kKG1hYykKICAgICAgICAgICAgICAgICAgICAgICAgaXBzX3RvdGFsLmV4dGVuZChpcHMpCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5hZGRfbmljKG1hYywgaXBzKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIHdpdGggbmljIHtuaWN9JykKICAgICAgICAgICAgICAgIGZvciBtYWMgaW4gKGRldmljZV9yYXcuZ2V0KCdNYWMgQWRkcmVzc2VzJykgb3IgJycpLnNwbGl0KCc7Jyk6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBtYWMgPSBtYWMuc3RyaXAoKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgbWFjIG9yIG1hYyBpbiBtYWNfdG90YWw6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICBlbGlmIG5vdCBtYWNfdG90YWw6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWNfdG90YWwuYXBwZW5kKG1hYykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5hZGRfbmljKG1hYywgTm9uZSkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5tYWNzX25vX2lwLmFwcGVuZChtYWMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEZpZWxkIHN0dWZmIEkgc2F3IHB1c2hlZCBtZSB0byB1c2UKICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIkNhdWdodCB3ZWlyZCBOSUMge21hY30gZm9yIGRldmljZSBpZCB7ZGV2aWNlLmlkfSIpCiAgICAgICAgICAgICAgICBpcHNfZW1wdHlfbWFjID0gW10KICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpcHNfcmF3ID0gKGRldmljZV9yYXcuZ2V0KCdJUCBBZGRyZXNzZXMnKSBvciAnJykuc3BsaXQoJzsnKQogICAgICAgICAgICAgICAgICAgIGZvciBpcF9yYXcgaW4gaXBzX3JhdzoKICAgICAgICAgICAgICAgICAgICAgICAgaXBzX2VtcHR5X21hYy5leHRlbmQoaXBfcmF3LnNwbGl0KCcsJykpCiAgICAgICAgICAgICAgICAgICAgICAgIGlwc19lbXB0eV9tYWMgPSBsaXN0KHNldChbaXAuc3RyaXAoKSBmb3IgaXAgaW4gaXBzX2VtcHR5X21hYyBpZiBpcC5zdHJpcCgpXSkpCiAgICAgICAgICAgICAgICAgICAgICAgIGlwc19lbXB0eV9tYWMgPSBsaXN0KHNldChpcHNfZW1wdHlfbWFjKSAtIHNldChpcHNfdG90YWwpKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLl9fZXhjbHVkZV9pcHY2OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXBzX2VtcHR5X21hYyA9IFtpcCBmb3IgaXAgaW4gaXBzX2VtcHR5X21hYyBpZiBub3QgaXNfdmFsaWRfaXB2NihpcCldCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5hZGRfbmljKE5vbmUsIGlwc19lbXB0eV9tYWMpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIGdldHRpbmcgSVAgZm9yIHtkZXZpY2VfcmF3fScpCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgZnJlZV9waHlzaWNhbF9tZW1vcnkgPSBkZXZpY2VfcmF3LmdldCgnRnJlZVBoeXNpY2FsTWVtb3J5MCcpCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlLmZyZWVfcGh5c2ljYWxfbWVtb3J5ID0gKAogICAgICAgICAgICAgICAgICAgICAgICBmbG9hdChmcmVlX3BoeXNpY2FsX21lbW9yeSkgLyAoMTAyNCAqKiAyKSBpZiBmcmVlX3BoeXNpY2FsX21lbW9yeSBlbHNlIE5vbmUKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgdG90YWxfcGh5c2ljYWxfbWVtb3J5ID0gZGV2aWNlX3Jhdy5nZXQoJ1RvdGFsUGh5c2ljYWxNZW1vcnkwJylcCiAgICAgICAgICAgICAgICAgICAgICAgIG9yIHJhbV9kaWN0LmdldChkZXZpY2VfcmF3LmdldCgnUmVzb3VyY2VJRCcpKQogICAgICAgICAgICAgICAgICAgIGRldmljZS50b3RhbF9waHlzaWNhbF9tZW1vcnkgPSAoCiAgICAgICAgICAgICAgICAgICAgICAgIGZsb2F0KHRvdGFsX3BoeXNpY2FsX21lbW9yeSkgLyAoMTAyNCAqKiAxKSBpZiB0b3RhbF9waHlzaWNhbF9tZW1vcnkgZWxzZSBOb25lCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIGlmIHRvdGFsX3BoeXNpY2FsX21lbW9yeSBhbmQgZnJlZV9waHlzaWNhbF9tZW1vcnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5waHlzaWNhbF9tZW1vcnlfcGVyY2VudGFnZSA9IDEwMCAqICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEgLSBkZXZpY2UuZnJlZV9waHlzaWNhbF9tZW1vcnkgLyBkZXZpY2UudG90YWxfcGh5c2ljYWxfbWVtb3J5CiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihmJ3Byb2JsZW0gYWRkaW5nIG1lbW9yeSBzdHVmZiB0byB7ZGV2aWNlX3Jhd30nKQogICAgICAgICAgICAgICAgZGV2aWNlX21hbnVmYWN0dXJlciA9IE5vbmUKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGFzc2V0X2Jpb3NfZGljdC5nZXQoZGV2aWNlX3Jhdy5nZXQoJ1Jlc291cmNlSUQnKSksIGRpY3QpOgogICAgICAgICAgICAgICAgICAgICAgICBiaW9zX2RhdGEgPSBhc3NldF9iaW9zX2RpY3QuZ2V0KGRldmljZV9yYXcuZ2V0KCdSZXNvdXJjZUlEJykpCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5iaW9zX3NlcmlhbCA9IGJpb3NfZGF0YS5nZXQoJ1NlcmlhbE51bWJlcjAnKQogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VfbWFudWZhY3R1cmVyID0gYmlvc19kYXRhLmdldCgnTWFudWZhY3R1cmVyMCcpCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5kZXZpY2VfbWFudWZhY3R1cmVyID0gZGV2aWNlX21hbnVmYWN0dXJlcgogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnUHJvYmxlbSBnZXR0aW5nIGJpb3MgZGF0YSBkb3Ige2RldmljZV9yYXd9JykKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGNvbXBsaWFuY2VfZGljdC5nZXQoZGV2aWNlX3Jhdy5nZXQoJ1Jlc291cmNlSUQnKSksIGRpY3QpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21wbGlhbmNlX2RhdGEgPSBjb21wbGlhbmNlX2RpY3QuZ2V0KGRldmljZV9yYXcuZ2V0KCdSZXNvdXJjZUlEJykpCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5jb21wbGlhbmNlX3N0YXR1cyA9IGNvbXBsaWFuY2VfZGF0YS5nZXQoJ1N0YXR1cycpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIGdldHRpbmcgYmlvcyBkYXRhIGRvciB7ZGV2aWNlX3Jhd30nKQogICAgICAgICAgICAgICAgZGV2aWNlLnNjY21fdHlwZSA9IGNvbXB1dGVyX2RhdGEuZ2V0KCdTeXN0ZW1UeXBlMCcpCiAgICAgICAgICAgICAgICBwcm9kdWN0X3R5cGVfZGljdCA9IHsnMSc6ICdXT1JLU1RBVElPTicsICcyJzogJ0RPTUFJTiBDT05UUk9MTEVSJywgJzMnOiAnU0VSVkVSJ30KICAgICAgICAgICAgICAgIGRldmljZS5zY2NtX3Byb2R1Y3RfdHlwZSA9IHByb2R1Y3RfdHlwZV9kaWN0LmdldChzdHIoZGV2aWNlX3Jhdy5nZXQoJ1Byb2R1Y3RUeXBlMCcpKSkKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGFzc2V0X3RvcF9kaWN0LmdldChkZXZpY2VfcmF3LmdldCgnUmVzb3VyY2VJRCcpKSwgZGljdCk6CiAgICAgICAgICAgICAgICAgICAgICAgIHRvcF9kYXRhID0gYXNzZXRfdG9wX2RpY3QuZ2V0KGRldmljZV9yYXcuZ2V0KCdSZXNvdXJjZUlEJykpCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS50b3BfdXNlciA9IHRvcF9kYXRhLmdldCgnVG9wQ29uc29sZVVzZXIwJykKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihmJ1Byb2JsZW0gZ2V0dGluZyB0b3AgdXNlciBkYXRhIGRvciB7ZGV2aWNlX3Jhd30nKQoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKG5ldHdvcmtfZHJpdmVyc19kaWN0LmdldChkZXZpY2VfcmF3LmdldCgnUmVzb3VyY2VJRCcpKSwgbGlzdCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBuZXR3b3JrX2RyaXZlcnNfZGF0YSBpbiBuZXR3b3JrX2RyaXZlcnNfZGljdC5nZXQoZGV2aWNlX3Jhdy5nZXQoJ1Jlc291cmNlSUQnKSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJpdmVyX25hbWUgPSBuZXR3b3JrX2RyaXZlcnNfZGF0YS5nZXQoJ25hbWUwJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcml2ZXJfZGVzY3JpcHRpb24gPSBuZXR3b3JrX2RyaXZlcnNfZGF0YS5nZXQoJ0RyaXZlckRlc2MwJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcml2ZXJfdmVyc2lvbiA9IG5ldHdvcmtfZHJpdmVyc19kYXRhLmdldCgnRHJpdmVyVmVyc2lvbjAnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyaXZlcl9wcm92aWRlciA9IG5ldHdvcmtfZHJpdmVyc19kYXRhLmdldCgnUHJvdmlkZXJOYW1lMCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJpdmVyX2RhdGUgPSBwYXJzZV9kYXRlKG5ldHdvcmtfZHJpdmVyc19kYXRhLmdldCgnRHJpdmVyRGF0ZTAnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2UubmV0d29ya19kcml2ZXJzX2RhdGEuYXBwZW5kKERyaXZlckRhdGEoZHJpdmVyX25hbWU9ZHJpdmVyX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyaXZlcl9kZXNjcmlwdGlvbj1kcml2ZXJfZGVzY3JpcHRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyaXZlcl92ZXJzaW9uPWRyaXZlcl92ZXJzaW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcml2ZXJfcHJvdmlkZXI9ZHJpdmVyX3Byb3ZpZGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcml2ZXJfZGF0ZT1kcml2ZXJfZGF0ZSkpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnUHJvYmxlbSB3aXRoIGRyaXZlcnMgZGF0YSB7bmV0d29ya19kcml2ZXJzX2RhdGF9JykKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihmJ1Byb2JsZW0gZ2V0dGluZyBkcml2ZXJzIGRhdGEgZG9yIHtkZXZpY2VfcmF3fScpCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoZHJpdmVyc19kaWN0LmdldChkZXZpY2VfcmF3LmdldCgnUmVzb3VyY2VJRCcpKSwgbGlzdCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBkcml2ZXJzX2RhdGEgaW4gZHJpdmVyc19kaWN0LmdldChkZXZpY2VfcmF3LmdldCgnUmVzb3VyY2VJRCcpKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcml2ZXJfbmFtZSA9IGRyaXZlcnNfZGF0YS5nZXQoJ05hbWUwJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcml2ZXJfZGVzY3JpcHRpb24gPSBkcml2ZXJzX2RhdGEuZ2V0KCdEZXNjcmlwdGlvbjAnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyaXZlcl92ZXJzaW9uID0gZHJpdmVyc19kYXRhLmdldCgnRHJpdmVyVmVyc2lvbjAnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5kcml2ZXJzX2RhdGEuYXBwZW5kKERyaXZlckRhdGEoZHJpdmVyX25hbWU9ZHJpdmVyX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcml2ZXJfZGVzY3JpcHRpb249ZHJpdmVyX2Rlc2NyaXB0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJpdmVyX3ZlcnNpb249ZHJpdmVyX3ZlcnNpb24pKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihmJ1Byb2JsZW0gd2l0aCBkcml2ZXJzIGRhdGEge2RyaXZlcnNfZGF0YX0nKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnUHJvYmxlbSBnZXR0aW5nIGRyaXZlcnMgZGF0YSBkb3Ige2RldmljZV9yYXd9JykKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShsb2NhbF9hZG1pbnNfZGljdC5nZXQoZGV2aWNlX3Jhdy5nZXQoJ1Jlc291cmNlSUQnKSksIGxpc3QpOgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgbG9jYWxfYWRtaW5fZGF0YSBpbiBsb2NhbF9hZG1pbnNfZGljdC5nZXQoZGV2aWNlX3Jhdy5nZXQoJ1Jlc291cmNlSUQnKSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9sb2NhbF9hZG1pbiA9IGxvY2FsX2FkbWluX2RhdGEuZ2V0KCdhY2NvdW50MCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9tYWluX2xvY2FsX2FkbWluID0gbG9jYWxfYWRtaW5fZGF0YS5nZXQoJ2RvbWFpbjAnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkbWluX3R5cGUgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbG9jYWxfYWRtaW5fZGF0YS5nZXQoJ3R5cGUwJykgPT0gJ1VzZXJBY2NvdW50JzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRtaW5fdHlwZSA9ICdBZG1pbiBVc2VyJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxvY2FsX2FkbWluX2RhdGEuZ2V0KCd0eXBlMCcpID09ICdHcm91cCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkbWluX3R5cGUgPSAnR3JvdXAgTWVtYmVyc2hpcCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpc19kb21haW5fdmFsaWQoZG9tYWluX2xvY2FsX2FkbWluKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJy4nIG5vdCBpbiBkb21haW5fbG9jYWxfYWRtaW46CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX2xvY2FsX2FkbWluID0gZid7ZG9tYWluX2xvY2FsX2FkbWlufVxce3VzZXJfbG9jYWxfYWRtaW59JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9sb2NhbF9hZG1pbiA9IGYne3VzZXJfbG9jYWxfYWRtaW59QHtkb21haW5fbG9jYWxfYWRtaW59JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5hZGRfbG9jYWxfYWRtaW4oYWRtaW5fbmFtZT11c2VyX2xvY2FsX2FkbWluLCBhZG1pbl90eXBlPWFkbWluX3R5cGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIHdpdGggbG9jYWwgYWRtaW4gZGF0YSB7bG9jYWxfYWRtaW5fZGF0YX0nKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnUHJvYmxlbSBnZXR0aW5nIHZtIGRhdGEgZG9yIHtkZXZpY2VfcmF3fScpCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShuaWNzX2RpY3QuZ2V0KGRldmljZV9yYXcuZ2V0KCdSZXNvdXJjZUlEJykpLCBsaXN0KToKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIG5pY19kYXRhIGluIG5pY3NfZGljdC5nZXQoZGV2aWNlX3Jhdy5nZXQoJ1Jlc291cmNlSUQnKSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFjID0gbmljX2RhdGEuZ2V0KCdNQUNBZGRyZXNzMCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXBzID0gbmljX2RhdGEuZ2V0KCdJUEFkZHJlc3MwJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBtYWM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hYyA9IG1hYy5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFjID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlwczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXBzID0gW2lwLnN0cmlwKCkgZm9yIGlwIGluIGlwcy5zcGxpdCgnLCcpXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlwcyA9IFtdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5fX2V4Y2x1ZGVfaXB2NjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXBzID0gW2lwIGZvciBpcCBpbiBpcHMgaWYgbm90IGlzX3ZhbGlkX2lwdjYoaXApXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlwczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlLmFkZF9uaWMobWFjLCBpcHMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBtYWM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5tYWNzX25vX2lwLmFwcGVuZChtYWMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIHdpdGggbmljIGRhdGEge25pY19kYXRhfScpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIGdldHRpbmcgdm0gZGF0YSBkb3Ige2RldmljZV9yYXd9JykKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShhc3NldF92bV9kaWN0LmdldChkZXZpY2VfcmF3LmdldCgnUmVzb3VyY2VJRCcpKSwgbGlzdCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciB2bV9kYXRhIGluIGFzc2V0X3ZtX2RpY3QuZ2V0KGRldmljZV9yYXcuZ2V0KCdSZXNvdXJjZUlEJykpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtX2Ruc19uYW1lID0gdm1fZGF0YS5nZXQoJ0ROU05hbWUwJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bV9pcCA9IHZtX2RhdGEuZ2V0KCdJUEFkZHJlc3MwJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bV9zdGF0ZSA9IHZtX2RhdGEuZ2V0KCdTdGF0ZTAnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtX25hbWUgPSB2bV9kYXRhLmdldCgnVk1OYW1lMCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm1fcGF0aCA9IHZtX2RhdGEuZ2V0KCdQYXRoMCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm1fdHlwZSA9IHZtX2RhdGEuZ2V0KCdUeXBlMCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm1fdGltZXN0YW1wID0gdm1fZGF0YS5nZXQoJ1RpbWVTdGFtcCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlLmFkZF9zY2NtX3ZtKHZtX2Ruc19uYW1lPXZtX2Ruc19uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bV9pcD12bV9pcCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm1fc3RhdGU9dm1fc3RhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtX25hbWU9dm1fbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm1fcGF0aD12bV9wYXRoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bV90eXBlPXZtX3R5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtX3RpbWVzdGFtcD12bV90aW1lc3RhbXApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIHdpdGggdm1fZGF0YSB7dm1fZGF0YX0nKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnUHJvYmxlbSBnZXR0aW5nIHZtIGRhdGEgZG9yIHtkZXZpY2VfcmF3fScpCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UodHBtX2RpY3QuZ2V0KGRldmljZV9yYXcuZ2V0KCdSZXNvdXJjZUlEJykpLCBkaWN0KToKICAgICAgICAgICAgICAgICAgICAgICAgdHBtX2RhdGEgPSB0cG1fZGljdC5nZXQoZGV2aWNlX3Jhdy5nZXQoJ1Jlc291cmNlSUQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlLnRwbV9pc19hY3RpdmF0ZWQgPSB0cG1fZGF0YS5nZXQoJ0lzQWN0aXZhdGVkX0luaXRpYWxWYWx1ZTAnKSA9PSAxCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS50cG1faXNfZW5hYmxlZCA9IHRwbV9kYXRhLmdldCgnSXNFbmFibGVkX0luaXRpYWxWYWx1ZTAnKSA9PSAxCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS50cG1faXNfb3duZWQgPSB0cG1fZGF0YS5nZXQoJ0lzT3duZWRfSW5pdGlhbFZhbHVlMCcpID09IDEKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihmJ1Byb2JsZW0gZ2V0dGluZyB0cG0gZGF0YSBkb3Ige2RldmljZV9yYXd9JykKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKG93bmVyX2RpY3QuZ2V0KGRldmljZV9yYXcuZ2V0KCdSZXNvdXJjZUlEJykpLCBkaWN0KToKICAgICAgICAgICAgICAgICAgICAgICAgb3duZXJfZGF0YSA9IG93bmVyX2RpY3QuZ2V0KGRldmljZV9yYXcuZ2V0KCdSZXNvdXJjZUlEJykpCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5vd25lciA9IG93bmVyX2RhdGEuZ2V0KCdPd25lcjAwJykKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlLmRlcGFydG1lbnQgPSBvd25lcl9kYXRhLmdldCgnRGVwYXJ0bWVudDAwJykKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlLnB1cnBvc2UgPSBvd25lcl9kYXRhLmdldCgnUHVycG9zZTAwJykKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihmJ1Byb2JsZW0gZ2V0dGluZyBvd25lciBkYXRhIGRvciB7ZGV2aWNlX3Jhd30nKQoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGNsaWVudHNfZGljdC5nZXQoZGV2aWNlX3Jhdy5nZXQoJ1Jlc291cmNlSUQnKSksIGRpY3QpOgogICAgICAgICAgICAgICAgICAgICAgICBjbGllbnRfZGF0YSA9IGNsaWVudHNfZGljdC5nZXQoZGV2aWNlX3Jhdy5nZXQoJ1Jlc291cmNlSUQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdF9zZWVuID0gcGFyc2VfZGF0ZShjbGllbnRfZGF0YS5nZXQoJ0xhc3RBY3RpdmVUaW1lJykpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuX19kcm9wX25vX2xhc3Rfc2VlbiBpcyBUcnVlIGFuZCBub3QgbGFzdF9zZWVuOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlLmxhc3Rfc2VlbiA9IGxhc3Rfc2VlbgogICAgICAgICAgICAgICAgICAgIGVsaWYgc2VsZi5fX2Ryb3Bfbm9fbGFzdF9zZWVuIGlzIFRydWU6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIGdldHRpbmcgbGFzdCBzZWVuIGRhdGEgZG9yIHtkZXZpY2VfcmF3fScpCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoYXNzZXRfY2hhc2lzX2RpY3QuZ2V0KGRldmljZV9yYXcuZ2V0KCdSZXNvdXJjZUlEJykpLCBkaWN0KToKICAgICAgICAgICAgICAgICAgICAgICAgY2hhc2lzX2RhdGEgPSBhc3NldF9jaGFzaXNfZGljdC5nZXQoZGV2aWNlX3Jhdy5nZXQoJ1Jlc291cmNlSUQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgY2hhc2lzX3R5cGVzID0gY2hhc2lzX2RhdGEuZ2V0KCdDaGFzc2lzVHlwZXMwJykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2hhc2lzX3R5cGVzIGFuZCBpc2luc3RhbmNlKGNoYXNpc190eXBlcywgc3RyKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5jaGFzaXNfdmFsdWUgPSBDSEFTSVNfVkFMVUVfRlVMTF9ESUNULmdldChjaGFzaXNfdHlwZXMpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoYXNpc190eXBlcyBhbmQgc3RyKGNoYXNpc190eXBlcykgaW4gREVTS1RPUF9DSEFTSVNfVkFMVUU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2UuZGVza3RvcF9vcl9sYXB0b3AgPSAnRGVza3RvcCcKICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBjaGFzaXNfdHlwZXMgYW5kIHN0cihjaGFzaXNfdHlwZXMpIGluIExBUFRPUF9DSEFTSVNfVkFMVUU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2UuZGVza3RvcF9vcl9sYXB0b3AgPSAnTGFwdG9wJwogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnUHJvYmxlbSBnZXR0aW5nIGNoYXNpcyBkYXRhIGRvciB7ZGV2aWNlX3Jhd30nKQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoYXNzZXRfbWFsd2FyZV9kaWN0LmdldChkZXZpY2VfcmF3LmdldCgnUmVzb3VyY2VJRCcpKSwgZGljdCk6CiAgICAgICAgICAgICAgICAgICAgICAgIG1hbHdhcmVfZGF0YSA9IGFzc2V0X21hbHdhcmVfZGljdC5nZXQoZGV2aWNlX3Jhdy5nZXQoJ1Jlc291cmNlSUQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlLm1hbHdhcmVfZW5naW5lX3ZlcnNpb24gPSBtYWx3YXJlX2RhdGEuZ2V0KCdFbmdpbmVWZXJzaW9uJykKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlLm1hbHdhcmVfdmVyc2lvbiA9IG1hbHdhcmVfZGF0YS5nZXQoJ1ZlcnNpb24nKQogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2UubWFsd2FyZV9wcm9kdWN0X3N0YXR1cyA9IG1hbHdhcmVfZGF0YS5nZXQoJ1Byb2R1Y3RTdGF0dXMnKQogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2UubWFsd2FyZV9sYXN0X2Z1bGxfc2NhbiA9IHBhcnNlX2RhdGUobWFsd2FyZV9kYXRhLmdldCgnTGFzdEZ1bGxTY2FuRGF0ZVRpbWVFbmQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlLm1hbHdhcmVfbGFzdF9xdWlja19zY2FuID0gcGFyc2VfZGF0ZShtYWx3YXJlX2RhdGEuZ2V0KCdMYXN0UXVpY2tTY2FuRGF0ZVRpbWVFbmQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlLm1hbHdhcmVfZW5hYmxlZCA9IG1hbHdhcmVfZGF0YS5nZXQoJ0VuYWJsZWQnKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnUHJvYmxlbSBnZXR0aW5nIG1hbHdhcmUgZGF0YSBkb3Ige2RldmljZV9yYXd9JykKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBub3QgZGV2aWNlX21hbnVmYWN0dXJlciBvciAnTEVOT1ZPJyBub3QgaW4gZGV2aWNlX21hbnVmYWN0dXJlci51cHBlcigpOgogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2UuZGV2aWNlX21vZGVsID0gY29tcHV0ZXJfZGF0YS5nZXQoJ01vZGVsMCcpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBpc2luc3RhbmNlKGFzc2V0X2xlbm92b19kaWN0LmdldChkZXZpY2VfcmF3LmdldCgnUmVzb3VyY2VJRCcpKSwgZGljdCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5kZXZpY2VfbW9kZWwgPSBhc3NldF9sZW5vdm9fZGljdC5nZXQoZGV2aWNlX3Jhdy5nZXQoJ1Jlc291cmNlSUQnKSkuZ2V0KCdWZXJzaW9uMCcpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIGdldHRpbmcgbW9kZWwgZm9yIHtkZXZpY2VfcmF3fScpCiAgICAgICAgICAgICAgICBwcm9jZXNzZXMgPSBjb21wdXRlcl9kYXRhLmdldCgnTnVtYmVyT2ZQcm9jZXNzZXMwJykKICAgICAgICAgICAgICAgIGRldmljZS5udW1iZXJfb2ZfcHJvY2Vzc2VzID0gaW50KHByb2Nlc3NlcykgaWYgcHJvY2Vzc2VzIGVsc2UgTm9uZQogICAgICAgICAgICAgICAgcHJvY2Vzc29ycyA9IGNvbXB1dGVyX2RhdGEuZ2V0KCdOdW1iZXJPZlByb2Nlc3NvcnMwJykKICAgICAgICAgICAgICAgIGRldmljZS50b3RhbF9udW1iZXJfb2ZfcGh5c2ljYWxfcHJvY2Vzc29ycyA9IGludChwcm9jZXNzb3JzKSBpZiBwcm9jZXNzb3JzIGVsc2UgTm9uZQogICAgICAgICAgICAgICAgZGV2aWNlLmN1cnJlbnRfbG9nZ2VkX3VzZXIgPSBjb21wdXRlcl9kYXRhLmdldCgnVXNlck5hbWUwJykgb3IgZGV2aWNlX3Jhdy5nZXQoJ1VzZXJfTmFtZTAnKQogICAgICAgICAgICAgICAgZGV2aWNlLnRpbWVfem9uZSA9IGNvbXB1dGVyX2RhdGEuZ2V0KCdDdXJyZW50VGltZVpvbmUwJykKICAgICAgICAgICAgICAgIGlmIG9zX2RhdGEuZ2V0KCdMYXN0Qm9vdFVwVGltZTAnKToKICAgICAgICAgICAgICAgICAgICBkZXZpY2Uuc2V0X2Jvb3RfdGltZShib290X3RpbWU9b3NfZGF0YS5nZXQoJ0xhc3RCb290VXBUaW1lMCcpKQoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKG5ld19zb2Z0d2FyZV9kaWN0LmdldChkZXZpY2VfcmF3LmdldCgnUmVzb3VyY2VJRCcpKSwgbGlzdCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBuZXdfYXNzZXRfZGF0YSBpbiBuZXdfc29mdHdhcmVfZGljdC5nZXQoZGV2aWNlX3Jhdy5nZXQoJ1Jlc291cmNlSUQnKSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlLmFkZF9pbnN0YWxsZWRfc29mdHdhcmUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU9bmV3X2Fzc2V0X2RhdGEuZ2V0KCdQcm9kdWN0TmFtZScpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uPW5ld19hc3NldF9kYXRhLmdldCgnUHJvZHVjdFZlcnNpb24nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVuZG9yPW5ld19hc3NldF9kYXRhLmdldCgnQ29tcGFueU5hbWUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihmJ1Byb2JsZW0gYWRkaW5nIG5ldyBzdyBhc3NldCB7bmV3X2Fzc2V0X2RhdGF9JykKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihmJ1Byb2JsZW0gYWRkaW5nIHNvZnR3YXJlIHRvIHtkZXZpY2VfcmF3fScpCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoYXNzZXRfc29mdHdhcmVfZGljdC5nZXQoZGV2aWNlX3Jhdy5nZXQoJ1Jlc291cmNlSUQnKSksIGxpc3QpOgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgYXNzZXRfZGF0YSBpbiBhc3NldF9zb2Z0d2FyZV9kaWN0LmdldChkZXZpY2VfcmF3LmdldCgnUmVzb3VyY2VJRCcpKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2UuYWRkX2luc3RhbGxlZF9zb2Z0d2FyZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZT1hc3NldF9kYXRhLmdldCgnUHJvZHVjdE5hbWUwJyksIHZlcnNpb249YXNzZXRfZGF0YS5nZXQoJ1Byb2R1Y3RWZXJzaW9uMCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnUHJvYmxlbSBhZGRpbmcgYXNzZXQge2Fzc2V0X2RhdGF9JykKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihmJ1Byb2JsZW0gYWRkaW5nIHNvZnR3YXJlIHRvIHtkZXZpY2VfcmF3fScpCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoYXNzZXRfcHJvZ3JhbV9kaWN0LmdldChkZXZpY2VfcmF3LmdldCgnUmVzb3VyY2VJRCcpKSwgbGlzdCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBhc3NldF9kYXRhIGluIGFzc2V0X3Byb2dyYW1fZGljdC5nZXQoZGV2aWNlX3Jhdy5nZXQoJ1Jlc291cmNlSUQnKSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlLmFkZF9pbnN0YWxsZWRfc29mdHdhcmUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU9YXNzZXRfZGF0YS5nZXQoJ0Rpc3BsYXlOYW1lMCcpLCB2ZXJzaW9uPWFzc2V0X2RhdGEuZ2V0KCdWZXJzaW9uMCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnUHJvYmxlbSBhZGRpbmcgYXNzZXQge2Fzc2V0X2RhdGF9JykKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihmJ1Byb2JsZW0gYWRkaW5nIHByb2dyYW0gdG8ge2RldmljZV9yYXd9JykKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShhc3NldF9wYXRjaF9kaWN0LmdldChkZXZpY2VfcmF3LmdldCgnUmVzb3VyY2VJRCcpKSwgbGlzdCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBwYXRjaF9kYXRhIGluIGFzc2V0X3BhdGNoX2RpY3QuZ2V0KGRldmljZV9yYXcuZ2V0KCdSZXNvdXJjZUlEJykpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGNoX2Rlc2NyaXB0aW9uID0gcGF0Y2hfZGF0YS5nZXQoJ0Rlc2NyaXB0aW9uMCcpIG9yICcnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcGF0Y2hfZGF0YS5nZXQoJ0ZpeENvbW1lbnRzMCcpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRjaF9kZXNjcmlwdGlvbiArPSAnIEhvdGZpeCBDb21tZW50czonICsgcGF0Y2hfZGF0YS5nZXQoJ0ZpeENvbW1lbnRzMCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHBhdGNoX2Rlc2NyaXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRjaF9kZXNjcmlwdGlvbiA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0YWxsZWRfb24gPSBwYXJzZV9kYXRlKHBhdGNoX2RhdGEuZ2V0KCdJbnN0YWxsRGF0ZTAnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2UuYWRkX3NlY3VyaXR5X3BhdGNoKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWN1cml0eV9wYXRjaF9pZD1wYXRjaF9kYXRhLmdldCgnSG90Rml4SUQwJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGNoX2Rlc2NyaXB0aW9uPXBhdGNoX2Rlc2NyaXB0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0YWxsZWRfb249aW5zdGFsbGVkX29uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihmJ1Byb2JsZW0gYWRkaW5nIHBhdGNoIHtwYXRjaF9kYXRhfScpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIGFkZGluZyBwYXRjaCB0byB7ZGV2aWNlX3Jhd30nKQoKICAgICAgICAgICAgICAgIGRldmljZS5zZXRfcmF3KGRldmljZV9yYXcpCiAgICAgICAgICAgICAgICB5aWVsZCBkZXZpY2UKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZiJQcm9ibGVtIHdpdGggZGV2aWNlOiB7ZGV2aWNlX3Jhd30iKQoKICAgIGRlZiBfY29ycmVsYXRpb25fY21kcyhzZWxmKToKICAgICAgICBsb2dnZXIuZXJyb3IoImNvcnJlbGF0aW9uX2NtZHMgaXMgbm90IGltcGxlbWVudGVkIGZvciBzY2NtIGFkYXB0ZXIiKQogICAgICAgIHJhaXNlIE5vdEltcGxlbWVudGVkRXJyb3IoImNvcnJlbGF0aW9uX2NtZHMgaXMgbm90IGltcGxlbWVudGVkIGZvciBzY2NtIGFkYXB0ZXIiKQoKICAgIGRlZiBfcGFyc2VfY29ycmVsYXRpb25fcmVzdWx0cyhzZWxmLCBjb3JyZWxhdGlvbl9jbWRfcmVzdWx0LCBvc190eXBlKToKICAgICAgICBsb2dnZXIuZXJyb3IoIl9wYXJzZV9jb3JyZWxhdGlvbl9yZXN1bHRzIGlzIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2NjbSBhZGFwdGVyIikKICAgICAgICByYWlzZSBOb3RJbXBsZW1lbnRlZEVycm9yKCJfcGFyc2VfY29ycmVsYXRpb25fcmVzdWx0cyBpcyBub3QgaW1wbGVtZW50ZWQgZm9yIHNjY20gYWRhcHRlciIpCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgYWRhcHRlcl9wcm9wZXJ0aWVzKGNscyk6CiAgICAgICAgcmV0dXJuIFtBZGFwdGVyUHJvcGVydHkuQWdlbnRdCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgX2RiX2NvbmZpZ19zY2hlbWEoY2xzKSAtPiBkaWN0OgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJpdGVtcyI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAnbmFtZSc6ICdleGNsdWRlX2lwdjYnLAogICAgICAgICAgICAgICAgICAgICd0aXRsZSc6ICdFeGNsdWRlIElQdjYgYWRkcmVzc2VzJywKICAgICAgICAgICAgICAgICAgICAndHlwZSc6ICdib29sJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAnbmFtZSc6ICdkcm9wX25vX2xhc3Rfc2VlbicsCiAgICAgICAgICAgICAgICAgICAgJ3RpdGxlJzogJ0RvIG5vdCBmZXRjaCBkZXZpY2VzIHdpdGhvdXQgXCdMYXN0IFNlZW5cJycsCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnOiAnYm9vbCcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJ25hbWUnOiAnZGV2aWNlc19mZXRjaGVkX2F0X2FfdGltZScsCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnOiAnaW50ZWdlcicsCiAgICAgICAgICAgICAgICAgICAgJ3RpdGxlJzogJ1NRTCBwYWdpbmF0aW9uJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAnbmFtZSc6ICdtYWNoaW5lX2RvbWFpbl93aGl0ZWxpc3QnLAogICAgICAgICAgICAgICAgICAgICd0aXRsZSc6ICdNYWNoaW5lIGRvbWFpbiB3aGl0ZWxpc3QnLAogICAgICAgICAgICAgICAgICAgICd0eXBlJzogJ3N0cmluZycKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSwKICAgICAgICAgICAgInJlcXVpcmVkIjogWydkcm9wX25vX2xhc3Rfc2VlbicsICdleGNsdWRlX2lwdjYnLCAnZGV2aWNlc19mZXRjaGVkX2F0X2FfdGltZSddLAogICAgICAgICAgICAicHJldHR5X25hbWUiOiAiU0NDTSBDb25maWd1cmF0aW9uIiwKICAgICAgICAgICAgInR5cGUiOiAiYXJyYXkiCiAgICAgICAgfQoKICAgIEBjbGFzc21ldGhvZAogICAgZGVmIF9kYl9jb25maWdfZGVmYXVsdChjbHMpOgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICdleGNsdWRlX2lwdjYnOiBGYWxzZSwKICAgICAgICAgICAgJ2Ryb3Bfbm9fbGFzdF9zZWVuJzogRmFsc2UsCiAgICAgICAgICAgICdkZXZpY2VzX2ZldGNoZWRfYXRfYV90aW1lJzogMTAwMCwKICAgICAgICAgICAgJ21hY2hpbmVfZG9tYWluX3doaXRlbGlzdCc6IE5vbmUKICAgICAgICB9CgogICAgZGVmIF9vbl9jb25maWdfdXBkYXRlKHNlbGYsIGNvbmZpZyk6CiAgICAgICAgc2VsZi5fX2V4Y2x1ZGVfaXB2NiA9IGNvbmZpZ1snZXhjbHVkZV9pcHY2J10KICAgICAgICBzZWxmLl9fZGV2aWNlc19mZXRjaGVkX2F0X2FfdGltZSA9IGNvbmZpZ1snZGV2aWNlc19mZXRjaGVkX2F0X2FfdGltZSddCiAgICAgICAgc2VsZi5fX2Ryb3Bfbm9fbGFzdF9zZWVuID0gY29uZmlnLmdldCgnZHJvcF9ub19sYXN0X3NlZW4nKSBvciBGYWxzZQogICAgICAgIHNlbGYuX19tYWNoaW5lX2RvbWFpbl93aGl0ZWxpc3QgPSBjb25maWcuZ2V0KCdtYWNoaW5lX2RvbWFpbl93aGl0ZWxpc3QnKS5sb3dlcigpLnNwbGl0KCcsJykgXAogICAgICAgICAgICBpZiBjb25maWcuZ2V0KCdtYWNoaW5lX2RvbWFpbl93aGl0ZWxpc3QnKSBlbHNlIE5vbmUK',
    f'{CORTEX}/adapters/sccm_adapter/consts.py': b'UEFTU1dPUkQgPSAncGFzc3dvcmQnClVTRVIgPSAndXNlcm5hbWUnClNDQ01fSE9TVCA9ICdzZXJ2ZXInClNDQ01fUE9SVCA9ICdwb3J0JwpTQ0NNX0RBVEFCQVNFID0gJ2RhdGFiYXNlJwpEUklWRVIgPSAnZHJpdmVyJwpERUZBVUxUX1NDQ01fUE9SVCA9IDE0MzMKREVWSUNFU19GRVRFQ0hFRF9BVF9BX1RJTUUgPSAnZGV2aWNlc19mZXRjaGVkX2F0X2FfdGltZScKU0NDTV9RVUVSWSA9ICIiIgpTRUxFQ1QgKiwKICAgICAgICBbTmV0d29yayBJbnRlcmZhY2VzXSA9IFNUVUZGKChTRUxFQ1QgJzsnICsgcmFzaS5NQUNBZGRyZXNzMCArICdAJyArIHJhc2kuSVBBZGRyZXNzMAogICAgICAgICAgICAgICAgRlJPTSB2X0dTX05FVFdPUktfQURBUFRFUl9DT05GSUdVUkFUSU9OIEFTIHJhc2kKICAgICAgICAgICAgICAgIFdIRVJFIHJhc2kuUmVzb3VyY2VJRCA9IFNZUy5SZXNvdXJjZUlECiAgICAgICAgICAgICAgICBGT1IgWE1MIFBBVEgsIFRZUEUpLnZhbHVlKE4nLlsxXScsTidudmFyY2hhcihtYXgpJyksMSwxLCcnKSwKICAgICAgICBbTWFjIEFkZHJlc3Nlc10gPSBTVFVGRigoU0VMRUNUICc7JyArIHJhc2kuTUFDQWRkcmVzczAKICAgICAgICAgICAgICAgIEZST00gdl9HU19ORVRXT1JLX0FEQVBURVJfQ09ORklHVVJBVElPTiBBUyByYXNpCiAgICAgICAgICAgICAgICBXSEVSRSByYXNpLlJlc291cmNlSUQgPSBTWVMuUmVzb3VyY2VJRAogICAgICAgICAgICAgICAgRk9SIFhNTCBQQVRILCBUWVBFKS52YWx1ZShOJy5bMV0nLE4nbnZhcmNoYXIobWF4KScpLDEsMSwnJyksCiAgICAgICAgW0lQIEFkZHJlc3Nlc10gPSBTVFVGRigoU0VMRUNUICc7JyArIHJhc2kuSVBBZGRyZXNzMAogICAgICAgICAgICAgICAgRlJPTSB2X0dTX05FVFdPUktfQURBUFRFUl9DT05GSUdVUkFUSU9OIEFTIHJhc2kKICAgICAgICAgICAgICAgIFdIRVJFIHJhc2kuUmVzb3VyY2VJRCA9IFNZUy5SZXNvdXJjZUlECiAgICAgICAgICAgICAgICBGT1IgWE1MIFBBVEgsIFRZUEUpLnZhbHVlKE4nLlsxXScsTidudmFyY2hhcihtYXgpJyksMSwxLCcnKSwKICAgICAgICBbTGFzdCBTZWVuXSA9IHZfQ0hfQ2xpZW50U3VtbWFyeS5MYXN0QWN0aXZlVGltZQpGUk9NIHZfUl9TWVNURU0gU1lTCkxFRlQgSk9JTiB2X0dTX0NPTVBVVEVSX1NZU1RFTSBvbiBTWVMuUmVzb3VyY2VJRCA9IHZfR1NfQ09NUFVURVJfU1lTVEVNLlJlc291cmNlSUQKTEVGVCBKT0lOIHZfQ0hfQ2xpZW50U3VtbWFyeSBvbiB2X0NIX0NsaWVudFN1bW1hcnkuUmVzb3VyY2VJRCA9IFNZUy5SZXNvdXJjZUlEIApMRUZUIEpPSU4gdl9HU19PUEVSQVRJTkdfU1lTVEVNIG9uIFNZUy5SZXNvdXJjZUlEID0gdl9HU19PUEVSQVRJTkdfU1lTVEVNLlJlc291cmNlSUQKezB9CiIiIgpMSU1JVF9TQ0NNX1FVRVJZID0gIiIiCldIRVJFIERBVEVESUZGKGRkLHZfQ0hfQ2xpZW50U3VtbWFyeS5MYXN0QWN0aXZlVGltZSxHRVREQVRFKCkpPHswfS8yNC4wOwoiIiIKClNDQ01fTUFJTl9RVUVSWSA9ICdTZWxlY3QgKiBmcm9tIHZfUl9TWVNURU0nCgpOSUNTX1FVRVJZID0gJ1NlbGVjdCBNQUNBZGRyZXNzMCwgSVBBZGRyZXNzMCwgUmVzb3VyY2VJRCBmcm9tIHZfR1NfTkVUV09SS19BREFQVEVSX0NPTkZJR1VSQVRJT04nCkNPTVBVVEVSX1NZU1RFTV9RVUVSWSA9ICdTZWxlY3QgUmVzb3VyY2VJRCwgQ2FwdGlvbjAsIE1vZGVsMCwgU3lzdGVtVHlwZTAsIFVzZXJOYW1lMCwgQ3VycmVudFRpbWVab25lMCBmcm9tIHZfR1NfQ09NUFVURVJfU1lTVEVNJwpDTElFTlRfU1VNTUFSWV9RVUVSWSA9ICdTZWxlY3QgUmVzb3VyY2VJRCwgTGFzdEFjdGl2ZVRpbWUgZnJvbSB2X0NIX0NsaWVudFN1bW1hcnknCk9TX0RBVEFfUVVFUlkgPSAnU2VsZWN0IFJlc291cmNlSUQsIExhc3RCb290VXBUaW1lMCBmcm9tIHZfR1NfT1BFUkFUSU5HX1NZU1RFTScKCgpRVUVSWV9TT0ZUV0FSRSA9ICdTZWxlY3QgUmVzb3VyY2VJRCwgUHJvZHVjdE5hbWUwLCBQcm9kdWN0VmVyc2lvbjAgZnJvbSB2X0dTX0lOU1RBTExFRF9TT0ZUV0FSRScKUVVFUllfUEFUQ0ggPSAnU2VsZWN0IFJlc291cmNlSUQsIERlc2NyaXB0aW9uMCwgRml4Q29tbWVudHMwLCBJbnN0YWxsRGF0ZTAsIEhvdEZpeElEMCBmcm9tIHZfR1NfUVVJQ0tfRklYX0VOR0lORUVSSU5HJwpRVUVSWV9QQVRDSF8yID0gJ1NlbGVjdCBSZXNvdXJjZUlELCBEZXNjcmlwdGlvbjAsIEZpeENvbW1lbnRzMCwgSW5zdGFsbERhdGUwLCBIb3RGaXhJRDAgZnJvbSB2X0hTX1FVSUNLX0ZJWF9FTkdJTkVFUklORycKUVVFUllfUFJPR1JBTSA9ICdTZWxlY3QgUmVzb3VyY2VJRCwgRGlzcGxheU5hbWUwLCBWZXJzaW9uMCBmcm9tIHZfR1NfQUREX1JFTU9WRV9QUk9HUkFNUycKUVVFUllfUFJPR1JBTV8yID0gJ1NlbGVjdCBSZXNvdXJjZUlELCBEaXNwbGF5TmFtZTAsIFZlcnNpb24wIGZyb20gdl9HU19BRERfUkVNT1ZFX1BST0dSQU1TXzY0JwpCSU9TX1FVRVJZID0gJ1NlbGVjdCBSZXNvdXJjZUlELCBTZXJpYWxOdW1iZXIwLCBNYW51ZmFjdHVyZXIwIGZyb20gdl9HU19QQ19CSU9TJwpVU0VSU19RVUVSWSA9ICdTZWxlY3QgTWFjaGluZVJlc291cmNlSUQsIFVuaXF1ZVVzZXJOYW1lIGZyb20gdl9Vc2VyTWFjaGluZVJlbGF0aW9uJwpVU0VSU19UT1BfUVVFUlkgPSAnU2VsZWN0IFJlc291cmNlSUQsIFRvcENvbnNvbGVVc2VyMCBmcm9tIHZfR1NfU1lTVEVNX0NPTlNPTEVfVVNBR0VfTUFYR1JPVVAnCk1BTFdBUkVfUVVFUlkgPSAnU2VsZWN0IFJlc291cmNlSUQsIEVuZ2luZVZlcnNpb24sIFZlcnNpb24sIExhc3RGdWxsU2NhbkRhdGVUaW1lRW5kLCAnIFwKICAgICAgICAgICAgICAgICdQcm9kdWN0U3RhdHVzLCBMYXN0UXVpY2tTY2FuRGF0ZVRpbWVFbmQsIEVuYWJsZWQgZnJvbSB2X0dTX0FudGltYWx3YXJlSGVhbHRoU3RhdHVzJwpMRU5PVk9fUVVFUlkgPSAnc2VsZWN0IFJlc291cmNlSUQsIFZlcnNpb24wIGZyb20gdl9HU19DT01QVVRFUl9TWVNURU1fUFJPRFVDVCcKQ0hBU0lTX1FVRVJZID0gJ3NlbGVjdCBSZXNvdXJjZUlELCBDaGFzc2lzVHlwZXMwIGZyb20gdl9HU19TWVNURU1fRU5DTE9TVVJFJwpFTkNSWVBUSU9OX1FVRVJZID0gJ3NlbGVjdCBSZXNvdXJjZUlELERyaXZlTGV0dGVyMCxQcm90ZWN0aW9uU3RhdHVzMCBmcm9tIHZfR1NfRU5DUllQVEFCTEVfVk9MVU1FJwpWTV9RVUVSWSA9ICdzZWxlY3QgUmVzb3VyY2VJRCwgJyBcCiAgICAgICAgICAgJ0ROU05hbWUwLCBJUEFkZHJlc3MwLCBTdGF0ZTAsIFZNTmFtZTAsIFBhdGgwLCBUeXBlMCwgVGltZVN0YW1wIGZyb20gVl9HU19WSVJUVUFMX01BQ0hJTkVTJwpPV05FUl9RVUVSWSA9ICdzZWxlY3QgKiBmcm9tIE9XTkVSSU5GT19EQVRBJwpUUE1fUVVFUlkgPSAnc2VsZWN0IFJlc291cmNlSUQsIElzQWN0aXZhdGVkX0luaXRpYWxWYWx1ZTAsIElzRW5hYmxlZF9Jbml0aWFsVmFsdWUwLCBJc093bmVkX0luaXRpYWxWYWx1ZTAgZnJvbSB2X0dTX1RQTScKQ09MTEVDVElPTlNfUVVFUlkgPSAnc2VsZWN0IFJlc291cmNlSUQsIENvbGxlY3Rpb25JRCBmcm9tIHZfRnVsbENvbGxlY3Rpb25NZW1iZXJzaGlwJwpDT0xMRUNUSU9OU19EQVRBX1FVRVJZID0gJ3NlbGVjdCBDb2xsZWN0aW9uSUQsIE5hbWUgZnJvbSB2X0NvbGxlY3Rpb24nCkNPTVBMSUFOQ0VfUVVFUlkgPSAnc2VsZWN0IFJlc291cmNlSUQsIFN0YXR1cyBmcm9tIHZfVXBkYXRlQ29tcGxpYW5jZVN0YXR1cycKTE9DQUxfQURNSU5fUVVFUlkgPSAnc2VsZWN0IFJlc291cmNlSUQsIG5hbWUwICwgYWNjb3VudDAsIGRvbWFpbjAgZnJvbSB2X2dzX2xvY2FsZ3JvdXBtZW1iZXJzMCcKRFJJVkVSU19RVUVSWSA9ICdzZWxlY3QgUmVzb3VyY2VJRCwgTmFtZTAsIERlc2NyaXB0aW9uMCwgRHJpdmVyVmVyc2lvbjAgZnJvbSB2X0dTX1ZJREVPX0NPTlRST0xMRVInClJBTV9RVUVSWSA9ICdzZWxlY3QgUmVzb3VyY2VJRCwgQ2FwYWNpdHkwIGZyb20gdl9HU19QSFlTSUNBTF9NRU1PUlknCk5FVFdPUktfRFJJVkVSU19RVUVSWSA9ICdzZWxlY3QgUmVzb3VyY2VJRCwgRHJpdmVyRGVzYzAsIERyaXZlclZlcnNpb24wICwgUHJvdmlkZXJOYW1lMCwgRHJpdmVyRGF0ZTAgZnJvbSB2X0dTX05FVFdPUktfRFJJVkVSUycKTkVXX1NPRlRXQVJFX1FVRVJZID0gJ3NlbGVjdCBSZXNvdXJjZUlELCBQcm9kdWN0TmFtZSwgUHJvZHVjdFZlcnNpb24gQ29tcGFueU5hbWUgZnJvbSB2X0dTX1NvZnR3YXJlUHJvZHVjdCcK',
    f'{CORTEX}/plugins/static_correlator/engine.py': b'aW1wb3J0IGxvZ2dpbmcKZnJvbSBjb2xsZWN0aW9ucyBpbXBvcnQgZGVmYXVsdGRpY3QKZnJvbSBpdGVydG9vbHMgaW1wb3J0IGNvbWJpbmF0aW9ucwoKZnJvbSBheG9uaXVzLmJsYWNrbGlzdHMgaW1wb3J0IEFMTF9CTEFDS0xJU1QsIEZST01fRklFTERTX0JMQUNLX0xJU1RfUkVHLCBjb21wYXJlX3JlZ19tYWMKZnJvbSBheG9uaXVzLmNvbnN0cy5wbHVnaW5fY29uc3RzIGltcG9ydCBQTFVHSU5fTkFNRSwgQUNUSVZFX0RJUkVDVE9SWV9QTFVHSU5fTkFNRQpmcm9tIGF4b25pdXMuY29ycmVsYXRvcl9iYXNlIGltcG9ydCAoaGFzX2FkX29yX2F6dXJlX25hbWUsIGhhc19jbG91ZF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc19ob3N0bmFtZSwgaGFzX2xhc3RfdXNlZF91c2VycywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc19tYWMsIGhhc19uYW1lLCBoYXNfc2VyaWFsLCBoYXNfbmVzc3VzX3NjYW5fbm9faWQsIGhhc19yZXNvdXJjZV9pZCkKZnJvbSBheG9uaXVzLmNvcnJlbGF0b3JfZW5naW5lX2Jhc2UgaW1wb3J0IChDb3JyZWxhdG9yRW5naW5lQmFzZSwgQ29ycmVsYXRpb25NYXJrZXIpCmZyb20gYXhvbml1cy5wbHVnaW5fYmFzZSBpbXBvcnQgUGx1Z2luQmFzZQpmcm9tIGF4b25pdXMudHlwZXMuY29ycmVsYXRpb24gaW1wb3J0IENvcnJlbGF0aW9uUmVhc29uCmZyb20gYXhvbml1cy51dGlscy5wYXJzaW5nIGltcG9ydCAoTk9STUFMSVpFRF9NQUNTLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2V0X2hvc3RuYW1lc19kb19ub3RfY29udHJhZGljdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wYXJlX2FkX25hbWVfb3JfYXp1cmVfZGlzcGxheV9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBhcmVfYXNzZXRfaG9zdHMsIGNvbXBhcmVfYXNzZXRfbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wYXJlX2Jpb3Nfc2VyaWFsX3NlcmlhbCwgY29tcGFyZV9jbG91ZHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGFyZV9kZXZpY2Vfbm9ybWFsaXplZF9ob3N0bmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wYXJlX2hvc3RuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBhcmVfbGFzdF91c2VkX3VzZXJzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldF9hZF9uYW1lX29yX2F6dXJlX2Rpc3BsYXlfbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRfYXNzZXRfbmFtZSwgZ2V0X2Fzc2V0X29yX2hvc3QsIGdldF9tYW51ZmFjdHVyZXJfZnJvbV9tYWMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0X2Fzc2V0X3Nub3dfb3JfaG9zdCwgY29tcGFyZV9zbm93X2Fzc2V0X2hvc3RzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldF9iaW9zX3NlcmlhbF9vcl9zZXJpYWwsIGdldF9jbG91ZF9kYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldF9ob3N0bmFtZSwgY29tcGFyZV9mdWxsX21hYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRfbGFzdF91c2VkX3VzZXJzLCBpc19mcm9tX2FkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldF9ub3JtYWxpemVkX2hvc3RuYW1lX3N0ciwgaXNfc25vd19hZGFwdGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldF9ub3JtYWxpemVkX2lwLCBnZXRfc2VyaWFsLCBnZXRfb3NfdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3N0bmFtZXNfZG9fbm90X2NvbnRyYWRpY3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXBzX2RvX25vdF9jb250cmFkaWN0X29yX21hY19pbnRlcnNlY3Rpb24sIG1hY3NfZG9fbm90X2NvbnRyYWRpY3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNfYXp1cmVhZF9vcl9hZF9hbmRfaGF2ZV9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvc3RuYW1lX25vdF9wcm9ibGVtYXRpYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc19kaWZmZXJlbnRfcGx1Z2luLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX2Zyb21fanVuaXBlcl9hbmRfYXNzZXRfbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc193aW5kb3dzLCBpc19saW51eCwgZ2V0X2Nsb3VkX2lkX29yX2hvc3RuYW1lLCBjb21wYXJlX2Nsb3VkX2lkX29yX2hvc3RuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX2p1bm9zX3NwYWNlX2RldmljZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc19vbGRfZGV2aWNlLCBpc19zY2NtX29yX2FkLCBpc19zbm93X2RldmljZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc19zcGx1bmtfdnBuLCBub3JtYWxpemVfYWRhcHRlcl9kZXZpY2VzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcmlhbHNfZG9fbm90X2NvbnRyYWRpY3QsIGNvbXBhcmVfbWFjc19vcl9vbmVfaXNfamFtZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3Rfd2lmaV9hZGFwdGVycywgbm90X3dpZmlfYWRhcHRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG91ZF9pZF9kb19ub3RfY29udHJhZGljdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRfc2VyaWFsX25vX3MsIGNvbXBhcmVfc2VyaWFsX25vX3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0X2Jpb3Nfc2VyaWFsX29yX3NlcmlhbF9ub19zLCBjb21wYXJlX2Jpb3Nfc2VyaWFsX3NlcmlhbF9ub19zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldF9ob3N0bmFtZV9vcl9zZXJpYWwsIGNvbXBhcmVfaG9zdG5hbWVfc2VyaWFsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX2Zyb21fZGVlcHNfb3JfYXdzLCBnZXRfbmVzc3VzX25vX3NjYW5faWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGFyZV9uZXNzdXNfbm9fc2Nhbl9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc19kb21haW5fdmFsaWQsIGNvbXBhcmVfdXVpZCwgZ2V0X3V1aWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0X2F6dXJlX2FkX2lkLCBjb21wYXJlX2F6dXJlX2FkX2lkLCBnZXRfaG9zdG5hbWVfbm9fbG9jYWxob3N0LCBnZXRfZG5zX25hbWVzKQoKCmxvZ2dlciA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKGYnYXhvbml1cy57X19uYW1lX199JykKCgpVU0VSU19DT1JSRUxBVElPTl9BREFQVEVSUyA9IFsnaWxsdXNpdmVfYWRhcHRlcicsICdjYXJib25ibGFja19wcm90ZWN0aW9uX2FkYXB0ZXInLCAncXVlc3Rfa2FjZV9hZGFwdGVyJ10KQUxMT1dfT0xEX01BQ19MSVNUID0gWydjbGVhcnBhc3NfYWRhcHRlcicsICd0ZW5hYmxlX3NlY3VyaXR5X2NlbnRlcicsICduZXhwb3NlX2FkYXB0ZXInLCAnbmVzc3VzX2FkYXB0ZXInLAogICAgICAgICAgICAgICAgICAgICAgJ25lc3N1c19jc3ZfYWRhcHRlcicsICd0ZW5hYmxlX2lvX2FkYXB0ZXInLCAncXVhbHlzX3NjYW5zX2FkYXB0ZXInLCAnYWlyd2F2ZV9hZGFwdGVyJywKICAgICAgICAgICAgICAgICAgICAgICdjb3VudGVyX2FjdF9hZGFwdGVyJ10KREFOR0VST1VTX0FEQVBURVJTID0gWydsYW5zd2VlcGVyX2FkYXB0ZXInLCAnY2FyYm9uYmxhY2tfcHJvdGVjdGlvbl9hZGFwdGVyJywKICAgICAgICAgICAgICAgICAgICAgICdpbmZvYmxveF9hZGFwdGVyJywgJ2F6dXJlX2FkX2FkYXB0ZXInXQpET01BSU5fVE9fRE5TX0RJQ1QgPSBkaWN0KCkKRE9FU19BRF9IQVZFX09ORV9DTElFTlQgPSBGYWxzZQoKCmRlZiBnZXRfcHJpdmF0ZV9kbnNfbmFtZShhZGFwdGVyX2RldmljZSk6CiAgICByZXR1cm4gYWRhcHRlcl9kZXZpY2VbJ2RhdGEnXS5nZXQoJ3ByaXZhdGVfZG5zX25hbWUnKQoKCmRlZiBpc19wYWxvbGF0b192cG4oYWRhcHRlcl9kZXZpY2UpOgogICAgaWYgbm90IGFkYXB0ZXJfZGV2aWNlLmdldCgncGx1Z2luX25hbWUnKSA9PSAncGFsb2FsdG9fcGFub3JhbWFfYWRhcHRlcic6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICByZXR1cm4gYWRhcHRlcl9kZXZpY2VbJ2RhdGEnXS5nZXQoJ3BhbG9hbHRvX2RldmljZV90eXBlJykgPT0gJ1ZQTiBEZXZpY2UnCgoKZGVmIGlzX29ubHlfaG9zdF9hZGFwdGVyKGFkYXB0ZXJfZGV2aWNlKToKICAgIGlmIChhZGFwdGVyX2RldmljZS5nZXQoJ3BsdWdpbl9uYW1lJykgaW4gWydkZWVwX3NlY3VyaXR5X2FkYXB0ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Npc2NvX3VtYnJlbGxhX2FkYXB0ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2JpdGxvY2tlcl9hZGFwdGVyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjYXJib25ibGFja19kZWZlbnNlX2FkYXB0ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NhcmJvbmJsYWNrX3Byb3RlY3Rpb25fYWRhcHRlcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY3N2X2FkYXB0ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21zc3FsX2FkYXB0ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NvZGU0Ml9hZGFwdGVyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhdmFtYXJfYWRhcHRlcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hlcndlbGxfYWRhcHRlcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc2lnbmFsc2NpZW5jZXNfYWRhcHRlcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3lzYWlkX2FkYXB0ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xvZ3JoeXRobV9hZGFwdGVyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwa3dhcmVfYWRhcHRlcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3BsdW5rX2FkYXB0ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Nsb3VkX2hlYWx0aF9hZGFwdGVyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzeW1hbnRlY19lZV9hZGFwdGVyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhcnNlbmFsX2FkYXB0ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2d1YXJkaXVtX2FkYXB0ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGFkb2dfYWRhcHRlcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnb2JzZXJ2aXVtX2FkYXB0ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Fuc2libGVfdG93ZXJfYWRhcHRlcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2lzY29fdWNtX2FkYXB0ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N5bWFudGVjX2RscF9hZGFwdGVyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICduZXRza29wZV9hZGFwdGVyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdmbGV4ZXJhX2FkYXB0ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RydXZhX2FkYXB0ZXInXSk6CiAgICAgICAgcmV0dXJuIFRydWUKICAgIHRyeToKICAgICAgICBpZiBhZGFwdGVyX2RldmljZS5nZXQoJ3BsdWdpbl9uYW1lJykgPT0gJ2FjdGl2ZV9kaXJlY3RvcnlfYWRhcHRlcicgYW5kIFwKICAgICAgICAgICAgICAgIChET0VTX0FEX0hBVkVfT05FX0NMSUVOVCBvciAnT1U9TGludXgsJyBpbiBhZGFwdGVyX2RldmljZVsnZGF0YSddLmdldCgnaWQnKSk6CiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgIHBhc3MKICAgIHJldHVybiBGYWxzZQoKCmRlZiBpc19vbmx5X2hvc3RfYWRhcHRlcl9vcl9wYWxvX2FsdG9fdnBuKGFkYXB0ZXJfZGV2aWNlKToKICAgIHJldHVybiAoaXNfb25seV9ob3N0X2FkYXB0ZXIoYWRhcHRlcl9kZXZpY2UpIGFuZAogICAgICAgICAgICAobm90IGFkYXB0ZXJfZGV2aWNlLmdldChOT1JNQUxJWkVEX01BQ1MpIGFuZCBub3QgZ2V0X25vcm1hbGl6ZWRfaXAoYWRhcHRlcl9kZXZpY2UpKSkgXAogICAgICAgIG9yIGlzX3BhbG9sYXRvX3ZwbihhZGFwdGVyX2RldmljZSkKCgpkZWYgaXNfb25seV9ob3N0X2FkYXB0ZXJfbm90X2xvY2FsaG9zdChhZGFwdGVyX2RldmljZSk6CiAgICByZXR1cm4gaXNfb25seV9ob3N0X2FkYXB0ZXIoYWRhcHRlcl9kZXZpY2UpIGFuZCBob3N0bmFtZV9ub3RfcHJvYmxlbWF0aWMoYWRhcHRlcl9kZXZpY2UpCgoKZGVmIGdldF9mcWRuKGFkYXB0ZXJfZGV2aWNlKToKICAgICMgRm9yIG5vdyB3ZSBzdXBwb3J0IG9ubHkgQ2hlZiB0byBhdm9pZCBjb25mdXNpb24gb2YgZnV0dXJlIGFkYXB0ZXJzIHdyaXRlcnMKICAgIGlmIG5vdCBpc19jaGVmX2FkYXB0ZXIoYWRhcHRlcl9kZXZpY2UpOgogICAgICAgIHJldHVybiBOb25lCiAgICByZXR1cm4gYWRhcHRlcl9kZXZpY2VbJ2RhdGEnXS5nZXQoJ2ZxZG4nKQoKCmRlZiBnZXRfZnFkbl9vcl9ob3N0bmFtZShhZGFwdGVyX2RldmljZSk6CiAgICBmcWRuX2hvc3RuYW1lID0gZ2V0X2ZxZG4oYWRhcHRlcl9kZXZpY2UpIG9yIGdldF9ub3JtYWxpemVkX2hvc3RuYW1lX3N0cihhZGFwdGVyX2RldmljZSkKICAgIGlmIGZxZG5faG9zdG5hbWU6CiAgICAgICAgcmV0dXJuIGZxZG5faG9zdG5hbWUuc3BsaXQoJy4nKVswXS5sb3dlcigpCiAgICByZXR1cm4gTm9uZQoKCmRlZiBnZXRfcmVzb3VyY2VfaWQoYWRhcHRlcl9kZXZpY2UpOgogICAgcmV0dXJuIGFkYXB0ZXJfZGV2aWNlWydkYXRhJ10uZ2V0KCdyZXNvdXJjZV9pZCcpCgoKZGVmIGdldF9kc3RfbmFtZShhZGFwdGVyX2RldmljZSk6CiAgICByZXR1cm4gYWRhcHRlcl9kZXZpY2VbJ2RhdGEnXS5nZXQoJ2FkX2Rpc3Rpbmd1aXNoZWRfbmFtZScpCgoKZGVmIGNvbXBhcmVfZHN0X25hbWUoYWRhcHRlcl9kZXZpY2UxLCBhZGFwdGVyX2RldmljZTIpOgogICAgaWYgbm90IGdldF9kc3RfbmFtZShhZGFwdGVyX2RldmljZTEpIG9yIG5vdCBnZXRfZHN0X25hbWUoYWRhcHRlcl9kZXZpY2UyKToKICAgICAgICByZXR1cm4gRmFsc2UKICAgIHJldHVybiBnZXRfZHN0X25hbWUoYWRhcHRlcl9kZXZpY2UxKSA9PSBnZXRfZHN0X25hbWUoYWRhcHRlcl9kZXZpY2UyKQoKCmRlZiBnZXRfYWdlbnRfdXVpZChhZGFwdGVyX2RldmljZSk6CiAgICBpZiBub3QgYWRhcHRlcl9kZXZpY2UuZ2V0KCdwbHVnaW5fbmFtZScpID09ICd0ZW5hYmxlX2lvX2FkYXB0ZXInOgogICAgICAgIHJldHVybiBOb25lCiAgICBhZ2VudF91dWlkID0gYWRhcHRlcl9kZXZpY2VbJ2RhdGEnXS5nZXQoJ2FnZW50X3V1aWQnKQogICAgaWYgYWdlbnRfdXVpZDoKICAgICAgICByZXR1cm4gYWdlbnRfdXVpZC5yZXBsYWNlKCctJywgJycpLmxvd2VyKCkKICAgIHJldHVybiBOb25lCgoKZGVmIGNvbXBhcmVfYWdlbnRfdXVpZHMoYWRhcHRlcl9kZXZpY2UxLCBhZGFwdGVyX2RldmljZTIpOgogICAgaWYgbm90IGdldF9hZ2VudF91dWlkKGFkYXB0ZXJfZGV2aWNlMSkgb3Igbm90IGdldF9hZ2VudF91dWlkKGFkYXB0ZXJfZGV2aWNlMik6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICByZXR1cm4gZ2V0X2FnZW50X3V1aWQoYWRhcHRlcl9kZXZpY2UxKSA9PSBnZXRfYWdlbnRfdXVpZChhZGFwdGVyX2RldmljZTIpCgoKZGVmIGdldF9hc3NldF9vcl9ob3N0X2Z1bGwoYWRhcHRlcl9kZXZpY2UpOgogICAgYXNzZXQgPSBnZXRfYXNzZXRfbmFtZShhZGFwdGVyX2RldmljZSkgb3IgZ2V0X2hvc3RuYW1lKGFkYXB0ZXJfZGV2aWNlKQogICAgaWYgYXNzZXQ6CiAgICAgICAgcmV0dXJuIGFzc2V0Lmxvd2VyKCkuc3RyaXAoKQogICAgcmV0dXJuIE5vbmUKCgpkZWYgY29tcGFyZV9hc3NldF9ob3N0c19mdWxsKGFkYXB0ZXJfZGV2aWNlMSwgYWRhcHRlcl9kZXZpY2UyKToKICAgIGFzc2V0MSA9IGdldF9hc3NldF9vcl9ob3N0X2Z1bGwoYWRhcHRlcl9kZXZpY2UxKQogICAgYXNzZXQyID0gZ2V0X2Fzc2V0X29yX2hvc3RfZnVsbChhZGFwdGVyX2RldmljZTIpCiAgICBpZiBhc3NldDEgYW5kIGFzc2V0MiBhbmQgYXNzZXQxID09IGFzc2V0MjoKICAgICAgICByZXR1cm4gVHJ1ZQogICAgcmV0dXJuIEZhbHNlCgoKZGVmIGdldF9zY2NtX3NlcnZlcihhZGFwdGVyX2RldmljZSk6CiAgICByZXR1cm4gYWRhcHRlcl9kZXZpY2VbJ2RhdGEnXS5nZXQoJ3NjY21fc2VydmVyJykKCgpkZWYgY29tcGFyZV9yZXNvdXJjZV9pZChhZGFwdGVyX2RldmljZTEsIGFkYXB0ZXJfZGV2aWNlMik6CiAgICBpZiBub3QgZ2V0X3Jlc291cmNlX2lkKGFkYXB0ZXJfZGV2aWNlMSkgb3Igbm90IGdldF9yZXNvdXJjZV9pZChhZGFwdGVyX2RldmljZTIpOgogICAgICAgIHJldHVybiBGYWxzZQogICAgcmV0dXJuIGdldF9yZXNvdXJjZV9pZChhZGFwdGVyX2RldmljZTEpID09IGdldF9yZXNvdXJjZV9pZChhZGFwdGVyX2RldmljZTIpCgoKZGVmIGNvbXBhcmVfc2NjbV9zZXJ2ZXIoYWRhcHRlcl9kZXZpY2UxLCBhZGFwdGVyX2RldmljZTIpOgogICAgaWYgbm90IGdldF9zY2NtX3NlcnZlcihhZGFwdGVyX2RldmljZTEpIG9yIG5vdCBnZXRfc2NjbV9zZXJ2ZXIoYWRhcHRlcl9kZXZpY2UyKToKICAgICAgICByZXR1cm4gRmFsc2UKICAgIHJldHVybiBnZXRfc2NjbV9zZXJ2ZXIoYWRhcHRlcl9kZXZpY2UxKSA9PSBnZXRfc2NjbV9zZXJ2ZXIoYWRhcHRlcl9kZXZpY2UyKQoKCmRlZiBjb21wYXJlX2ZxZG5fb3JfaG9zdG5hbWUoYWRhcHRlcl9kZXZpY2UxLCBhZGFwdGVyX2RldmljZTIpOgogICAgaWYgbm90IGdldF9mcWRuX29yX2hvc3RuYW1lKGFkYXB0ZXJfZGV2aWNlMSkgb3Igbm90IGdldF9mcWRuX29yX2hvc3RuYW1lKGFkYXB0ZXJfZGV2aWNlMik6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICByZXR1cm4gZ2V0X2ZxZG5fb3JfaG9zdG5hbWUoYWRhcHRlcl9kZXZpY2UxKSA9PSBnZXRfZnFkbl9vcl9ob3N0bmFtZShhZGFwdGVyX2RldmljZTIpCgoKZGVmIGdldF9lbWFpbChhZGFwdGVyX2RldmljZSk6CiAgICByZXR1cm4gYWRhcHRlcl9kZXZpY2VbJ2RhdGEnXS5nZXQoJ2VtYWlsJykKCgpkZWYgY29tcGFyZV9lbWFpbHMoYWRhcHRlcl9kZXZpY2UxLCBhZGFwdGVyX2RldmljZTIpOgogICAgZW1haWwxID0gZ2V0X2VtYWlsKGFkYXB0ZXJfZGV2aWNlMSkKICAgIGVtYWlsMiA9IGdldF9lbWFpbChhZGFwdGVyX2RldmljZTIpCiAgICBpZiBub3QgZW1haWwxIG9yIG5vdCBlbWFpbDI6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICByZXR1cm4gZW1haWwxLmxvd2VyKCkgPT0gZW1haWwyLmxvd2VyKCkKCgpkZWYgZ2V0X3ByZWZpeF9wcml2YXRlX2Ruc19vcl9ob3N0bmFtZShhZGFwdGVyX2RldmljZSk6CiAgICBwcml2YXRlX2RucyA9IGdldF9wcml2YXRlX2Ruc19uYW1lKGFkYXB0ZXJfZGV2aWNlKQogICAgaWYgcHJpdmF0ZV9kbnM6CiAgICAgICAgcHJpdmF0ZV9kbnMgPSBwcml2YXRlX2Rucy5sb3dlcigpCiAgICAgICAgcmV0dXJuIHByaXZhdGVfZG5zLnNwbGl0KCcuJylbMF0KICAgIGhvc3RuYW1lID0gZ2V0X2hvc3RuYW1lKGFkYXB0ZXJfZGV2aWNlKQogICAgaWYgaG9zdG5hbWU6CiAgICAgICAgaG9zdG5hbWUgPSBob3N0bmFtZS5sb3dlcigpCiAgICAgICAgcmV0dXJuIGhvc3RuYW1lLnNwbGl0KCcuJylbMF0KICAgIHJldHVybiBOb25lCgoKZGVmIGlzX25ldGJveF9hZGFwdGVyKGFkYXB0ZXJfZGV2aWNlKToKICAgIHJldHVybiBhZGFwdGVyX2RldmljZS5nZXQoJ3BsdWdpbl9uYW1lJykgPT0gJ25ldGJveF9hZGFwdGVyJwoKCmRlZiBpc19mcm9tX3R3aXN0bG9jayhhZGFwdGVyX2RldmljZSk6CiAgICByZXR1cm4gYWRhcHRlcl9kZXZpY2UuZ2V0KCdwbHVnaW5fbmFtZScpID09ICd0d2lzdGxvY2tfYWRhcHRlcicKCgpkZWYgaXNfZnJvbV9kaWdpY2VydF9wa2koYWRhcHRlcl9kZXZpY2UpOgogICAgcmV0dXJuIGFkYXB0ZXJfZGV2aWNlLmdldCgncGx1Z2luX25hbWUnKSA9PSAnZGlnaWNlcnRfcGtpX3BsYXRmb3JtX2FkYXB0ZXInCgoKZGVmIGlzX2NsYXJvdHlfdGVuX2FkYXB0ZXJfbW9yZV9tYWMoYWRhcHRlcl9kZXZpY2UpOgogICAgaWYgYWRhcHRlcl9kZXZpY2UuZ2V0KCdwbHVnaW5fbmFtZScpIG5vdCBpbiBbJ2NsYXJvdHlfYWRhcHRlcicsICd0ZW5hYmxlX2lvX2FkYXB0ZXInLCAnb2ZmaWNlX3NjYW5fYWRhcHRlciddOgogICAgICAgIHJldHVybiBGYWxzZQogICAgbWFjcyA9IGFkYXB0ZXJfZGV2aWNlLmdldChOT1JNQUxJWkVEX01BQ1MpCiAgICBpZiBtYWNzIGFuZCBsZW4obWFjcykgPiAxOgogICAgICAgIHJldHVybiBUcnVlCiAgICByZXR1cm4gRmFsc2UKCgpkZWYgaXNfZXN4X2FuZF9ob3N0bmFtZV9tb3JlX21hYyhhZGFwdGVyX2RldmljZSk6CiAgICBpZiBhZGFwdGVyX2RldmljZS5nZXQoJ3BsdWdpbl9uYW1lJykgbm90IGluIFsnZXN4X2FkYXB0ZXInXToKICAgICAgICByZXR1cm4gRmFsc2UKICAgIG1hY3MgPSBhZGFwdGVyX2RldmljZS5nZXQoTk9STUFMSVpFRF9NQUNTKQogICAgaWYgbWFjcyBhbmQgbGVuKG1hY3MpID4gMSBhbmQgZ2V0X2hvc3RuYW1lKGFkYXB0ZXJfZGV2aWNlKToKICAgICAgICByZXR1cm4gVHJ1ZQogICAgcmV0dXJuIEZhbHNlCgoKZGVmIGdldF9zb2xhcndpbmRzX2lwX29yX2hvc3RuYW1lKGFkYXB0ZXJfZGV2aWNlKToKICAgIHJldHVybiBhZGFwdGVyX2RldmljZVsnZGF0YSddLmdldCgnc29sYXJ3aW5kc19pcCcpIG9yIGFkYXB0ZXJfZGV2aWNlWydkYXRhJ10uZ2V0KCdob3N0bmFtZScpCgoKZGVmIGNvbXBhcmVfc29sYXJ3aW5kc19pcF9vcl9ob3N0bmFtZShhZGFwdGVyX2RldmljZTEsIGFkYXB0ZXJfZGV2aWNlMik6CiAgICBzb2xhcndpbmRzX2lwXzEgPSBnZXRfc29sYXJ3aW5kc19pcF9vcl9ob3N0bmFtZShhZGFwdGVyX2RldmljZTEpCiAgICBzb2xhcndpbmRzX2lwXzIgPSBnZXRfc29sYXJ3aW5kc19pcF9vcl9ob3N0bmFtZShhZGFwdGVyX2RldmljZTIpCiAgICBpZiBub3Qgc29sYXJ3aW5kc19pcF8xIG9yIG5vdCBzb2xhcndpbmRzX2lwXzI6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICByZXR1cm4gc29sYXJ3aW5kc19pcF8xID09IHNvbGFyd2luZHNfaXBfMgoKCmRlZiBpc19jYV9jbWRiX2FkYXB0ZXIoYWRhcHRlcl9kZXZpY2UpOgogICAgcmV0dXJuIGFkYXB0ZXJfZGV2aWNlLmdldCgncGx1Z2luX25hbWUnKSA9PSAnY2FfY21kYl9hZGFwdGVyJwoKCmRlZiBpc19pdmFudGlfY21fYWRhcHRlcihhZGFwdGVyX2RldmljZSk6CiAgICByZXR1cm4gYWRhcHRlcl9kZXZpY2UuZ2V0KCdwbHVnaW5fbmFtZScpID09ICdpdmFudGlfc21fYWRhcHRlcicKCgpkZWYgaXNfc2VydmljZV9ub3dfYW5kX25vX290aGVyKGFkYXB0ZXJfZGV2aWNlKToKICAgIGlmIGFkYXB0ZXJfZGV2aWNlLmdldCgncGx1Z2luX25hbWUnKSA9PSAnc2VydmljZV9ub3dfYWRhcHRlcicgYW5kIG5vdCBnZXRfaG9zdG5hbWUoYWRhcHRlcl9kZXZpY2UpIFwKICAgICAgICAgICAgYW5kIG5vdCBnZXRfbm9ybWFsaXplZF9pcChhZGFwdGVyX2RldmljZSlcCiAgICAgICAgICAgIGFuZCBub3QgZ2V0X3NlcmlhbChhZGFwdGVyX2RldmljZSkgYW5kIG5vdCBhZGFwdGVyX2RldmljZS5nZXQoTk9STUFMSVpFRF9NQUNTKToKICAgICAgICByZXR1cm4gVHJ1ZQogICAgcmV0dXJuIEZhbHNlCgoKZGVmIGlzX29ubHlfYXNzZXRfbmFtc19hZGFwdGVyKGFkYXB0ZXJfZGV2aWNlKToKICAgIHJldHVybiBpc19jYV9jbWRiX2FkYXB0ZXIoYWRhcHRlcl9kZXZpY2UpIG9yIGlzX25ldGJveF9hZGFwdGVyKGFkYXB0ZXJfZGV2aWNlKVwKICAgICAgICBvciBpc19pdmFudGlfY21fYWRhcHRlcihhZGFwdGVyX2RldmljZSkgb3IgaXNfc2VydmljZV9ub3dfYW5kX25vX290aGVyKGFkYXB0ZXJfZGV2aWNlKQoKCmRlZiBpc19jc3ZfYWRhcHRlcihhZGFwdGVyX2RldmljZSk6CiAgICByZXR1cm4gYWRhcHRlcl9kZXZpY2UuZ2V0KCdwbHVnaW5fbmFtZScpID09ICdjc3ZfYWRhcHRlcicKCgpkZWYgaXNfY2hlZl9hZGFwdGVyKGFkYXB0ZXJfZGV2aWNlKToKICAgIHJldHVybiBhZGFwdGVyX2RldmljZS5nZXQoJ3BsdWdpbl9uYW1lJykgPT0gJ2NoZWZfYWRhcHRlcicKCgpkZWYgaXNfYXdzX2FkYXB0ZXIoYWRhcHRlcl9kZXZpY2UpOgogICAgcmV0dXJuIGFkYXB0ZXJfZGV2aWNlLmdldCgncGx1Z2luX25hbWUnKSA9PSAnYXdzX2FkYXB0ZXInCgoKZGVmIGlzX2F6dXJlX2FkX2FkYXB0ZXIoYWRhcHRlcl9kZXZpY2UpOgogICAgcmV0dXJuIGFkYXB0ZXJfZGV2aWNlLmdldCgncGx1Z2luX25hbWUnKSA9PSAnYXp1cmVfYWRfYWRhcHRlcicKCgpkZWYgaXNfYXdzX29yX2NoZWZfYWRhcHRlcihhZGFwdGVyX2RldmljZSk6CiAgICByZXR1cm4gaXNfY2hlZl9hZGFwdGVyKGFkYXB0ZXJfZGV2aWNlKSBvciBpc19hd3NfYWRhcHRlcihhZGFwdGVyX2RldmljZSkKCgpkZWYgaXNfYXNzZXRfb2tfaG9zdG5hbWVfbm9fYWRhcHRlcnMoYWRhcHRlcl9kZXZpY2UpOgogICAgcmV0dXJuIGFkYXB0ZXJfZGV2aWNlLmdldCgncGx1Z2luX25hbWUnKSBpbiBbJ2F3c19hZGFwdGVyJywgJ2NoZWZfYWRhcHRlcicsICdqYW1mX2FkYXB0ZXInLCAnZXBvX2FkYXB0ZXInXQoKCmRlZiBpZl9jc3ZfY29tcGFyZV9mdWxsX3BhdGgoYWRhcHRlcl9kZXZpY2UxLCBhZGFwdGVyX2RldmljZTIpOgogICAgIyBpZiBub3QgaXNfY3N2X2FkYXB0ZXIoYWRhcHRlcl9kZXZpY2UxKSBhbmQgbm90IGlzX2Nzdl9hZGFwdGVyKGFkYXB0ZXJfZGV2aWNlMik6CiAgICAjICAgICByZXR1cm4gVHJ1ZQogICAgaG9zdG5hbWUxID0gYWRhcHRlcl9kZXZpY2UxWydkYXRhJ10uZ2V0KCdob3N0bmFtZScpCiAgICBob3N0bmFtZTIgPSBhZGFwdGVyX2RldmljZTJbJ2RhdGEnXS5nZXQoJ2hvc3RuYW1lJykKICAgIGlmIG5vdCBob3N0bmFtZTEgb3Igbm90IGhvc3RuYW1lMjoKICAgICAgICByZXR1cm4gRmFsc2UKICAgIHJldHVybiBob3N0bmFtZTEubG93ZXIoKS5zdGFydHN3aXRoKGhvc3RuYW1lMi5sb3dlcigpKSBvciBob3N0bmFtZTIubG93ZXIoKS5zdGFydHN3aXRoKGhvc3RuYW1lMS5sb3dlcigpKQoKCmRlZiBhc3NldF9ob3N0bmFtZXNfZG9fbm90X2NvbnRyYWRpY3RfYW5kX25vX2NoZWYoYWRhcHRlcl9kZXZpY2UxLCBhZGFwdGVyX2RldmljZTIpOgogICAgcmV0dXJuIGFzc2V0X2hvc3RuYW1lc19kb19ub3RfY29udHJhZGljdChhZGFwdGVyX2RldmljZTEsIGFkYXB0ZXJfZGV2aWNlMikgXAogICAgICAgIG9yIGlzX2Fzc2V0X29rX2hvc3RuYW1lX25vX2FkYXB0ZXJzKGFkYXB0ZXJfZGV2aWNlMSkgb3IgaXNfYXNzZXRfb2tfaG9zdG5hbWVfbm9fYWRhcHRlcnMoYWRhcHRlcl9kZXZpY2UyKQoKCiMgcHlsaW50OiBkaXNhYmxlPWludmFsaWQtbmFtZQpkZWYgaXBzX2RvX25vdF9jb250cmFkaWN0X29yX21hY19pbnRlcnNlY3Rpb25fb3JfYXNzZXRfb25seV9hZGFwdGVyKGFkYXB0ZXJfZGV2aWNlMSwgYWRhcHRlcl9kZXZpY2UyKToKICAgIHJldHVybiBpcHNfZG9fbm90X2NvbnRyYWRpY3Rfb3JfbWFjX2ludGVyc2VjdGlvbihhZGFwdGVyX2RldmljZTEsIGFkYXB0ZXJfZGV2aWNlMikgXAogICAgICAgIG9yIGlzX29ubHlfYXNzZXRfbmFtc19hZGFwdGVyKGFkYXB0ZXJfZGV2aWNlMSkgb3IgaXNfb25seV9hc3NldF9uYW1zX2FkYXB0ZXIoYWRhcHRlcl9kZXZpY2UyKQoKCmRlZiBpcHNfZG9fbm90X2NvbnRyYWRpY3Rfb3JfbWFjX2ludGVyc2VjdGlvbl9vcl9hc3NldF9vbmx5X2FkYXB0ZXJfYW5kX2F6dXJlX2FkKGFkYXB0ZXJfZGV2aWNlMSwgYWRhcHRlcl9kZXZpY2UyKToKICAgIHJldHVybiBpcHNfZG9fbm90X2NvbnRyYWRpY3Rfb3JfbWFjX2ludGVyc2VjdGlvbl9vcl9hc3NldF9vbmx5X2FkYXB0ZXIoYWRhcHRlcl9kZXZpY2UxLCBhZGFwdGVyX2RldmljZTIpIFwKICAgICAgICBvciBpc19henVyZV9hZF9hZGFwdGVyKGFkYXB0ZXJfZGV2aWNlMSkgb3IgaXNfYXp1cmVfYWRfYWRhcHRlcihhZGFwdGVyX2RldmljZTIpCiMgcHlsaW50OiBlbmFibGU9aW52YWxpZC1uYW1lCgoKZGVmIGNvbXBhcmVfaG9zdG5hbWVfb3JfcHJpdmF0ZV9kbnMoYWRhcHRlcl9kZXZpY2UxLCBhZGFwdGVyX2RldmljZTIpOgogICAgcHJpdmF0ZV9kbnNfb3JfaG9zdG5hbWUxID0gZ2V0X3ByZWZpeF9wcml2YXRlX2Ruc19vcl9ob3N0bmFtZShhZGFwdGVyX2RldmljZTEpCiAgICBwcml2YXRlX2Ruc19vcl9ob3N0bmFtZTIgPSBnZXRfcHJlZml4X3ByaXZhdGVfZG5zX29yX2hvc3RuYW1lKGFkYXB0ZXJfZGV2aWNlMikKICAgIGlmIG5vdCBwcml2YXRlX2Ruc19vcl9ob3N0bmFtZTEgb3Igbm90IHByaXZhdGVfZG5zX29yX2hvc3RuYW1lMjoKICAgICAgICByZXR1cm4gRmFsc2UKICAgIHJldHVybiBwcml2YXRlX2Ruc19vcl9ob3N0bmFtZTEgPT0gcHJpdmF0ZV9kbnNfb3JfaG9zdG5hbWUyCgoKZGVmIGlzX2Zyb21fdHdpc3Rsb2NrX29yX2Nsb3VkKGFkYXB0ZXJfZGV2aWNlKToKICAgIHJldHVybiAoYWRhcHRlcl9kZXZpY2UuZ2V0KCdwbHVnaW5fbmFtZScpID09ICdhd3NfYWRhcHRlcicgYW5kCiAgICAgICAgICAgIGFkYXB0ZXJfZGV2aWNlWydkYXRhJ10uZ2V0KCdhd3NfZGV2aWNlX3R5cGUnKSA9PSAnRUMyJykgb3IgXAogICAgICAgIGFkYXB0ZXJfZGV2aWNlLmdldCgncGx1Z2luX25hbWUnKSA9PSAndHdpc3Rsb2NrX2FkYXB0ZXInIG9yIFwKICAgICAgICAoYWRhcHRlcl9kZXZpY2UuZ2V0KCdwbHVnaW5fbmFtZScpID09ICdnY2VfYWRhcHRlcicgYW5kIGFkYXB0ZXJfZGV2aWNlWydkYXRhJ10uZ2V0KCdkZXZpY2VfdHlwZScpID09ICdDT01QVVRFJykKCgpkZWYgaXNfYWlyd2F0Y2hfYWRhcHRlcihhZGFwdGVyX2RldmljZSk6CiAgICByZXR1cm4gYWRhcHRlcl9kZXZpY2UuZ2V0KCdwbHVnaW5fbmFtZScpID09ICdhaXJ3YXRjaF9hZGFwdGVyJwoKCmRlZiBvbmVfaXNfYWRfb25lX2lzX2FpcndhdGNoKGFkYXB0ZXJfZGV2aWNlMSwgYWRhcHRlcl9kZXZpY2UyKToKICAgIHJldHVybiAoaXNfZnJvbV9hZChhZGFwdGVyX2RldmljZTEpIGFuZCBpc19haXJ3YXRjaF9hZGFwdGVyKGFkYXB0ZXJfZGV2aWNlMikpIFwKICAgICAgICBvciAoaXNfZnJvbV9hZChhZGFwdGVyX2RldmljZTIpIGFuZCBpc19haXJ3YXRjaF9hZGFwdGVyKGFkYXB0ZXJfZGV2aWNlMSkpCgoKZGVmIGZyaWVuZGx5X25hbWVfb3JfYWRfbmFtZShhZGFwdGVyX2RldmljZSk6CiAgICBpZiBpc19haXJ3YXRjaF9hZGFwdGVyKGFkYXB0ZXJfZGV2aWNlKToKICAgICAgICBpZiBhZGFwdGVyX2RldmljZVsnZGF0YSddLmdldCgnZnJpZW5kbHlfbmFtZScpIGFuZCAnICcgbm90IGluIGFkYXB0ZXJfZGV2aWNlWydkYXRhJ10uZ2V0KCdmcmllbmRseV9uYW1lJyk6CiAgICAgICAgICAgIHJldHVybiBhZGFwdGVyX2RldmljZVsnZGF0YSddLmdldCgnZnJpZW5kbHlfbmFtZScpLmxvd2VyKClbOjE1XQogICAgaWYgaXNfZnJvbV9hZChhZGFwdGVyX2RldmljZSkgYW5kIGdldF9ob3N0bmFtZShhZGFwdGVyX2RldmljZSk6CiAgICAgICAgcmV0dXJuIGdldF9ob3N0bmFtZShhZGFwdGVyX2RldmljZSkuc3BsaXQoJy4nKVswXS5sb3dlcigpCiAgICByZXR1cm4gTm9uZQoKCmRlZiBjb21wYXJlX2ZyaWVuZGx5X2FkX25hbWUoYWRhcHRlcl9kZXZpY2UxLCBhZGFwdGVyX2RldmljZTIpOgogICAgZnJpZW5kbHkxID0gZnJpZW5kbHlfbmFtZV9vcl9hZF9uYW1lKGFkYXB0ZXJfZGV2aWNlMSkKICAgIGZyaWVuZGx5MiA9IGZyaWVuZGx5X25hbWVfb3JfYWRfbmFtZShhZGFwdGVyX2RldmljZTIpCiAgICBpZiBub3QgZnJpZW5kbHkxIG9yIG5vdCBmcmllbmRseTI6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICByZXR1cm4gZnJpZW5kbHkxID09IGZyaWVuZGx5MgoKCmRlZiBmb3JjZV9tYWNfYWRhcHRlcnMoYWRhcHRlcl9kZXZpY2UpOgogICAgcmV0dXJuIGFkYXB0ZXJfZGV2aWNlLmdldCgncGx1Z2luX25hbWUnKSBpbiBbJ3NlbnRpbmVsb25lX2FkYXB0ZXInLCAnY2FyYm9uYmxhY2tfZGVmZW5zZV9hZGFwdGVyJ10KCiMgcHlsaW50OiBkaXNhYmxlPWdsb2JhbC1zdGF0ZW1lbnQKCgojIFNvbGFyd2luZHMgTm9kZSBhcmUgYmFkIGZvciBNQUMgY29ycmVsYXRpb24KZGVmIG5vdF9zb2xhcndpbmRzX25vZGUoYWRhcHRlcl9kZXZpY2UpOgogICAgaWYgYWRhcHRlcl9kZXZpY2UuZ2V0KCdwbHVnaW5fbmFtZScpID09ICdzb2xhcndpbmRzX29yaW9uX2FkYXB0ZXInIFwKICAgICAgICAgICAgYW5kIGFkYXB0ZXJfZGV2aWNlWydkYXRhJ10uZ2V0KCdkZXZpY2VfdHlwZScpID09ICdOb2RlIERldmljZSc6CiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICByZXR1cm4gVHJ1ZQoKCmRlZiBpc19zb2xhcndpbmRzX25vZGVfb3JfanVub3NfYmFzaWMoYWRhcHRlcl9kZXZpY2UpOgogICAgaWYgYWRhcHRlcl9kZXZpY2UuZ2V0KCdwbHVnaW5fbmFtZScpIGluIFsnc29sYXJ3aW5kc19vcmlvbl9hZGFwdGVyJywgJ2p1bm9zX2FkYXB0ZXInXSBcCiAgICAgICAgICAgIGFuZCBhZGFwdGVyX2RldmljZVsnZGF0YSddLmdldCgnZGV2aWNlX3R5cGUnKSBpbiBbJ0p1bmlwZXIgRGV2aWNlJywgJ05vZGUgRGV2aWNlJ106CiAgICAgICAgcmV0dXJuIFRydWUKICAgIHJldHVybiBGYWxzZQoKCmRlZiBpZl9zb2FscndpbmRzX2NvbXBhcmVfYWxsKGFkYXB0ZXJfZGV2aWNlMSwgYWRhcHRlcl9kZXZpY2UyKToKICAgIGlmIG5vdF9zb2xhcndpbmRzX25vZGUoYWRhcHRlcl9kZXZpY2UxKSBhbmQgbm90X3NvbGFyd2luZHNfbm9kZShhZGFwdGVyX2RldmljZTIpOgogICAgICAgIHJldHVybiBUcnVlCiAgICByZXR1cm4gY29tcGFyZV9mdWxsX21hYyhhZGFwdGVyX2RldmljZTEsIGFkYXB0ZXJfZGV2aWNlMikKCgpkZWYgbm90X3NhbHRzdGFja19lbnRlcnByaXNlX2xpbnV4KGFkYXB0ZXJfZGV2aWNlKToKICAgIGlmIGFkYXB0ZXJfZGV2aWNlLmdldCgncGx1Z2luX25hbWUnKSA9PSAnc2FsdHN0YWNrX2VudGVycHJpc2VfYWRhcHRlcicgXAogICAgICAgICAgICBhbmQgaXNfbGludXgoYWRhcHRlcl9kZXZpY2UpOgogICAgICAgIHJldHVybiBGYWxzZQogICAgcmV0dXJuIFRydWUKCgpkZWYgaXNfdXVpZF9hZGFwdGVycyhhZGFwdGVyX2RldmljZSk6CiAgICBpZiBhZGFwdGVyX2RldmljZS5nZXQoJ3BsdWdpbl9uYW1lJykgPT0gJ3Rhbml1bV9hZGFwdGVyJzoKICAgICAgICByZXR1cm4gVHJ1ZQogICAgaWYgYWRhcHRlcl9kZXZpY2UuZ2V0KCdwbHVnaW5fbmFtZScpID09ICdzZW50aW5lbG9uZV9hZGFwdGVyJyBhbmQgZ2V0X29zX3R5cGUoYWRhcHRlcl9kZXZpY2UpID09ICdPUyBYJzoKICAgICAgICByZXR1cm4gVHJ1ZQogICAgcmV0dXJuIEZhbHNlCgoKZGVmIGdldF9ub3JtYWxpemVkX2lwX29yX2lzX2Fzc2V0X29ubHkoYWRhcHRlcl9kZXZpY2UpOgogICAgcmV0dXJuIGdldF9ub3JtYWxpemVkX2lwKGFkYXB0ZXJfZGV2aWNlKSBvciBpc19vbmx5X2Fzc2V0X25hbXNfYWRhcHRlcihhZGFwdGVyX2RldmljZSkKCgpkZWYgbm90X2xhbnN3ZWVwZXJfYXNzZXRuYW1lX25vX2hvc3RuYW1lKGFkYXB0ZXJfZGV2aWNlKToKICAgIGlmIGFkYXB0ZXJfZGV2aWNlLmdldCgncGx1Z2luX25hbWUnKSA9PSAnbGFuc3dlZXBlcl9hZGFwdGVyJyBcCiAgICAgICAgICAgIGFuZCBhZGFwdGVyX2RldmljZVsnZGF0YSddLmdldCgnbmFtZScpXAogICAgICAgICAgICBhbmQgbm90IGFkYXB0ZXJfZGV2aWNlWydkYXRhJ10uZ2V0KCdob3N0bmFtZScpOgogICAgICAgIHJldHVybiBGYWxzZQogICAgcmV0dXJuIFRydWUKCgpkZWYgX3JlZnJlc2hfZG9tYWluX3RvX2Ruc19kaWN0KCk6CiAgICB0cnk6CiAgICAgICAgZ2xvYmFsIERPTUFJTl9UT19ETlNfRElDVAogICAgICAgIERPTUFJTl9UT19ETlNfRElDVCA9IFBsdWdpbkJhc2UuSW5zdGFuY2UuZ2V0X2dsb2JhbF9rZXl2YWwoJ2xkYXBfbmJuc190b19kbnMnKSBvciB7fQogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnV2FybmluZyAtIGNvdWxkIG5vdCByZWZyZXNoIGRvbWFpbiBkbnMgZGljdCcpCgoKIyBweWxpbnQ6IGRpc2FibGU9cHJvdGVjdGVkLWFjY2VzcwpkZWYgX3JlZnJlc2hfYWRfY2xpZW50X2NvdW50KCk6CiAgICBnbG9iYWwgRE9FU19BRF9IQVZFX09ORV9DTElFTlQKICAgIHRyeToKICAgICAgICBjbGllbnRzX2NvdW50ID0gMAogICAgICAgIGZvciBkb2MgaW4gUGx1Z2luQmFzZS5JbnN0YW5jZS5jb3JlX2NvbmZpZ3NfY29sbGVjdGlvbi5maW5kKHsncGx1Z2luX25hbWUnOiAnYWN0aXZlX2RpcmVjdG9yeV9hZGFwdGVyJ30pOgogICAgICAgICAgICBpZiBub3QgZG9jLmdldCgncGx1Z2luX3VuaXF1ZV9uYW1lJyk6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBjbGllbnRzX2NvdW50ICs9IFBsdWdpbkJhc2UuSW5zdGFuY2UuX2dldF9jb2xsZWN0aW9uKAogICAgICAgICAgICAgICAgJ2NsaWVudHMnLCBkYl9uYW1lPWRvY1sncGx1Z2luX3VuaXF1ZV9uYW1lJ10pLmZpbmQoe30pLmNvdW50KCkKCiAgICAgICAgbG9nZ2VyLmluZm8oZidBY3RpdmUgZGlyZWN0b3J5IGNsaWVudHMgY291bnQ6IHtjbGllbnRzX2NvdW50fScpCiAgICAgICAgRE9FU19BRF9IQVZFX09ORV9DTElFTlQgPSBjbGllbnRzX2NvdW50ID09IDEKICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihmJ1dhcm5pbmcgLSBjb3VsZCBub3QgcmVmcmVzaCBBRCBjbGllbnQgY291bnQuIHNldHRpbmcgdG8gZmFsc2UnKQogICAgICAgIERPRVNfQURfSEFWRV9PTkVfQ0xJRU5UID0gRmFsc2UKCgpkZWYgZ2V0X2RvbWFpbl9mb3JfY29ycmVsYXRpb24oYWRhcHRlcl9kZXZpY2UpOgogICAgZG9tYWluID0gYWRhcHRlcl9kZXZpY2VbJ2RhdGEnXS5nZXQoJ2RvbWFpbicpCiAgICBpZiBkb21haW4gYW5kIGlzX2RvbWFpbl92YWxpZChkb21haW4pOgogICAgICAgIHRyeToKICAgICAgICAgICAgZG9tYWluX2Ruc19uYW1lID0gRE9NQUlOX1RPX0ROU19ESUNULmdldChkb21haW4ubG93ZXIoKSkKICAgICAgICAgICAgaWYgZG9tYWluX2Ruc19uYW1lOgogICAgICAgICAgICAgICAgcmV0dXJuIGRvbWFpbl9kbnNfbmFtZS51cHBlcigpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgcGFzcwogICAgICAgIHJldHVybiBkb21haW4udXBwZXIoKQogICAgcmV0dXJuIE5vbmUKCgpkZWYgZG9tYWluX2RvX25vdF9jb250cmFkaWN0KGFkYXB0ZXJfZGV2aWNlMSwgYWRhcHRlcl9kZXZpY2UyKToKICAgIGRvbWFpbjEgPSBnZXRfZG9tYWluX2Zvcl9jb3JyZWxhdGlvbihhZGFwdGVyX2RldmljZTEpCiAgICBkb21haW4yID0gZ2V0X2RvbWFpbl9mb3JfY29ycmVsYXRpb24oYWRhcHRlcl9kZXZpY2UyKQogICAgaWYgbm90IGRvbWFpbjEgb3Igbm90IGRvbWFpbjI6CiAgICAgICAgcmV0dXJuIFRydWUKICAgIHJldHVybiBkb21haW4xIGluIGRvbWFpbjIgb3IgZG9tYWluMiBpbiBkb21haW4xCgoKZGVmIGNvbXBhcmVfZG9tYWluX2Zvcl9jb3JyZWxhdGlvbihhZGFwdGVyX2RldmljZTEsIGFkYXB0ZXJfZGV2aWNlMik6CiAgICBkb21haW4xID0gZ2V0X2RvbWFpbl9mb3JfY29ycmVsYXRpb24oYWRhcHRlcl9kZXZpY2UxKQogICAgZG9tYWluMiA9IGdldF9kb21haW5fZm9yX2NvcnJlbGF0aW9uKGFkYXB0ZXJfZGV2aWNlMikKICAgIGlmIGRvbWFpbjEgYW5kIGRvbWFpbjI6CiAgICAgICAgaWYgZG9tYWluMSBpbiBkb21haW4yIG9yIGRvbWFpbjIgaW4gZG9tYWluMToKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgIHJldHVybiBGYWxzZQoKCmNsYXNzIFN0YXRpY0NvcnJlbGF0b3JFbmdpbmUoQ29ycmVsYXRvckVuZ2luZUJhc2UpOgogICAgIiIiCiAgICBGb3IgZWZmaWNpZW5jeSByZWFzb25zIHRoaXMgZW5naW5lIGFzc3VtZXMgYSBkaWZmZXJlbnQgc3RydWN0dXJlIChsZXQncyByZWZlciB0byBpdCBhcyBjb21wYWN0IHN0cnVjdHVyZSkKICAgIG9mIGF4b25pdXMgZGV2aWNlcy4KICAgIEVhY2ggYWRhcHRlciBkZXZpY2Ugc2hvdWxkIGhhdmUKICAgIHsKICAgICAgICBwbHVnaW5fbmFtZTogIiIsCiAgICAgICAgcGx1Z2luX3VuaXF1ZV9uYW1lOiAiIiwKICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgIGlkOiAiIiwKICAgICAgICAgICAgT1M6IHsKICAgICAgICAgICAgICAgIHR5cGU6ICIiLAogICAgICAgICAgICAgICAgd2hhdGV2ZXIuLi4KICAgICAgICAgICAgfSwKICAgICAgICAgICAgaG9zdG5hbWU6ICIiLAogICAgICAgICAgICBuZXR3b3JrX2ludGVyZmFjZXM6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBJUDogWyIxMjcuMC4wLjEiLCAuLi5dLAogICAgICAgICAgICAgICAgICAgIHdoYXRldmVyLi4uCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgLi4uCiAgICAgICAgICAgIF0KICAgICAgICB9CiAgICB9CiAgICAiIiIKICAgIEBwcm9wZXJ0eQogICAgZGVmIF9jb3JyZWxhdGlvbl9wcmVjb25kaXRpb25zKHNlbGYpOgogICAgICAgICMgdGhpcyBpcyB0aGUgbGVhc3Qgb2YgYWxsIGFjY2VwdGFibGUgcHJlY29uZGl0aW9ucyBmb3IgY29ycmVsYXRhYmxlIGRldmljZXMgLSBpZiBub25lIGlzIHNhdGlzZmllZCB0aGVyZSdzIG5vCiAgICAgICAgIyB3YXkgdG8gY29ycmVsYXRlIHRoZSBkZXZpY2VzIGFuZCBzbyBpdCB3b24ndCBiZSBhZGRlZCB0byBhZGFwdGVyc190b19jb3JyZWxhdGUKICAgICAgICByZXR1cm4gW2hhc19ob3N0bmFtZSwgaGFzX25hbWUsIGhhc19tYWMsIGhhc19zZXJpYWwsIGhhc19jbG91ZF9pZCwgaGFzX2FkX29yX2F6dXJlX25hbWUsIGhhc19sYXN0X3VzZWRfdXNlcnMsCiAgICAgICAgICAgICAgICBoYXNfbmVzc3VzX3NjYW5fbm9faWQsIGhhc19yZXNvdXJjZV9pZF0KCiAgICAjIHB5bGludDogZGlzYWJsZT1SMDkxMix0b28tbWFueS1ib29sZWFuLWV4cHJlc3Npb25zCiAgICBkZWYgX2NvcnJlbGF0ZV9tYWMoc2VsZiwgYWRhcHRlcnNfdG9fY29ycmVsYXRlLCBjb3JyZWxhdGVfYnlfc25vd19tYWMpOgogICAgICAgICIiIgogICAgICAgIFRvIHdyaXRlIGEgY29ycmVsYXRvciBydWxlIHdlIGRvIGEgZmV3IHRoaW5nczoKICAgICAgICAxLiAgbGlzdChmaWx0ZXJlZF9hZGFwdGVyc19saXN0KSAtCiAgICAgICAgICAgICAgICBmaWx0ZXIgaW4gb25seSBhZGFwdGVycyB3ZSBjYW4gYWN0dWFsbHkgbGF0ZXIgY29ycmVsYXRlIC0gZm9yIGV4YW1wbGUgaGVyZSB3ZSBjYW4gb25seSBjb3JyZWxhdGUKICAgICAgICAgICAgICAgIGFkYXB0ZXJzIHdpdGggbWFjLCBpcCBhbmQgb3MgLSBoYXZpbmcgYWxyZWFkeSBub3JtYWxpemVkIHRoZW0gd2UgY2FuIHVzZSB0aGUgbm9ybWFsaXplZCBmaWVsZCBmb3IKICAgICAgICAgICAgICAgIGVmZmljaWVuY3kKCiAgICAgICAgMi4gIFtnZXRfb3NfdHlwZV0gLSBzaW5jZSB0aGUgZmlyc3QgY29tcGFyaXNvbiBpcyBwYWlyd2lzZSB3ZSB3YW50IHRvIHNvcnQgYWNjb3JkaW5nIHRvIHNvbWV0aGluZyB3ZSBjYW4gZGVjaWRlCiAgICAgICAgICAgICAgICBiZXR3ZWVuIHRvIGFkYXB0ZXJzIHdoZXRoZXIgdGhleSBzaGFyZSBpdCBvciBub3QganVzdCB1c2luZyBzb3J0aW5nIC0gaS5lLiBub3QgbGlzdHMgb3Igc2V0cy4gVGhlIGdyZWF0CiAgICAgICAgICAgICAgICB0aGluZyBoZXJlIGlzIGV2ZXJ5IHBhcmFtZXRlciB3ZSBjYW4gdXNlIHdvdWxkIGRlY3JlYXNlIHRoZSBudW1iZXIgb2YgcGVybXV0YXRpb25zIGJ5IGEgaHVnZSBmYWN0b3IuCgogICAgICAgIDMuICBbY29tcGFyZV9vc190eXBlXSAtIHRoaXMgaXMgdGhlIHJlc3BlY3RpdmUgbGlzdCBvZiBjb21wYXJhdG9ycyBmb3IgdGhlIHNvcnRpbmcgbGFtYmRhcywgaW4gdGhpcyBjYXNlIHNpbmNlCiAgICAgICAgICAgICAgICB0aGUgb25seSB3YXkgdG8gc29ydCB3YXMgb3MgdHlwZSAoYXMgbWFjIGFuZCBpcCBhcmUgYm90aCBzZXRzKSB3ZSBvbmx5IGNvbXBhcmUgdGhlIG9zIGJlZm9yZSBpbnNlcnRpbmcKICAgICAgICAgICAgICAgIGludG8gdGhlIGJ1Y2tldAoKICAgICAgICA0LiAgW2lzX2RpZmZlcmVudF9wbHVnaW4sIGNvbXBhcmVfbWFjcywgX2NvbXBhcmVfaXBzXSAtIHRoZSBsaXN0IG9mIGNvbXBhcmF0b3JzIHRvIHVzZSBvbiBhIHBhaXIgZnJvbSB0aGUKICAgICAgICAgICAgICAgIGJ1Y2tldCAtIGEgcGFpciB0aGF0IGhhcyBtYWRlIGl0IHRocm91Z2ggdGhpcyBsaXN0IGlzIGNvbnNpZGVyZWQgYSBjb3JyZWxhdGlvbiBzbyBjaG9vc2Ugd2lzZWx5IQoKICAgICAgICA1LiAgeydSZWFzb24nOiAnVGhleSBoYXZlIHRoZSBzYW1lIE1BQyBhbmQgSVBzIGRvblwndCBjb250cmFkaWN0J30gLSB0aGUgcmVhc29uIGZvciB0aGUgY29ycmVsYXRpb24gLQogICAgICAgICAgICAgICAgdHJ5IHRvIG1ha2UgaXQgYXMgZGVzY3JpcHRpdmUgYXMgcG9zc2libGUgcGxlYXNlCgogICAgICAgIDYuIENvcnJlbGF0aW9uUmVhc29uLlN0YXRpY0FuYWx5c2lzIC0gdGhlIGFuYWx5c2lzIHVzZWQgdG8gZGlzY292ZXIgdGhlIGNvcnJlbGF0aW9uCiAgICAgICAgIiIiCgogICAgICAgIGxvZ2dlci5pbmZvKCdTdGFydGluZyB0byBjb3JyZWxhdGUgb24gTUFDJykKICAgICAgICBtYWNfaW5kZXhlZCA9IHt9CgogICAgICAgIGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QgPSBmaWx0ZXIobm90X3NhbHRzdGFja19lbnRlcnByaXNlX2xpbnV4LCBhZGFwdGVyc190b19jb3JyZWxhdGUpCiAgICAgICAgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCA9IGZpbHRlcihub3RfbGFuc3dlZXBlcl9hc3NldG5hbWVfbm9faG9zdG5hbWUsIGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QpCiAgICAgICAgaWYgbm90IGNvcnJlbGF0ZV9ieV9zbm93X21hYzoKICAgICAgICAgICAgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCA9IGZpbHRlcihsYW1iZGEgYWRhcDogbm90IGlzX3Nub3dfYWRhcHRlcihhZGFwKSwgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCkKCiAgICAgICAgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCA9IGZpbHRlcihsYW1iZGEgYWRhcDogbm90IGlzX2NsYXJvdHlfdGVuX2FkYXB0ZXJfbW9yZV9tYWMoYWRhcCksIGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QpCiAgICAgICAgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCA9IGZpbHRlcihsYW1iZGEgYWRhcDogbm90IGlzX2VzeF9hbmRfaG9zdG5hbWVfbW9yZV9tYWMoYWRhcCksIGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QpCgogICAgICAgIGFsbG93X29sZF9tYWNfbGlzdCA9IEFMTE9XX09MRF9NQUNfTElTVAoKICAgICAgICBpZiBjb3JyZWxhdGVfYnlfc25vd19tYWM6CiAgICAgICAgICAgIGFsbG93X29sZF9tYWNfbGlzdC5hcHBlbmQoJ3NlcnZpY2Vfbm93X2FkYXB0ZXInKQoKICAgICAgICBmb3IgYWRhcHRlciBpbiBmaWx0ZXJlZF9hZGFwdGVyc19saXN0OgogICAgICAgICAgICAjIERvbid0IGFkZCB0byB0aGUgTUFDIGNvbXBhcmlzb25zIGRldmljZXMgdGhhdCBoYXZlbid0IHNlZW4gZm9yIG1vcmUgdGhhbiAzMCBkYXlzCiAgICAgICAgICAgIGlmIGlzX29sZF9kZXZpY2UoYWRhcHRlciwgbnVtYmVyX29mX2RheXM9NSkgYW5kIGFkYXB0ZXIuZ2V0KCdwbHVnaW5fbmFtZScpIG5vdCBpbiBhbGxvd19vbGRfbWFjX2xpc3Q6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBtYWNzID0gYWRhcHRlci5nZXQoTk9STUFMSVpFRF9NQUNTKQogICAgICAgICAgICBpZiBtYWNzOgogICAgICAgICAgICAgICAgZm9yIG1hYyBpbiBtYWNzOgogICAgICAgICAgICAgICAgICAgIGlmIG1hYyBhbmQgbWFjICE9ICcwMDAwMDAwMDAwMDAnOgogICAgICAgICAgICAgICAgICAgICAgICBtYWNfaW5kZXhlZC5zZXRkZWZhdWx0KG1hYywgW10pLmFwcGVuZChhZGFwdGVyKQoKICAgICAgICAjIGZpbmQgY29udHJhZGljdGluZyBob3N0bmFtZXMgd2l0aCB0aGUgc2FtZSBtYWMgdG8gZWxpbWluYXRlIG1hY3MuCiAgICAgICAgIyBBbHNvIHVzaW5nIHByZWRlZmluZWQgYmxhY2tsaXN0IG9mIGtub3duIG1hY3MuCiAgICAgICAgbWFjX2JsYWNrbGlzdCA9IHNldCgpCiAgICAgICAgbWFjX2JsYWNrbGlzdCA9IG1hY19ibGFja2xpc3QudW5pb24oQUxMX0JMQUNLTElTVCkKICAgICAgICBmb3IgbWFjLCBtYXRjaGVzIGluIG1hY19pbmRleGVkLml0ZW1zKCk6CiAgICAgICAgICAgIGZvdW5kX3JlZ19tYWMgPSBGYWxzZQogICAgICAgICAgICBmb3IgcmVnX21hYyBpbiBGUk9NX0ZJRUxEU19CTEFDS19MSVNUX1JFRzoKICAgICAgICAgICAgICAgIGlmIGNvbXBhcmVfcmVnX21hYyhyZWdfbWFjLCBtYWMpOgogICAgICAgICAgICAgICAgICAgIG1hY19ibGFja2xpc3QuYWRkKG1hYykKICAgICAgICAgICAgICAgICAgICBmb3VuZF9yZWdfbWFjID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGlmIGZvdW5kX3JlZ19tYWM6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBmb3IgeCwgeSBpbiBjb21iaW5hdGlvbnMobWF0Y2hlcywgMik6CiAgICAgICAgICAgICAgICBpZiBub3QgaG9zdG5hbWVzX2RvX25vdF9jb250cmFkaWN0KHgsIHkpOgogICAgICAgICAgICAgICAgICAgIGlmIG1hYyBub3QgaW4gbWFjX2JsYWNrbGlzdDoKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGYnVGhpcyBjb3VsZCBiZSBiYWQgbWFjIHttYWN9JykKICAgICAgICAgICAgICAgICAgICAgICAgbWFjX21hbnVmYWN0dXJlciA9IGdldF9tYW51ZmFjdHVyZXJfZnJvbV9tYWMobWFjKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgbWFjX21hbnVmYWN0dXJlcjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hY19tYW51ZmFjdHVyZXIgPSAnJwogICAgICAgICAgICAgICAgICAgICAgICAjIHB5bGludDogZGlzYWJsZT1saW5lLXRvby1sb25nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCAoaXNfZGlmZmVyZW50X3BsdWdpbih4LCB5KSBvciBmb3JjZV9tYWNfYWRhcHRlcnMoeCkpXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIChnZXRfZG9tYWluX2Zvcl9jb3JyZWxhdGlvbih4KSBhbmQgZ2V0X2RvbWFpbl9mb3JfY29ycmVsYXRpb24oeSkgYW5kIGNvbXBhcmVfZG9tYWluX2Zvcl9jb3JyZWxhdGlvbih4LCB5KSkgXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIHguZ2V0KCdwbHVnaW5fbmFtZScpIGluIERBTkdFUk9VU19BREFQVEVSUyBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgeS5nZXQoJ3BsdWdpbl9uYW1lJykgaW4gREFOR0VST1VTX0FEQVBURVJTIFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciAndm13YXJlJyBpbiBtYWNfbWFudWZhY3R1cmVyLmxvd2VyKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZidBZGRlZCB0byBibGFja2xpc3Qge21hY30gZm9yIFgge3h9IGFuZCBZIHt5fScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWNfYmxhY2tsaXN0LmFkZChtYWMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICBmb3IgbWFjIGluIG1hY19ibGFja2xpc3Q6CiAgICAgICAgICAgIGlmIG1hYyBpbiBtYWNfaW5kZXhlZDoKICAgICAgICAgICAgICAgIGRlbCBtYWNfaW5kZXhlZFttYWNdCgogICAgICAgIGZvciBtYWMsIG1hdGNoZXMgaW4gbWFjX2luZGV4ZWQuaXRlbXMoKToKICAgICAgICAgICAgaWYgMzAgPj0gbGVuKG1hdGNoZXMpID49IDI6CiAgICAgICAgICAgICAgICBpbm5lcl9jb21wYXJlX2Z1bmNzID0gW2NvbXBhcmVfbWFjc19vcl9vbmVfaXNfamFtZl0KICAgICAgICAgICAgICAgIG1hY19tYW51ZmFjdHVyZXIgPSBOb25lCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgbWFjX21hbnVmYWN0dXJlciA9IGdldF9tYW51ZmFjdHVyZXJfZnJvbV9tYWMobWFjKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICAjIHB5bGludDogZGlzYWJsZT1saW5lLXRvby1sb25nCiAgICAgICAgICAgICAgICBpZiBub3QgbWFjX21hbnVmYWN0dXJlciBvciAoJ2Npc2NvIHN5c3RlbXMnIG5vdCBpbiBtYWNfbWFudWZhY3R1cmVyLmxvd2VyKCkgYW5kICdqdW5pcGVyIG5ldHdvcmtzJyBub3QgaW4gbWFjX21hbnVmYWN0dXJlci5sb3dlcigpKToKICAgICAgICAgICAgICAgICAgICBpbm5lcl9jb21wYXJlX2Z1bmNzLmFwcGVuZChpZl9zb2FscndpbmRzX2NvbXBhcmVfYWxsKQogICAgICAgICAgICAgICAgeWllbGQgZnJvbSBzZWxmLl9idWNrZXRfY29ycmVsYXRlKG1hdGNoZXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5uZXJfY29tcGFyZV9mdW5jcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7J1JlYXNvbic6ICdUaGV5IGhhdmUgdGhlIHNhbWUgTUFDJ30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29ycmVsYXRpb25SZWFzb24uU3RhdGljQW5hbHlzaXMpCgogICAgZGVmIF9jb3JyZWxhdGVfaG9zdG5hbWVfZnFkbl9pcChzZWxmLCBhZGFwdGVyc190b19jb3JyZWxhdGUpOgogICAgICAgIGxvZ2dlci5pbmZvKCdTdGFydGluZyB0byBjb3JyZWxhdGUgb24gSG9zdG5hbWVfRlFETi1JUCcpCiAgICAgICAgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCA9IGZpbHRlcihnZXRfZnFkbl9vcl9ob3N0bmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcihnZXRfbm9ybWFsaXplZF9pcCwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKSkKICAgICAgICByZXR1cm4gc2VsZi5fYnVja2V0X2NvcnJlbGF0ZShsaXN0KGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtnZXRfZnFkbl9vcl9ob3N0bmFtZV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2NvbXBhcmVfZnFkbl9vcl9ob3N0bmFtZV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2lwc19kb19ub3RfY29udHJhZGljdF9vcl9tYWNfaW50ZXJzZWN0aW9uLCBtYWNzX2RvX25vdF9jb250cmFkaWN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3Rfd2lmaV9hZGFwdGVycywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvdWRfaWRfZG9fbm90X2NvbnRyYWRpY3RdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsnUmVhc29uJzogJ1RoZXkgaGF2ZSB0aGUgc2FtZSBob3N0bmFtZV9mcWRuIGFuZCBJUHMgb3IgTUFDcyd9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvcnJlbGF0aW9uUmVhc29uLlN0YXRpY0FuYWx5c2lzKQoKICAgIGRlZiBfY29ycmVsYXRlX2hvc3RuYW1lX2lwKHNlbGYsIGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSk6CiAgICAgICAgbG9nZ2VyLmluZm8oJ1N0YXJ0aW5nIHRvIGNvcnJlbGF0ZSBvbiBIb3N0bmFtZS1JUCcpCiAgICAgICAgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCA9IGZpbHRlcihnZXRfbm9ybWFsaXplZF9ob3N0bmFtZV9zdHIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIoZ2V0X25vcm1hbGl6ZWRfaXAsIGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSkpCiAgICAgICAgcmV0dXJuIHNlbGYuX2J1Y2tldF9jb3JyZWxhdGUobGlzdChmaWx0ZXJlZF9hZGFwdGVyc19saXN0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZ2V0X25vcm1hbGl6ZWRfaG9zdG5hbWVfc3RyXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbY29tcGFyZV9kZXZpY2Vfbm9ybWFsaXplZF9ob3N0bmFtZV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW21hY3NfZG9fbm90X2NvbnRyYWRpY3QsIGlwc19kb19ub3RfY29udHJhZGljdF9vcl9tYWNfaW50ZXJzZWN0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3Rfd2lmaV9hZGFwdGVycywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvdWRfaWRfZG9fbm90X2NvbnRyYWRpY3RdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsnUmVhc29uJzogJ1RoZXkgaGF2ZSB0aGUgc2FtZSBob3N0bmFtZSBhbmQgSVBzIG9yIE1BQ3MnfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3JyZWxhdGlvblJlYXNvbi5TdGF0aWNBbmFseXNpcykKCiAgICBkZWYgX2NvcnJlbGF0X2p1bm9zX3NvbGFyX2lwc19ob3N0bmFtZShzZWxmLCBhZGFwdGVyc190b19jb3JyZWxhdGUpOgogICAgICAgIGxvZ2dlci5pbmZvKCdTdGFydGluZyB0byBjb3JyZWxhdGUgb24gU29sYXJ3aW5kcyBKdW5vcyBJUCcpCiAgICAgICAgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCA9IGZpbHRlcihpc19zb2xhcndpbmRzX25vZGVfb3JfanVub3NfYmFzaWMsIGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSkKICAgICAgICBmaWx0ZXJlZF9hZGFwdGVyc19saXN0ID0gZmlsdGVyKGdldF9zb2xhcndpbmRzX2lwX29yX2hvc3RuYW1lLCBmaWx0ZXJlZF9hZGFwdGVyc19saXN0KQogICAgICAgIHJldHVybiBzZWxmLl9idWNrZXRfY29ycmVsYXRlKGxpc3QoZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2dldF9zb2xhcndpbmRzX2lwX29yX2hvc3RuYW1lXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbY29tcGFyZV9zb2xhcndpbmRzX2lwX29yX2hvc3RuYW1lXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbbm90X3NvbGFyd2luZHNfbm9kZV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeydSZWFzb24nOiAnU29sYXJ3aW5kcyBKdW5vcyBJcHMnfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3JyZWxhdGlvblJlYXNvbi5TdGF0aWNBbmFseXNpcykKCiAgICBkZWYgX2NvcnJlbGF0ZV9ob3N0bmFtZV91c2VyKHNlbGYsIGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSk6CiAgICAgICAgbG9nZ2VyLmluZm8oJ1N0YXJ0aW5nIHRvIGNvcnJlbGF0ZSBvbiBIb3N0bmFtZS1MYXN0VXNlZFVzZXInKQogICAgICAgIGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QgPSBmaWx0ZXIoZ2V0X25vcm1hbGl6ZWRfaG9zdG5hbWVfc3RyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyKGdldF9sYXN0X3VzZWRfdXNlcnMsIGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSkpCiAgICAgICAgcmV0dXJuIHNlbGYuX2J1Y2tldF9jb3JyZWxhdGUobGlzdChmaWx0ZXJlZF9hZGFwdGVyc19saXN0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZ2V0X25vcm1hbGl6ZWRfaG9zdG5hbWVfc3RyXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbY29tcGFyZV9kZXZpY2Vfbm9ybWFsaXplZF9ob3N0bmFtZV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2xhbWJkYSB4OiB4LmdldCgncGx1Z2luX25hbWUnKSBpbiBVU0VSU19DT1JSRUxBVElPTl9BREFQVEVSU10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2NvbXBhcmVfbGFzdF91c2VkX3VzZXJzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3Rfd2lmaV9hZGFwdGVycywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWFsc19kb19ub3RfY29udHJhZGljdF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeydSZWFzb24nOiAnVGhleSBoYXZlIHRoZSBzYW1lIGhvc3RuYW1lIGFuZCBMYXN0VXNlZFVzZXInfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3JyZWxhdGlvblJlYXNvbi5TdGF0aWNBbmFseXNpcykKCiAgICBkZWYgX2NvcnJlbGF0ZV9ob3N0bmFtZV9kb21haW4oc2VsZiwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKToKICAgICAgICBsb2dnZXIuaW5mbygnU3RhcnRpbmcgdG8gY29ycmVsYXRlIG9uIEhvc3RuYW1lLURvbWFpbicpCiAgICAgICAgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCA9IGZpbHRlcihnZXRfbm9ybWFsaXplZF9ob3N0bmFtZV9zdHIsIGZpbHRlcihnZXRfZG9tYWluX2Zvcl9jb3JyZWxhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSkpCiAgICAgICAgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCA9IGZpbHRlcihob3N0bmFtZV9ub3RfcHJvYmxlbWF0aWMsIGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QpCiAgICAgICAgcmV0dXJuIHNlbGYuX2J1Y2tldF9jb3JyZWxhdGUobGlzdChmaWx0ZXJlZF9hZGFwdGVyc19saXN0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZ2V0X25vcm1hbGl6ZWRfaG9zdG5hbWVfc3RyXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbY29tcGFyZV9kZXZpY2Vfbm9ybWFsaXplZF9ob3N0bmFtZV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2lzX2Zyb21fYWRdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtjb21wYXJlX2RvbWFpbl9mb3JfY29ycmVsYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdF93aWZpX2FkYXB0ZXJzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJpYWxzX2RvX25vdF9jb250cmFkaWN0XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7J1JlYXNvbic6ICdUaGV5IGhhdmUgdGhlIHNhbWUgaG9zdG5hbWUgYW5kIGRvbWFpbid9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvcnJlbGF0aW9uUmVhc29uLlN0YXRpY0FuYWx5c2lzKQoKICAgIGRlZiBfY29ycmVsYXRlX2hvc3RuYW1lX29ubHlfaG9zdF9hZGFwdGVyKHNlbGYsIGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSwgY3N2X2Z1bGxfaG9zdG5hbWUpOgogICAgICAgIGxvZ2dlci5pbmZvKCdTdGFydGluZyB0byBjb3JyZWxhdGUgb24gSG9zdG5hbWUtb25seScpCiAgICAgICAgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCA9IGZpbHRlcihnZXRfbm9ybWFsaXplZF9ob3N0bmFtZV9zdHIsIGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSkKICAgICAgICAjIHB5bGludDogZGlzYWJsZT1saW5lLXRvby1sb25nCiAgICAgICAgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCA9IGZpbHRlcihob3N0bmFtZV9ub3RfcHJvYmxlbWF0aWMsIGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QpCiAgICAgICAgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCA9IGZpbHRlcihub3Rfd2lmaV9hZGFwdGVyLCBmaWx0ZXJlZF9hZGFwdGVyc19saXN0KQogICAgICAgIGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QgPSBmaWx0ZXIobGFtYmRhIHg6IHguZ2V0KCdwbHVnaW5fbmFtZScpICE9ICdjaXNjb19tZXJha2lfYWRhcHRlcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZF9hZGFwdGVyc19saXN0KQogICAgICAgIGlmIGNzdl9mdWxsX2hvc3RuYW1lOgogICAgICAgICAgICBpbm5lcl9jb21wYXJlID0gW2NvbXBhcmVfaG9zdG5hbWVdCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaW5uZXJfY29tcGFyZSA9IFtpZl9jc3ZfY29tcGFyZV9mdWxsX3BhdGhdCiAgICAgICAgcmV0dXJuIHNlbGYuX2J1Y2tldF9jb3JyZWxhdGUobGlzdChmaWx0ZXJlZF9hZGFwdGVyc19saXN0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZ2V0X25vcm1hbGl6ZWRfaG9zdG5hbWVfc3RyXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbY29tcGFyZV9kZXZpY2Vfbm9ybWFsaXplZF9ob3N0bmFtZV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2lzX29ubHlfaG9zdF9hZGFwdGVyX29yX3BhbG9fYWx0b192cG5dLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlubmVyX2NvbXBhcmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeydSZWFzb24nOiAnVGhleSBoYXZlIHRoZSBzYW1lIGhvc3RuYW1lIGFuZCBmcm9tIHNwZWNpZmMgYWRhcHRlcnMnfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3JyZWxhdGlvblJlYXNvbi5TdGF0aWNBbmFseXNpcykKCiAgICBkZWYgX2NvcnJlbGF0ZV9zZXJpYWwoc2VsZiwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKToKICAgICAgICBsb2dnZXIuaW5mbygnU3RhcnRpbmcgdG8gY29ycmVsYXRlIG9uIFNlcmlhbCcpCiAgICAgICAgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCA9IGZpbHRlcihnZXRfc2VyaWFsLCBhZGFwdGVyc190b19jb3JyZWxhdGUpCiAgICAgICAgcmV0dXJuIHNlbGYuX2J1Y2tldF9jb3JyZWxhdGUobGlzdChmaWx0ZXJlZF9hZGFwdGVyc19saXN0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZ2V0X3NlcmlhbF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2xhbWJkYSBhLCBiOiBhWydkYXRhJ11bJ2RldmljZV9zZXJpYWwnXS51cHBlcigpID09IGJbJ2RhdGEnXVsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RldmljZV9zZXJpYWwnXS51cHBlcigpXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbYXNzZXRfaG9zdG5hbWVzX2RvX25vdF9jb250cmFkaWN0XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7J1JlYXNvbic6ICdUaGV5IGhhdmUgdGhlIHNhbWUgc2VyaWFsJ30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29ycmVsYXRpb25SZWFzb24uU3RhdGljQW5hbHlzaXMpCgogICAgZGVmIF9jb3JyZWxhdGVfc2VyaWFsX25vX3Moc2VsZiwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKToKICAgICAgICBsb2dnZXIuaW5mbygnU3RhcnRpbmcgdG8gY29ycmVsYXRlIG9uIFNlcmlhbCBubyBzJykKICAgICAgICBmaWx0ZXJlZF9hZGFwdGVyc19saXN0ID0gZmlsdGVyKGdldF9zZXJpYWwsIGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSkKICAgICAgICByZXR1cm4gc2VsZi5fYnVja2V0X2NvcnJlbGF0ZShsaXN0KGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtnZXRfc2VyaWFsX25vX3NdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtjb21wYXJlX3NlcmlhbF9ub19zXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbYXNzZXRfaG9zdG5hbWVzX2RvX25vdF9jb250cmFkaWN0XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7J1JlYXNvbic6ICdUaGV5IGhhdmUgdGhlIHNhbWUgc2VyaWFsIGV2ZW4gd2l0aCBTIGF0IHRoZSBiZWdpbm5pbmcnfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3JyZWxhdGlvblJlYXNvbi5TdGF0aWNBbmFseXNpcykKCiAgICBkZWYgX2NvcnJlbGF0ZV9uZXNzdXNfbm9fc2Nhbl9pZChzZWxmLCBhZGFwdGVyc190b19jb3JyZWxhdGUpOgogICAgICAgIGxvZ2dlci5pbmZvKCdTdGFydGluZyB0byBjb3JyZWxhdGUgb24gbmVzc3VzIGlkJykKICAgICAgICBmaWx0ZXJlZF9hZGFwdGVyc19saXN0ID0gZmlsdGVyKGdldF9uZXNzdXNfbm9fc2Nhbl9pZCwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKQogICAgICAgIHJldHVybiBzZWxmLl9idWNrZXRfY29ycmVsYXRlKGxpc3QoZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2dldF9uZXNzdXNfbm9fc2Nhbl9pZF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2NvbXBhcmVfbmVzc3VzX25vX3NjYW5faWRdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFthc3NldF9ob3N0bmFtZXNfZG9fbm90X2NvbnRyYWRpY3RdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsnUmVhc29uJzogJ1RoZXkgYXJlIHRoZSBzYW1lIG5lc3N1cyBpZCBubyBzY2FuJ30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29ycmVsYXRpb25SZWFzb24uU3RhdGljQW5hbHlzaXMpCgogICAgZGVmIF9jb3JyZWxhdGVfcHJpdmF0ZV9kbnNfaG9zdG5hbWVfcHJlZml4KHNlbGYsIGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSk6CiAgICAgICAgbG9nZ2VyLmluZm8oJ1N0YXJ0aW5nIHRvIGNvcnJlbGF0ZSBvbiBwcml2YXRlIGRucyBob3N0bmFtZSBwcmVmaXgnKQogICAgICAgIGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QgPSBmaWx0ZXIoZ2V0X3ByZWZpeF9wcml2YXRlX2Ruc19vcl9ob3N0bmFtZSwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKQogICAgICAgIHJldHVybiBzZWxmLl9idWNrZXRfY29ycmVsYXRlKGxpc3QoZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2dldF9wcmVmaXhfcHJpdmF0ZV9kbnNfb3JfaG9zdG5hbWVdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtjb21wYXJlX2hvc3RuYW1lX29yX3ByaXZhdGVfZG5zXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZ2V0X3ByaXZhdGVfZG5zX25hbWVdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtpcHNfZG9fbm90X2NvbnRyYWRpY3Rfb3JfbWFjX2ludGVyc2VjdGlvbl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeydSZWFzb24nOiAnVGhleSBhcmUgdGhlIHNhbWUgbnByaXZhdGUgZG5zIGhvc3RuYW1lIHByZWZpeCd9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvcnJlbGF0aW9uUmVhc29uLlN0YXRpY0FuYWx5c2lzKQoKICAgIGRlZiBfY29ycmVsYXRlX2Nsb3VkX2luc3RhbmNlcyhzZWxmLCBhZGFwdGVyc190b19jb3JyZWxhdGUpOgogICAgICAgIGxvZ2dlci5pbmZvKCdTdGFydGluZyB0byBjb3JyZWxhdGUgb24gQ2xvdWQgSW5zdGFuY2VzJykKICAgICAgICBmaWx0ZXJlZF9hZGFwdGVyc19saXN0ID0gZmlsdGVyKGdldF9jbG91ZF9kYXRhLCBhZGFwdGVyc190b19jb3JyZWxhdGUpCiAgICAgICAgcmV0dXJuIHNlbGYuX2J1Y2tldF9jb3JyZWxhdGUobGlzdChmaWx0ZXJlZF9hZGFwdGVyc19saXN0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZ2V0X2Nsb3VkX2RhdGFdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtjb21wYXJlX2Nsb3Vkc10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeydSZWFzb24nOiAnVGhleSBhcmUgdGhlIHNhbWUgY2xvdWQgaW5zdGFuY2UnfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3JyZWxhdGlvblJlYXNvbi5TdGF0aWNBbmFseXNpcykKCiAgICBkZWYgX2NvcnJlbGF0ZV9zZXJpYWxfd2l0aF9iaW9zX3NlcmlhbChzZWxmLCBhZGFwdGVyc190b19jb3JyZWxhdGUpOgogICAgICAgIGxvZ2dlci5pbmZvKCdTdGFydGluZyB0byBjb3JyZWxhdGUgb24gQmlvcyBTZXJpYWwnKQogICAgICAgIGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QgPSBmaWx0ZXIoZ2V0X2Jpb3Nfc2VyaWFsX29yX3NlcmlhbCwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKQogICAgICAgIHJldHVybiBzZWxmLl9idWNrZXRfY29ycmVsYXRlKGxpc3QoZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2dldF9iaW9zX3NlcmlhbF9vcl9zZXJpYWxdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtjb21wYXJlX2Jpb3Nfc2VyaWFsX3NlcmlhbF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2Fzc2V0X2hvc3RuYW1lc19kb19ub3RfY29udHJhZGljdF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeydSZWFzb24nOiAnQmlvcyBzZXJpYWwgb3Igc2VyaWFscyBhcmUgZXF1YWwnfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3JyZWxhdGlvblJlYXNvbi5TdGF0aWNBbmFseXNpcykKCiAgICBkZWYgX2NvcnJlbGF0ZV9zZXJpYWxfd2l0aF9ob3N0bmFtZShzZWxmLCBhZGFwdGVyc190b19jb3JyZWxhdGUpOgogICAgICAgICMgUmlnaHQgbm93IHdlIGRvIGl0IG9ubHkgd2l0aCBBaXJ3YXRjaAogICAgICAgIGxvZ2dlci5pbmZvKCdTdGFydGluZyB0byBjb3JyZWxhdGUgb24gSG9zdG5hbWUtU2VyaWFsJykKICAgICAgICBmaWx0ZXJlZF9hZGFwdGVyc19saXN0ID0gZmlsdGVyKGdldF9ob3N0bmFtZV9vcl9zZXJpYWwsIGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSkKICAgICAgICByZXR1cm4gc2VsZi5fYnVja2V0X2NvcnJlbGF0ZShsaXN0KGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtnZXRfaG9zdG5hbWVfb3Jfc2VyaWFsXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbY29tcGFyZV9ob3N0bmFtZV9zZXJpYWxdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtsYW1iZGEgeDogeC5nZXQoJ3BsdWdpbl9uYW1lJykgaW4gWydhaXJ3YXRjaF9hZGFwdGVyJywgJ2p1bXBjbG91ZF9hZGFwdGVyJ11dLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFthc3NldF9ob3N0bmFtZXNfZG9fbm90X2NvbnRyYWRpY3QsIGlwc19kb19ub3RfY29udHJhZGljdF9vcl9tYWNfaW50ZXJzZWN0aW9uXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7J1JlYXNvbic6ICdIb3N0bmFtZSBvciBzZXJpYWxzIGFyZSBlcXVhbCd9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvcnJlbGF0aW9uUmVhc29uLlN0YXRpY0FuYWx5c2lzKQoKICAgIGRlZiBfY29ycmVsYXRlX3NlcmlhbF93aXRoX2Jpb3Nfc2VyaWFsX25vX3Moc2VsZiwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKToKICAgICAgICBsb2dnZXIuaW5mbygnU3RhcnRpbmcgdG8gY29ycmVsYXRlIG9uIEJpb3MgU2VyaWFsIE5vIFMnKQogICAgICAgIGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QgPSBmaWx0ZXIoZ2V0X2Jpb3Nfc2VyaWFsX29yX3NlcmlhbCwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKQogICAgICAgIHJldHVybiBzZWxmLl9idWNrZXRfY29ycmVsYXRlKGxpc3QoZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2dldF9iaW9zX3NlcmlhbF9vcl9zZXJpYWxfbm9fc10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2NvbXBhcmVfYmlvc19zZXJpYWxfc2VyaWFsX25vX3NdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFthc3NldF9ob3N0bmFtZXNfZG9fbm90X2NvbnRyYWRpY3RdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsnUmVhc29uJzogJ0Jpb3Mgc2VyaWFsIG9yIHNlcmlhbHMgYXJlIGVxdWFsIHdpdGggbm8gUyd9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvcnJlbGF0aW9uUmVhc29uLlN0YXRpY0FuYWx5c2lzKQoKICAgIGRlZiBfY29ycmVsYXRlX3dpdGhfYWQoc2VsZiwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKToKICAgICAgICAiIiIKICAgICAgICBBRCBjb3JyZWxhdGlvbiBpcyBhIGxpdHRsZSBtb3JlIGxvb3NlIC0gd2UgYWxsb3cgY29ycmVsYXRpb24gYmFzZWQgb24gaG9zdG5hbWUgYWxvbmUuCiAgICAgICAgSW4gb3JkZXIgdG8gbG93ZXIgdGhlIGZhbHNlIHBvc2l0aXZlIHJhdGUgd2UgZG9uJ3QgdXNlIHRoZSBub3JtYWxpemVkIGhvc3RuYW1lIGJ1dCByYXRoZXIgdGhlIGZ1bGwgb25lCiAgICAgICAgIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oJ1N0YXJ0aW5nIHRvIGNvcnJlbGF0ZSBvbiBIb3N0bmFtZS1BRCcpCiAgICAgICAgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCA9IGZpbHRlcihnZXRfaG9zdG5hbWVfbm9fbG9jYWxob3N0LCBhZGFwdGVyc190b19jb3JyZWxhdGUpCiAgICAgICAgcmV0dXJuIHNlbGYuX2J1Y2tldF9jb3JyZWxhdGUobGlzdChmaWx0ZXJlZF9hZGFwdGVyc19saXN0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZ2V0X2hvc3RuYW1lXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbY29tcGFyZV9ob3N0bmFtZV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2xhbWJkYSB4OiB4LmdldCgncGx1Z2luX25hbWUnKSA9PSBBQ1RJVkVfRElSRUNUT1JZX1BMVUdJTl9OQU1FXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbbm90X3dpZmlfYWRhcHRlcnNdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsnUmVhc29uJzogJ1RoZXkgaGF2ZSB0aGUgc2FtZSBob3N0bmFtZSBhbmQgb25lIGlzIEFEJ30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29ycmVsYXRpb25SZWFzb24uU3RhdGljQW5hbHlzaXMpCgogICAgZGVmIF9jb3JyZWxhdGVfd2l0aF90d2lzdGxvY2soc2VsZiwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKToKICAgICAgICAiIiIKICAgICAgICBBRCBjb3JyZWxhdGlvbiBpcyBhIGxpdHRsZSBtb3JlIGxvb3NlIC0gd2UgYWxsb3cgY29ycmVsYXRpb24gYmFzZWQgb24gaG9zdG5hbWUgYWxvbmUuCiAgICAgICAgSW4gb3JkZXIgdG8gbG93ZXIgdGhlIGZhbHNlIHBvc2l0aXZlIHJhdGUgd2UgZG9uJ3QgdXNlIHRoZSBub3JtYWxpemVkIGhvc3RuYW1lIGJ1dCByYXRoZXIgdGhlIGZ1bGwgb25lCiAgICAgICAgIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oJ1N0YXJ0aW5nIHRvIGNvcnJlbGF0ZSBvbiBUd2lzdGxvY2snKQogICAgICAgIGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QgPSBmaWx0ZXIoaXNfZnJvbV90d2lzdGxvY2tfb3JfY2xvdWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIoZ2V0X2Fzc2V0X29yX2hvc3RfZnVsbCwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKSkKICAgICAgICByZXR1cm4gc2VsZi5fYnVja2V0X2NvcnJlbGF0ZShsaXN0KGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtnZXRfYXNzZXRfb3JfaG9zdF9mdWxsXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbY29tcGFyZV9hc3NldF9ob3N0c19mdWxsXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbaXNfZnJvbV90d2lzdGxvY2tdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsnUmVhc29uJzogJ1RoZXkgaGF2ZSB0aGUgc2FtZSBob3N0bmFtZSBhcmUgdHdpc3Rsb2NrJ30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29ycmVsYXRpb25SZWFzb24uU3RhdGljQW5hbHlzaXMpCgogICAgZGVmIF9jb3JyZWxhdGVfd2l0aF9kaWdpY2VydF9wa2koc2VsZiwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKToKICAgICAgICBsb2dnZXIuaW5mbygnU3RhcnRpbmcgdG8gY29ycmVsYXRlIG9uIERpZ2ljZXJ0IHBraScpCiAgICAgICAgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCA9IGZpbHRlcihnZXRfYXNzZXRfb3JfaG9zdF9mdWxsLCBhZGFwdGVyc190b19jb3JyZWxhdGUpCiAgICAgICAgcmV0dXJuIHNlbGYuX2J1Y2tldF9jb3JyZWxhdGUobGlzdChmaWx0ZXJlZF9hZGFwdGVyc19saXN0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZ2V0X2Fzc2V0X29yX2hvc3RfZnVsbF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2NvbXBhcmVfYXNzZXRfaG9zdHNfZnVsbF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2lzX2Zyb21fZGlnaWNlcnRfcGtpXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7J1JlYXNvbic6ICdUaGV5IGhhdmUgdGhlIHNhbWUgaG9zdG5hbWUgYW5kIG9uZSBpcyBkaWdpY2VydCBQS0knfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3JyZWxhdGlvblJlYXNvbi5TdGF0aWNBbmFseXNpcykKCiAgICBkZWYgX2NvcnJlbGF0ZV93aXRoX2p1bmlwZXIoc2VsZiwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKToKICAgICAgICAiIiIKICAgICAgICBqdW5pcGVyIGNvcnJlbGF0aW9uIGlzIGEgbGl0dGxlIG1vcmUgbG9vc2UgLSB3ZSBhbGxvdyBjb3JyZWxhdGlvbiBiYXNlZCBvbiBhc3NldCBuYW1lIGFsb25lLAogICAgICAgICIiIgogICAgICAgIGxvZ2dlci5pbmZvKCdTdGFydGluZyB0byBjb3JyZWxhdGUgb24gYXNzZXQtbmFtZSBqdW5pcGVyJykKICAgICAgICBmaWx0ZXJlZF9hZGFwdGVyc19saXN0ID0gZmlsdGVyKGlzX2Zyb21fanVuaXBlcl9hbmRfYXNzZXRfbmFtZSwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKQogICAgICAgIHJldHVybiBzZWxmLl9idWNrZXRfY29ycmVsYXRlKGxpc3QoZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2dldF9hc3NldF9uYW1lXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbY29tcGFyZV9hc3NldF9uYW1lXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbaXNfanVub3Nfc3BhY2VfZGV2aWNlXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7J1JlYXNvbic6ICdKdW5pcGVyIGRldmljZXMgd2l0aCBzYW1lIGFzc2V0IG5hbWUnfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3JyZWxhdGlvblJlYXNvbi5TdGF0aWNBbmFseXNpcykKCiAgICBkZWYgX2NvcnJlbGF0ZV9kZWVwX2F3c19pZChzZWxmLCBhZGFwdGVyc190b19jb3JyZWxhdGUpOgogICAgICAgIGxvZ2dlci5pbmZvKGYnU3RhcnRpbmcgdG8gY29ycmVsYXRlIG9uIGRlZXAgYXdzIGlzJykKICAgICAgICBmaWx0ZXJlZF9hZGFwdGVyc19saXN0ID0gZmlsdGVyKGlzX2Zyb21fZGVlcHNfb3JfYXdzLCBhZGFwdGVyc190b19jb3JyZWxhdGUpCiAgICAgICAgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCA9IGZpbHRlcihnZXRfY2xvdWRfaWRfb3JfaG9zdG5hbWUsIGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QpCiAgICAgICAgcmV0dXJuIHNlbGYuX2J1Y2tldF9jb3JyZWxhdGUobGlzdChmaWx0ZXJlZF9hZGFwdGVyc19saXN0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZ2V0X2Nsb3VkX2lkX29yX2hvc3RuYW1lXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbY29tcGFyZV9jbG91ZF9pZF9vcl9ob3N0bmFtZV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2xhbWJkYSB4OiB4LmdldCgncGx1Z2luX25hbWUnKSA9PSAnYXdzX2FkYXB0ZXInXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7J1JlYXNvbic6ICdDbG91ZCBJRCBhbmQgSG9zdG5hbWUgYXJlIHRoZSBzYW1lJ30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29ycmVsYXRpb25SZWFzb24uU3RhdGljQW5hbHlzaXMpCgogICAgZGVmIF9jb3JyZWxhdGVfYXdzX3JvdXRlNTNfZG5zX25hbWVzKHNlbGYsIGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSk6CiAgICAgICAgbG9nZ2VyLmluZm8oZidTdGFydGluZyB0byBjb3JyZWxhdGUgb24gZG5zX25hbWVzJykKICAgICAgICBmaWx0ZXJlZF9hZGFwdGVyc19saXN0ID0gZmlsdGVyKGxhbWJkYSB4OiB4LmdldCgncGx1Z2luX25hbWUnKSA9PSAnYXdzX2FkYXB0ZXInLCBhZGFwdGVyc190b19jb3JyZWxhdGUpCiAgICAgICAgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCA9IGZpbHRlcihnZXRfZG5zX25hbWVzLCBmaWx0ZXJlZF9hZGFwdGVyc19saXN0KQoKICAgICAgICBhZGFwdGVyc190b19jb3JyZWxhdGVfYnlfZG5zX25hbWUgPSBkZWZhdWx0ZGljdChsaXN0KQogICAgICAgIGZvciBhZGFwdGVyX3RvX2NvcnJlbGF0ZSBpbiBsaXN0KGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QpOgogICAgICAgICAgICBmb3IgZG5zX25hbWVfY2FuZGlkYXRlIGluIChhZGFwdGVyX3RvX2NvcnJlbGF0ZVsnZGF0YSddLmdldCgnZG5zX25hbWVzJykgb3IgW10pOgogICAgICAgICAgICAgICAgYWRhcHRlcnNfdG9fY29ycmVsYXRlX2J5X2Ruc19uYW1lW2Ruc19uYW1lX2NhbmRpZGF0ZV0uYXBwZW5kKGFkYXB0ZXJfdG9fY29ycmVsYXRlKQoKICAgICAgICBmb3IgYWRhcHRlcnNfdG9fY29ycmVsYXRlX2J1Y2tldHMgaW4gYWRhcHRlcnNfdG9fY29ycmVsYXRlX2J5X2Ruc19uYW1lLnZhbHVlcygpOgogICAgICAgICAgICB5aWVsZCBmcm9tIHNlbGYuX2J1Y2tldF9jb3JyZWxhdGUoYWRhcHRlcnNfdG9fY29ycmVsYXRlX2J1Y2tldHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2xhbWJkYSB4OiB4WydkYXRhJ10uZ2V0KCdhd3NfZGV2aWNlX3R5cGUnKSA9PSAnUm91dGU1MyddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7J1JlYXNvbic6ICdBV1MgRE5TIE5hbWVzIGFyZSB0aGUgc2FtZSd9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29ycmVsYXRpb25SZWFzb24uU3RhdGljQW5hbHlzaXMpCgogICAgZGVmIF9jb3JyZWxhdGVfYWRfc2NjbV9pZChzZWxmLCBhZGFwdGVyc190b19jb3JyZWxhdGUpOgogICAgICAgICIiIgogICAgICAgIFdlIHdhbnQgdG8gZ2V0IGFsbCB0aGUgZGV2aWNlcyB3aXRoIGhvc3RuYW1lICh0byByZWR1Y2UgYW1vdW50KSwKICAgICAgICAgdGhlbiBjaGVjayBpZiBvbmUgYWRhcHRlciBpcyBTQ0NNIGFuZCBvbmUgaXMgQUQgYW5kIHRvIGNvbXBhcmUgdGhlaXIgSUQKICAgICAgICAiIiIKICAgICAgICBsb2dnZXIuaW5mbygnU3RhcnRpbmcgdG8gY29ycmVsYXRlIG9uIFNDQ00tQUQnKQogICAgICAgIGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QgPSBmaWx0ZXIoaXNfc2NjbV9vcl9hZCwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKQogICAgICAgIGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QgPSBmaWx0ZXIoaXNfd2luZG93cywgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCkKICAgICAgICBmaWx0ZXJlZF9hZGFwdGVyc19saXN0ID0gZmlsdGVyKGdldF9kc3RfbmFtZSwgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCkKICAgICAgICByZXR1cm4gc2VsZi5fYnVja2V0X2NvcnJlbGF0ZShsaXN0KGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtnZXRfZHN0X25hbWVdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtjb21wYXJlX2RzdF9uYW1lXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7J1JlYXNvbic6ICdUaGV5IGhhdmUgdGhlIHNhbWUgSUQgYW5kIG9uZSBpcyBBRCBhbmQgdGhlIHNlY29uZCBpcyBTQ0NNJ30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29ycmVsYXRpb25SZWFzb24uU3RhdGljQW5hbHlzaXMpCgogICAgZGVmIF9jb3JyZWxhdGFfYXp1cmVfYWRfaW50dW5lKHNlbGYsIGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSk6CiAgICAgICAgbG9nZ2VyLmluZm8oJ1N0YXJ0aW5nIHRvIGNvcnJlbGF0ZSBvbiBJbnR1bmUgQXp1emUgYWQnKQogICAgICAgIGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QgPSBmaWx0ZXIoZ2V0X2F6dXJlX2FkX2lkLCBhZGFwdGVyc190b19jb3JyZWxhdGUpCiAgICAgICAgcmV0dXJuIHNlbGYuX2J1Y2tldF9jb3JyZWxhdGUobGlzdChmaWx0ZXJlZF9hZGFwdGVyc19saXN0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZ2V0X2F6dXJlX2FkX2lkXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbY29tcGFyZV9henVyZV9hZF9pZF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeydSZWFzb24nOiAnVGhleSBoYXZlIHRoZSBzYW1lIEFaVVJFIEFEIElEJ30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29ycmVsYXRpb25SZWFzb24uU3RhdGljQW5hbHlzaXMpCgogICAgZGVmIF9jb3JyZWxhdGVfYWRfYXp1cmVfYWQoc2VsZiwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKToKICAgICAgICAiIiIKICAgICAgICBDb3JyZWxhdGUgQXp1cmUgQUQgYW5kIEFECiAgICAgICAgIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oJ1N0YXJ0aW5nIHRvIGNvcnJlbGF0ZSBvbiBBRC1BenVyZUFEJykKICAgICAgICBmaWx0ZXJlZF9hZGFwdGVyc19saXN0ID0gZmlsdGVyKGlzX2F6dXJlYWRfb3JfYWRfYW5kX2hhdmVfbmFtZSwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKQogICAgICAgIHJldHVybiBzZWxmLl9idWNrZXRfY29ycmVsYXRlKGxpc3QoZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2dldF9hZF9uYW1lX29yX2F6dXJlX2Rpc3BsYXlfbmFtZV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2NvbXBhcmVfYWRfbmFtZV9vcl9henVyZV9kaXNwbGF5X25hbWVdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtpc19mcm9tX2FkXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZG9tYWluX2RvX25vdF9jb250cmFkaWN0LCBob3N0bmFtZXNfZG9fbm90X2NvbnRyYWRpY3RdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsnUmVhc29uJzogJ1RoZXkgaGF2ZSB0aGUgc2FtZSBkaXNwbGF5IG5hbWUnfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3JyZWxhdGlvblJlYXNvbi5TdGF0aWNBbmFseXNpcykKCiAgICBkZWYgX2NvcnJlbGF0ZV9hc3NldF9ob3N0KHNlbGYsIGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSwgY29ycmVsYXRlX2F6dXJlX2FkX25hbWVfb25seSk6CiAgICAgICAgIiIiCiAgICAgICAgQ29ycmVsYXRpbmcgYnkgYXNzZXQgZmlyc3QgKyBJUAogICAgICAgIDpwYXJhbSBhZGFwdGVyc190b19jb3JyZWxhdGU6CiAgICAgICAgOnJldHVybjoKICAgICAgICAiIiIKICAgICAgICBsb2dnZXIuaW5mbygnU3RhcnRpbmcgdG8gY29ycmVsYXRlIG9uIEFzc2V0LUhvc3QnKQogICAgICAgIGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QgPSBmaWx0ZXIoZ2V0X2Fzc2V0X29yX2hvc3QsIGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSkKCiAgICAgICAgaW5uZXJfcnVsZXMgPSBbbm90X3dpZmlfYWRhcHRlcnMsIG1hY3NfZG9fbm90X2NvbnRyYWRpY3QsCiAgICAgICAgICAgICAgICAgICAgICAgYXNzZXRfaG9zdG5hbWVzX2RvX25vdF9jb250cmFkaWN0X2FuZF9ub19jaGVmLAogICAgICAgICAgICAgICAgICAgICAgIHNlcmlhbHNfZG9fbm90X2NvbnRyYWRpY3RdCiAgICAgICAgaWYgbm90IGNvcnJlbGF0ZV9henVyZV9hZF9uYW1lX29ubHk6CiAgICAgICAgICAgIGlubmVyX3J1bGVzLmFwcGVuZChpcHNfZG9fbm90X2NvbnRyYWRpY3Rfb3JfbWFjX2ludGVyc2VjdGlvbl9vcl9hc3NldF9vbmx5X2FkYXB0ZXIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaW5uZXJfcnVsZXMuYXBwZW5kKGlwc19kb19ub3RfY29udHJhZGljdF9vcl9tYWNfaW50ZXJzZWN0aW9uX29yX2Fzc2V0X29ubHlfYWRhcHRlcl9hbmRfYXp1cmVfYWQpCiAgICAgICAgcmV0dXJuIHNlbGYuX2J1Y2tldF9jb3JyZWxhdGUobGlzdChmaWx0ZXJlZF9hZGFwdGVyc19saXN0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZ2V0X2Fzc2V0X29yX2hvc3RdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtjb21wYXJlX2Fzc2V0X2hvc3RzXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZ2V0X2Fzc2V0X25hbWVdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlubmVyX3J1bGVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsnUmVhc29uJzogJ1RoZXkgaGF2ZSB0aGUgc2FtZSBBc3NldCBuYW1lJ30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29ycmVsYXRpb25SZWFzb24uU3RhdGljQW5hbHlzaXMpCgogICAgZGVmIF9jb3JyZWxhdGVfYXNzZXRfaG9zdF9lbWFpbChzZWxmLCBhZGFwdGVyc190b19jb3JyZWxhdGUpOgogICAgICAgICIiIgogICAgICAgIENvcnJlbGF0aW5nIGJ5IGFzc2V0IGZpcnN0ICsgSVAKICAgICAgICA6cGFyYW0gYWRhcHRlcnNfdG9fY29ycmVsYXRlOgogICAgICAgIDpyZXR1cm46CiAgICAgICAgIiIiCiAgICAgICAgbG9nZ2VyLmluZm8oJ1N0YXJ0aW5nIHRvIGNvcnJlbGF0ZSBvbiBBc3NldC1Ib3N0IEVtYWlsJykKICAgICAgICBmaWx0ZXJlZF9hZGFwdGVyc19saXN0ID0gZmlsdGVyKGdldF9hc3NldF9vcl9ob3N0LCBhZGFwdGVyc190b19jb3JyZWxhdGUpCiAgICAgICAgcmV0dXJuIHNlbGYuX2J1Y2tldF9jb3JyZWxhdGUobGlzdChmaWx0ZXJlZF9hZGFwdGVyc19saXN0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZ2V0X2Fzc2V0X29yX2hvc3RdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtjb21wYXJlX2Fzc2V0X2hvc3RzXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZ2V0X2Fzc2V0X25hbWVdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtjb21wYXJlX2VtYWlscywgbWFjc19kb19ub3RfY29udHJhZGljdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm90X3dpZmlfYWRhcHRlcnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2V0X2hvc3RuYW1lc19kb19ub3RfY29udHJhZGljdF9hbmRfbm9fY2hlZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VyaWFsc19kb19ub3RfY29udHJhZGljdF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeydSZWFzb24nOiAnVGhleSBoYXZlIHRoZSBzYW1lIEFzc2V0IG5hbWUgYW5kIEVNQUlMJ30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29ycmVsYXRpb25SZWFzb24uU3RhdGljQW5hbHlzaXMpCgogICAgZGVmIF9jb3JyZWxhdGVfYXNzZXRfc25vd19ob3N0KHNlbGYsIGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSk6CiAgICAgICAgIiIiCiAgICAgICAgQ29ycmVsYXRpbmcgYnkgYXNzZXQgZmlyc3QgKyBJUAogICAgICAgIDpwYXJhbSBhZGFwdGVyc190b19jb3JyZWxhdGU6CiAgICAgICAgOnJldHVybjoKICAgICAgICAiIiIKICAgICAgICBsb2dnZXIuaW5mbygnU3RhcnRpbmcgdG8gY29ycmVsYXRlIG9uIHNub3dBc3NldC1Ib3N0JykKICAgICAgICBmaWx0ZXJlZF9hZGFwdGVyc19saXN0ID0gZmlsdGVyKGdldF9hc3NldF9zbm93X29yX2hvc3QsIGZpbHRlcihnZXRfbm9ybWFsaXplZF9pcCwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKSkKICAgICAgICByZXR1cm4gc2VsZi5fYnVja2V0X2NvcnJlbGF0ZShsaXN0KGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtnZXRfYXNzZXRfc25vd19vcl9ob3N0XSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbY29tcGFyZV9zbm93X2Fzc2V0X2hvc3RzXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbaXNfc25vd19kZXZpY2VdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtpcHNfZG9fbm90X2NvbnRyYWRpY3Rfb3JfbWFjX2ludGVyc2VjdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm90X3dpZmlfYWRhcHRlcnMsIG1hY3NfZG9fbm90X2NvbnRyYWRpY3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3VkX2lkX2RvX25vdF9jb250cmFkaWN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NldF9ob3N0bmFtZXNfZG9fbm90X2NvbnRyYWRpY3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlcmlhbHNfZG9fbm90X2NvbnRyYWRpY3RdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsnUmVhc29uJzogJ1RoZXkgaGF2ZSB0aGUgc2FtZSBTTk9XIEFzc2V0ICsgSG9zdG5hbWUgbmFtZSd9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvcnJlbGF0aW9uUmVhc29uLlN0YXRpY0FuYWx5c2lzKQoKICAgIGRlZiBfY29ycmVsYXRlX3V1aWQoc2VsZiwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKToKICAgICAgICBsb2dnZXIuaW5mbygnU3RhcnRpbmcgdG8gY29ycmVsYXRlIFVVSUQnKQogICAgICAgIGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QgPSBmaWx0ZXIoZ2V0X3V1aWQsIGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSkKICAgICAgICBmaWx0ZXJlZF9hZGFwdGVyc19saXN0ID0gZmlsdGVyKGlzX3V1aWRfYWRhcHRlcnMsIGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QpCiAgICAgICAgcmV0dXJuIHNlbGYuX2J1Y2tldF9jb3JyZWxhdGUobGlzdChmaWx0ZXJlZF9hZGFwdGVyc19saXN0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZ2V0X3V1aWRdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtjb21wYXJlX3V1aWRdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtob3N0bmFtZXNfZG9fbm90X2NvbnRyYWRpY3RdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsnUmVhc29uJzogJ1RoZXkgaGF2ZSB0aGUgc2FtZSBVVUlEJ30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29ycmVsYXRpb25SZWFzb24uU3RhdGljQW5hbHlzaXMpCgogICAgZGVmIF9jb3JyZWxhdGVfc3BsdW5rX3Zwbl9ob3N0bmFtZShzZWxmLCBhZGFwdGVyc190b19jb3JyZWxhdGUpOgogICAgICAgIGxvZ2dlci5pbmZvKCdTdGFydGluZyB0byBjb3JyZWxhdGUgb24gU3BsdW5rIFZQTicpCiAgICAgICAgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCA9IGZpbHRlcihpc19zcGx1bmtfdnBuLCBhZGFwdGVyc190b19jb3JyZWxhdGUpCiAgICAgICAgcmV0dXJuIHNlbGYuX2J1Y2tldF9jb3JyZWxhdGUobGlzdChmaWx0ZXJlZF9hZGFwdGVyc19saXN0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZ2V0X25vcm1hbGl6ZWRfaG9zdG5hbWVfc3RyXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbY29tcGFyZV9kZXZpY2Vfbm9ybWFsaXplZF9ob3N0bmFtZV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeydSZWFzb24nOiAnVGhleSBoYXZlIHRoZSBzYW1lIE5vcm1hbGl6ZWQgaG9zdG5hbWUgYW5kIGJvdGggYXJlIFNwbHVuayBWUE4nfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3JyZWxhdGlvblJlYXNvbi5TdGF0aWNBbmFseXNpcykKCiAgICBkZWYgX2NvcnJlbGF0ZV9zY2VwX3NjY20oc2VsZiwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKToKICAgICAgICBsb2dnZXIuaW5mbygnU3RhcnRpbmcgdG8gY29ycmVsYXRlIFNDRVAgU0NDTScpCiAgICAgICAgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCA9IGZpbHRlcihnZXRfcmVzb3VyY2VfaWQsIGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSkKICAgICAgICBmaWx0ZXJlZF9hZGFwdGVyc19saXN0ID0gZmlsdGVyKGdldF9zY2NtX3NlcnZlciwgZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCkKICAgICAgICByZXR1cm4gc2VsZi5fYnVja2V0X2NvcnJlbGF0ZShsaXN0KGZpbHRlcmVkX2FkYXB0ZXJzX2xpc3QpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtnZXRfcmVzb3VyY2VfaWRdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtjb21wYXJlX3Jlc291cmNlX2lkXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbY29tcGFyZV9zY2NtX3NlcnZlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXRfaG9zdG5hbWVzX2RvX25vdF9jb250cmFkaWN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpcHNfZG9fbm90X2NvbnRyYWRpY3Rfb3JfbWFjX2ludGVyc2VjdGlvbl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeydSZWFzb24nOiAnVGhleSBoYXZlIHRoZSBzYW1lIHJlc291cmNlIElEIHBsdXMgU0NDTSBTRVJWRVInfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3JyZWxhdGlvblJlYXNvbi5TdGF0aWNBbmFseXNpcykKCiAgICBkZWYgX2NvcnJlbGF0ZV9mcmllbmRseV9hZF9uYW1lKHNlbGYsIGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSk6CiAgICAgICAgbG9nZ2VyLmluZm8oJ1N0YXJ0aW5nIHRvIGNvcnJlbGF0ZSBmcmllbmRseSBuYW1lIGFuZCBhZCBuYW1lJykKICAgICAgICBmaWx0ZXJlZF9hZGFwdGVyc19saXN0ID0gZmlsdGVyKGZyaWVuZGx5X25hbWVfb3JfYWRfbmFtZSwgYWRhcHRlcnNfdG9fY29ycmVsYXRlKQogICAgICAgIHJldHVybiBzZWxmLl9idWNrZXRfY29ycmVsYXRlKGxpc3QoZmlsdGVyZWRfYWRhcHRlcnNfbGlzdCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2ZyaWVuZGx5X25hbWVfb3JfYWRfbmFtZV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2NvbXBhcmVfZnJpZW5kbHlfYWRfbmFtZV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW29uZV9pc19hZF9vbmVfaXNfYWlyd2F0Y2hdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsnUmVhc29uJzogJ1RoZXkgaGF2ZSB0aGUgZnJpZW5kbHkgYW5kIEFEIG5hbWUgdGhlIHNhZW0nfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3JyZWxhdGlvblJlYXNvbi5TdGF0aWNBbmFseXNpcykKCiAgICBkZWYgX2NvcnJlbGF0ZV9hZ2VudF91dWlkKHNlbGYsIGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSk6CiAgICAgICAgbG9nZ2VyLmluZm8oJ1N0YXJ0aW5nIHRvIGNvcnJlbGF0ZSBBZ2VudCBVVUlEJykKICAgICAgICBmaWx0ZXJlZF9hZGFwdGVyc19saXN0ID0gZmlsdGVyKGdldF9hZ2VudF91dWlkLCBhZGFwdGVyc190b19jb3JyZWxhdGUpCiAgICAgICAgcmV0dXJuIHNlbGYuX2J1Y2tldF9jb3JyZWxhdGUobGlzdChmaWx0ZXJlZF9hZGFwdGVyc19saXN0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbZ2V0X2FnZW50X3V1aWRdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtjb21wYXJlX2FnZW50X3V1aWRzXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7J1JlYXNvbic6ICdUaGV5IGhhdmUgdGhlIHNhbWUgQWdlbnQgVVVJRCd9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvcnJlbGF0aW9uUmVhc29uLlN0YXRpY0FuYWx5c2lzKQoKICAgIGRlZiBfcmF3X2NvcnJlbGF0ZShzZWxmLCBlbnRpdGllcyk6CiAgICAgICAgIyBXQVJOSU5HIFdBUk5JTkcgV0FSTklORwogICAgICAgICMgQWRkaW5nIG9yIGNoYW5naW5nIGFueSB0eXBlIG9mIGNvcnJlbGF0aW9uIGhlcmUgbWlnaHQgcmVxdWlyZSBjaGFuZ2luZyB0aGUgYXBwcm9wcmlhdGUgbG9naWMKICAgICAgICAjIGF0IHN0YXRpY19jb3JyZWxhdG9yL3NlcnZpY2UKCiAgICAgICAgIyBzaW5jZSB0aGlzIG9wZXJhdGlvbiBpcyBleHRyZW1lbHkgY29zdGx5LCB3ZSBub3JtYWxpemUgdGhlIGFkYXB0ZXJfZGV2aWNlczoKICAgICAgICAjIDEuIGFkZGluZyAyIGZpZWxkcyB0byB0aGUgcm9vdCAtIE5PUk1BTElaRURfSVBTIGFuZCBOT1JNQUxJWkVEX01BQ1MgdG8gYWxsb3cgZWFzeSBhY2Nlc3MgdG8gdGhlIGlwcyBhbmQgbWFjcwogICAgICAgICMgICAgb2YgYWxsIHRoZSBOSUNzCiAgICAgICAgIyAyLiB1cHBlcmluZyBldmVyeSBmaWVsZCB3ZSBtaWdodCBzb3J0IGJ5IC0gY3VycmVudGx5IGhvc3RuYW1lIGFuZCBvcyB0eXBlCiAgICAgICAgIyAzLiBzcGxpdHRpbmcgdGhlIGhvc3RuYW1lIGludG8gYSBsaXN0IGluIG9yZGVyIHRvIGJlIGFibGUgdG8gY29tcGFyZSBob3N0bmFtZXMgd2l0aG91dCBkZXBlbmRpbmcgb24gdGhlIGRvbWFpbgogICAgICAgIF9yZWZyZXNoX2RvbWFpbl90b19kbnNfZGljdCgpCiAgICAgICAgX3JlZnJlc2hfYWRfY2xpZW50X2NvdW50KCkKICAgICAgICBhZGFwdGVyc190b19jb3JyZWxhdGUgPSBsaXN0KG5vcm1hbGl6ZV9hZGFwdGVyX2RldmljZXMoZW50aXRpZXMpKQoKICAgICAgICBjb3JyZWxhdGVfYnlfc25vd19tYWMgPSBib29sKHNlbGYuX2NvcnJlbGF0aW9uX2NvbmZpZyBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2NvcnJlbGF0aW9uX2NvbmZpZy5nZXQoJ2NvcnJlbGF0ZV9ieV9zbm93X21hYycpIGlzIFRydWUpCgogICAgICAgIGNvcnJlbGF0ZV9henVyZV9hZF9uYW1lX29ubHkgPSBib29sKHNlbGYuX2NvcnJlbGF0aW9uX2NvbmZpZyBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9jb3JyZWxhdGlvbl9jb25maWcuZ2V0KCdjb3JyZWxhdGVfYXp1cmVfYWRfbmFtZV9vbmx5JykgaXMgVHJ1ZSkKICAgICAgICAjIGxldCdzIGZpbmQgZGV2aWNlcyBieSwgaG9zdG5hbWUsIGFuZCBpcDoKICAgICAgICB5aWVsZCBmcm9tIHNlbGYuX2NvcnJlbGF0ZV9ob3N0bmFtZV9pcChhZGFwdGVyc190b19jb3JyZWxhdGUpCiAgICAgICAgeWllbGQgZnJvbSBzZWxmLl9jb3JyZWxhdGVfaG9zdG5hbWVfZnFkbl9pcChhZGFwdGVyc190b19jb3JyZWxhdGUpCiAgICAgICAgIyBmb3IgYWQgc3BlY2lmaWNhbGx5IHdlIGFkZGVkIHRoZSBvcHRpb24gdG8gY29ycmVsYXRlIG9uIGhvc3RuYW1lIGJhc2lzIGFsb25lIChkbnMgbmFtZSB3aXRoIHRoZSBkb21haW4pCiAgICAgICAgeWllbGQgZnJvbSBzZWxmLl9jb3JyZWxhdGVfd2l0aF9hZChhZGFwdGVyc190b19jb3JyZWxhdGUpCgogICAgICAgIHlpZWxkIGZyb20gc2VsZi5fY29ycmVsYXRlX2hvc3RuYW1lX2RvbWFpbihhZGFwdGVyc190b19jb3JyZWxhdGUpCgogICAgICAgIHlpZWxkIGZyb20gc2VsZi5fY29ycmVsYXRlX2hvc3RuYW1lX3VzZXIoYWRhcHRlcnNfdG9fY29ycmVsYXRlKQoKICAgICAgICB5aWVsZCBmcm9tIHNlbGYuX2NvcnJlbGF0X2p1bm9zX3NvbGFyX2lwc19ob3N0bmFtZShhZGFwdGVyc190b19jb3JyZWxhdGUpCgogICAgICAgIGNzdl9mdWxsX2hvc3RuYW1lID0gYm9vbChzZWxmLl9jb3JyZWxhdGlvbl9jb25maWcgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2NvcnJlbGF0aW9uX2NvbmZpZy5nZXQoJ2Nzdl9mdWxsX2hvc3RuYW1lJykgaXMgVHJ1ZSkKICAgICAgICB5aWVsZCBmcm9tIHNlbGYuX2NvcnJlbGF0ZV9ob3N0bmFtZV9vbmx5X2hvc3RfYWRhcHRlcihhZGFwdGVyc190b19jb3JyZWxhdGUsIGNzdl9mdWxsX2hvc3RuYW1lKQoKICAgICAgICAjIENvcnJlbGF0aW5nIG1hYyBtdXN0IGhhcHBlbiBhZnRlciBhbGwgdGhlIG90aGVyIGNvcnJlbGF0aW9ucyBhcmUgRE9ORS4KICAgICAgICAjIHRoZSBhY3R1YWwgbGlua2luZyBpcyBoYXBwZW5kIGluIF9wcm9jZXNzX2NvcnJlbGF0aW9uX3Jlc3VsdCBpbiBvdGhlciB0aHJlYWQsCiAgICAgICAgIyBzbyBpbiBvcmRlciB0byBzb2x2ZSB0aGUgcmFjZSBjb25kaXRpb24gd2UgeWllbGQgbWFya2VyIGhlcmUgYW5kCiAgICAgICAgIyB3YWl0IGZvciBhbGwgY29ycmVsYXRpb24gdG8gZW5kIHVudGlsIHRoZSBtYXJrZXIgaW4gX21hcF9jb3JyZWxhdGlvbgogICAgICAgIHlpZWxkIENvcnJlbGF0aW9uTWFya2VyKCkKCiAgICAgICAgeWllbGQgZnJvbSBzZWxmLl9jb3JyZWxhdGVfd2l0aF90d2lzdGxvY2soYWRhcHRlcnNfdG9fY29ycmVsYXRlKQoKICAgICAgICB5aWVsZCBmcm9tIHNlbGYuX2NvcnJlbGF0ZV93aXRoX2RpZ2ljZXJ0X3BraShhZGFwdGVyc190b19jb3JyZWxhdGUpCgogICAgICAgICMgRmluZCBhZGFwdGVycyB0aGF0IHNoYXJlIHRoZSBzYW1lIGNsb3VkIHR5cGUgYW5kIGNsb3VkIGlkCiAgICAgICAgeWllbGQgZnJvbSBzZWxmLl9jb3JyZWxhdGVfY2xvdWRfaW5zdGFuY2VzKGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSkKCiAgICAgICAgIyBGaW5kIFNDQ00gb3IgQWQgYWRhcHRlcnMgd2l0aCB0aGUgc2FtZSBJRAogICAgICAgIGlmIHNlbGYuX2NvcnJlbGF0aW9uX2NvbmZpZyBhbmQgc2VsZi5fY29ycmVsYXRpb25fY29uZmlnLmdldCgnY29ycmVsYXRlX2FkX3NjY20nKSBpcyBUcnVlOgogICAgICAgICAgICB5aWVsZCBmcm9tIHNlbGYuX2NvcnJlbGF0ZV9hZF9zY2NtX2lkKGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSkKCiAgICAgICAgIyBGaW5kIGF6dXJlIGFkIGFuZCBhZCB3aXRoIHRoZSBzYW1lIGRpc3BsYXkgbmFtZQogICAgICAgIHlpZWxkIGZyb20gc2VsZi5fY29ycmVsYXRlX2FkX2F6dXJlX2FkKGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSkKCiAgICAgICAgeWllbGQgZnJvbSBzZWxmLl9jb3JyZWxhdGFfYXp1cmVfYWRfaW50dW5lKGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSkKCiAgICAgICAgIyBqdW5pcGVyIGNvcnJlbGF0aW9uIGlzIGEgbGl0dGxlIG1vcmUgbG9vc2UgLSB3ZSBhbGxvdyBjb3JyZWxhdGlvbiBiYXNlZCBvbiBhc3NldCBuYW1lIGFsb25lLAogICAgICAgIHlpZWxkIGZyb20gc2VsZi5fY29ycmVsYXRlX3dpdGhfanVuaXBlcihhZGFwdGVyc190b19jb3JyZWxhdGUpCgogICAgICAgIHlpZWxkIGZyb20gc2VsZi5fY29ycmVsYXRlX2Fzc2V0X2hvc3QoYWRhcHRlcnNfdG9fY29ycmVsYXRlLCBjb3JyZWxhdGVfYXp1cmVfYWRfbmFtZV9vbmx5KQogICAgICAgIHlpZWxkIGZyb20gc2VsZi5fY29ycmVsYXRlX2Fzc2V0X2hvc3RfZW1haWwoYWRhcHRlcnNfdG9fY29ycmVsYXRlKQoKICAgICAgICB5aWVsZCBmcm9tIHNlbGYuX2NvcnJlbGF0ZV9hc3NldF9zbm93X2hvc3QoYWRhcHRlcnNfdG9fY29ycmVsYXRlKQoKICAgICAgICB5aWVsZCBmcm9tIHNlbGYuX2NvcnJlbGF0ZV9zcGx1bmtfdnBuX2hvc3RuYW1lKGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSkKCiAgICAgICAgeWllbGQgZnJvbSBzZWxmLl9jb3JyZWxhdGVfc2VyaWFsKGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSkKCiAgICAgICAgeWllbGQgZnJvbSBzZWxmLl9jb3JyZWxhdGVfc2VyaWFsX3dpdGhfYmlvc19zZXJpYWwoYWRhcHRlcnNfdG9fY29ycmVsYXRlKQogICAgICAgIHlpZWxkIGZyb20gc2VsZi5fY29ycmVsYXRlX3NlcmlhbF93aXRoX2Jpb3Nfc2VyaWFsX25vX3MoYWRhcHRlcnNfdG9fY29ycmVsYXRlKQogICAgICAgIHlpZWxkIGZyb20gc2VsZi5fY29ycmVsYXRlX3NlcmlhbF9ub19zKGFkYXB0ZXJzX3RvX2NvcnJlbGF0ZSkKICAgICAgICB5aWVsZCBmcm9tIHNlbGYuX2NvcnJlbGF0ZV9zZXJpYWxfd2l0aF9ob3N0bmFtZShhZGFwdGVyc190b19jb3JyZWxhdGUpCiAgICAgICAgeWllbGQgZnJvbSBzZWxmLl9jb3JyZWxhdGVfbmVzc3VzX25vX3NjYW5faWQoYWRhcHRlcnNfdG9fY29ycmVsYXRlKQogICAgICAgIHlpZWxkIGZyb20gc2VsZi5fY29ycmVsYXRlX3V1aWQoYWRhcHRlcnNfdG9fY29ycmVsYXRlKQogICAgICAgIHlpZWxkIGZyb20gc2VsZi5fY29ycmVsYXRlX3NjZXBfc2NjbShhZGFwdGVyc190b19jb3JyZWxhdGUpCiAgICAgICAgeWllbGQgZnJvbSBzZWxmLl9jb3JyZWxhdGVfZGVlcF9hd3NfaWQoYWRhcHRlcnNfdG9fY29ycmVsYXRlKQogICAgICAgIHlpZWxkIGZyb20gc2VsZi5fY29ycmVsYXRlX2FnZW50X3V1aWQoYWRhcHRlcnNfdG9fY29ycmVsYXRlKQogICAgICAgIHlpZWxkIGZyb20gc2VsZi5fY29ycmVsYXRlX2ZyaWVuZGx5X2FkX25hbWUoYWRhcHRlcnNfdG9fY29ycmVsYXRlKQogICAgICAgICMgRGlzYWJsZSByb3V0ZTUzIGNvcnJlbGF0aW9uLCBiZWNhdXNlIHRoaXMgdXN1YWxseSBjb3JyZWxhdGVzIG1hbnkgaW5zdGFuY2VzIG9mIHRoZSBzYW1lIEVMQgogICAgICAgICMgYW5kIHdlIGRvbid0IHdhbnQgdGhlc2Uga2luZCBvZiBjb3JyZWxhdGlvbnMgLSB0aGV5IGFyZSBub3QgdGhlIHNhbWUgaG9zdC4KICAgICAgICAjCiAgICAgICAgIyB5aWVsZCBmcm9tIHNlbGYuX2NvcnJlbGF0ZV9hd3Nfcm91dGU1M19kbnNfbmFtZXMoYWRhcHRlcnNfdG9fY29ycmVsYXRlKQoKICAgICAgICAjIEZpbmQgYWRhcHRlcnMgd2l0aCB0aGUgc2FtZSBzZXJpYWwKICAgICAgICAjIE5vdyBsZXQncyBmaW5kIGRldmljZXMgYnkgTUFDLCBhbmQgSVBzIGRvbid0IGNvbnRyYWRpY3QgKHdlIGFsbG93IGVtcHR5KQogICAgICAgIHlpZWxkIGZyb20gc2VsZi5fY29ycmVsYXRlX21hYyhhZGFwdGVyc190b19jb3JyZWxhdGUsIGNvcnJlbGF0ZV9ieV9zbm93X21hYykKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgX3Bvc3RfcHJvY2VzcyhmaXJzdF9uYW1lLCBmaXJzdF9pZCwgc2Vjb25kX25hbWUsIHNlY29uZF9pZCwgZGF0YSwgcmVhc29uKSAtPiBib29sOgogICAgICAgIGlmIHJlYXNvbiA9PSBDb3JyZWxhdGlvblJlYXNvbi5TdGF0aWNBbmFseXNpczoKICAgICAgICAgICAgaWYgc2Vjb25kX25hbWUgPT0gZmlyc3RfbmFtZToKICAgICAgICAgICAgICAgICMgdGhpcyBtZWFucyB0aGF0IHNvbWUgbG9naWMgaW4gdGhlIGNvcnJlbGF0b3IgbG9naWMgaXMgd3JvbmcsIGJlY2F1c2UKICAgICAgICAgICAgICAgICMgc3VjaCBjb3JyZWxhdGlvbnMgc2hvdWxkIGhhdmUgcmVhc29uID09ICJMb2dpYyIKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigKICAgICAgICAgICAgICAgICAgICBmJ3tmaXJzdF9uYW1lfSBjb3JyZWxhdGVkIHRvIGl0c2VsZiwgaWQ6IFwne2ZpcnN0X2lkfVwnIGFuZCBcJ3tzZWNvbmRfaWR9XCcgdmlhIHN0YXRpYyBhbmFseXNpcycpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBfYmlnZ2VyX3BpY3R1cmVfZGVjaXNpb24oZmlyc3RfYXhvbml1c19kZXZpY2UsIHNlY29uZF9heG9uaXVzX2RldmljZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RfYWRhcHRlcl9kZXZpY2UsIHNlY29uZF9hZGFwdGVyX2RldmljZSkgLT4gYm9vbDoKICAgICAgICAjIERvbid0IGNvcnJlbGF0ZSBkZXZpY2VzIHRoYXQgaGF2ZSBBRCBpbiB0aGVtIGJ1dCBhcmUgbm90IGNvcnJlbGF0ZWQgYWNjb3JkaW5nIHRvIEFECiAgICAgICAgIyBBWC0yMTA3CiAgICAgICAgYWRfaW5fZmlyc3QgPSBhbnkoeFtQTFVHSU5fTkFNRV0gPT0gQUNUSVZFX0RJUkVDVE9SWV9QTFVHSU5fTkFNRSBmb3IgeCBpbiBmaXJzdF9heG9uaXVzX2RldmljZVsnYWRhcHRlcnMnXSkKICAgICAgICBhZF9pbl9zZWNvbmQgPSBhbnkoeFtQTFVHSU5fTkFNRV0gPT0gQUNUSVZFX0RJUkVDVE9SWV9QTFVHSU5fTkFNRSBmb3IgeCBpbiBzZWNvbmRfYXhvbml1c19kZXZpY2VbJ2FkYXB0ZXJzJ10pCiAgICAgICAgaWYgYWRfaW5fZmlyc3QgYW5kIGFkX2luX3NlY29uZDoKICAgICAgICAgICAgaWYgZmlyc3RfYWRhcHRlcl9kZXZpY2VbUExVR0lOX05BTUVdICE9IEFDVElWRV9ESVJFQ1RPUllfUExVR0lOX05BTUUgb3IgXAogICAgICAgICAgICAgICAgICAgIHNlY29uZF9hZGFwdGVyX2RldmljZVtQTFVHSU5fTkFNRV0gIT0gQUNUSVZFX0RJUkVDVE9SWV9QTFVHSU5fTkFNRToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICByZXR1cm4gVHJ1ZQo=',
}


def main():
    print(f'Updating epo_adapter, sccm_adapter and static_correlator to e3b07d996d5a612417137f405b6f9f8650b5c310')

    # assert current client
    node_id = core_service.CoreService().node_id
    print(f'Current client: {node_id}')

    # 1. Backup original
    try:
        for path_to_update in FILES_TO_UPDATE.keys():
            bak_path = f'{path_to_update}.bak'
            if os.path.exists(bak_path):
                os.unlink(bak_path)

        for path_to_update in FILES_TO_UPDATE.keys():
            os.rename(path_to_update, f'{path_to_update}.bak')
    except Exception:
        pass

    # 2. write new files
    for path_to_update, b64_contents in FILES_TO_UPDATE.items():
        with open(path_to_update, 'wb') as f:
            f.write(base64.b64decode(b64_contents))

    # 3. Restart adapter
    subprocess.check_call('./se.sh re epo',
                          shell=True, cwd=CORTEX)
    subprocess.check_call('./se.sh re sccm',
                          shell=True, cwd=CORTEX)
    subprocess.check_call('./se.sh re static_correlator',
                          shell=True, cwd=CORTEX)
    subprocess.check_call('./se.sh sc &',
                          shell=True, cwd=CORTEX)

    print(f'Done!')
    return 0


if __name__ == '__main__':
    sys.exit(main())
