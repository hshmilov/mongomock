#!/home/ubuntu/cortex/venv/bin/python

import sys
import subprocess
import base64
import os
import time

from testing.services.plugins import core_service

CORTEX = '/home/ubuntu/cortex'
FILES_TO_UPDATE = {
    f'{CORTEX}/adapters/service_now_adapter/service.py': b'aW1wb3J0IGRhdGV0aW1lCmltcG9ydCBsb2dnaW5nCgpmcm9tIGF4b25pdXMuYWRhcHRlcl9iYXNlIGltcG9ydCBBZGFwdGVyQmFzZSwgQWRhcHRlclByb3BlcnR5CmZyb20gYXhvbml1cy51dGlscy5kYXRldGltZSBpbXBvcnQgcGFyc2VfZGF0ZQpmcm9tIGF4b25pdXMuYWRhcHRlcl9leGNlcHRpb25zIGltcG9ydCBDbGllbnRDb25uZWN0aW9uRXhjZXB0aW9uCmZyb20gYXhvbml1cy5jbGllbnRzLnJlc3QuY29ubmVjdGlvbiBpbXBvcnQgUkVTVENvbm5lY3Rpb24KZnJvbSBheG9uaXVzLmNsaWVudHMucmVzdC5leGNlcHRpb24gaW1wb3J0IFJFU1RFeGNlcHRpb24KZnJvbSBheG9uaXVzLmNsaWVudHMuc2VydmljZV9ub3cuY29ubmVjdGlvbiBpbXBvcnQgU2VydmljZU5vd0Nvbm5lY3Rpb24KZnJvbSBheG9uaXVzLmNsaWVudHMuc2VydmljZV9ub3cuY29uc3RzIGltcG9ydCAqCmZyb20gYXhvbml1cy5kZXZpY2VzLmRldmljZV9hZGFwdGVyIGltcG9ydCBEZXZpY2VBZGFwdGVyCmZyb20gYXhvbml1cy5maWVsZHMgaW1wb3J0IEZpZWxkCmZyb20gYXhvbml1cy50eXBlcy5jb3JyZWxhdGlvbiBpbXBvcnQgQ29ycmVsYXRpb25SZXN1bHQsIENvcnJlbGF0aW9uUmVhc29uCmZyb20gYXhvbml1cy5wbHVnaW5fYmFzZSBpbXBvcnQgYWRkX3J1bGUsIHJldHVybl9lcnJvciwgRW50aXR5VHlwZQpmcm9tIGF4b25pdXMudXNlcnMudXNlcl9hZGFwdGVyIGltcG9ydCBVc2VyQWRhcHRlcgpmcm9tIGF4b25pdXMudXRpbHMuZmlsZXMgaW1wb3J0IGdldF9sb2NhbF9jb25maWdfZmlsZQpmcm9tIGF4b25pdXMubWl4aW5zLmNvbmZpZ3VyYWJsZSBpbXBvcnQgQ29uZmlndXJhYmxlCmxvZ2dlciA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKGYnYXhvbml1cy57X19uYW1lX199JykKCgpjbGFzcyBTZXJ2aWNlTm93QWRhcHRlcihBZGFwdGVyQmFzZSwgQ29uZmlndXJhYmxlKToKICAgIGNsYXNzIE15VXNlckFkYXB0ZXIoVXNlckFkYXB0ZXIpOgogICAgICAgIHNub3dfc291cmNlID0gRmllbGQoc3RyLCAnU2VydmljZU5vdyBTb3VyY2UnKQogICAgICAgIHNub3dfcm9sZXMgPSBGaWVsZChzdHIsICdSb2xlcycpCiAgICAgICAgdXBkYXRlZF9vbiA9IEZpZWxkKGRhdGV0aW1lLmRhdGV0aW1lLCAnVXBkYXRlZCBPbicpCiAgICAgICAgYWN0aXZlID0gRmllbGQoc3RyLCAnQWN0aXZlJykKCiAgICBjbGFzcyBNeURldmljZUFkYXB0ZXIoRGV2aWNlQWRhcHRlcik6CiAgICAgICAgdGFibGVfdHlwZSA9IEZpZWxkKHN0ciwgJ1RhYmxlIFR5cGUnKQogICAgICAgIGNhdGVnb3J5ID0gRmllbGQoc3RyLCAnQ2F0ZWdvcnknKQogICAgICAgIGNsYXNzX25hbWUgPSBGaWVsZChzdHIsICdDbGFzcyBOYW1lJykKICAgICAgICBvd25lciA9IEZpZWxkKHN0ciwgJ093bmVyJykKICAgICAgICBkaXNjb3Zlcnlfc291cmNlID0gRmllbGQoc3RyLCAnRGlzY292ZXJ5IFNvdXJjZScpCiAgICAgICAgbGFzdF9kaXNjb3ZlcmVkID0gRmllbGQoZGF0ZXRpbWUuZGF0ZXRpbWUsICdMYXN0IERpc2NvdmVyZWQnKQogICAgICAgIGZpcnN0X2Rpc2NvdmVyZWQgPSBGaWVsZChkYXRldGltZS5kYXRldGltZSwgJ0ZpcnN0IERpc2NvdmVyZWQnKQogICAgICAgIHNub3dfbG9jYXRpb24gPSBGaWVsZChzdHIsICdMb2NhdGlvbicpCiAgICAgICAgc25vd19kZXBhcnRtZW50ID0gRmllbGQoc3RyLCAnRGVwYXJ0bWVudCcpCiAgICAgICAgYXNzaWduZWRfdG8gPSBGaWVsZChzdHIsICdBc3NpZ25lZCBUbycpCiAgICAgICAgaW5zdGFsbF9zdGF0dXMgPSBGaWVsZChzdHIsICdJbnN0YWxsIFN0YXR1cycpCiAgICAgICAgYXNzaWduZWRfdG9fbG9jYXRpb24gPSBGaWVsZChzdHIsICdBc3NpZ25lZCBUbyBMb2NhdGlvbicpCiAgICAgICAgYXNzaWduZWRfdG9fY291bnRyeSA9IEZpZWxkKHN0ciwgJ0Fzc2lnbmVkIFRvIENvdW50cnknKQogICAgICAgIGFzc2lnbmVkX3RvX2RpdmlzaW9uID0gRmllbGQoc3RyLCAnQXNzaWduZWQgVG8gQnVzaW5lc3MnKQogICAgICAgIGFzc2lnbmVkX3RvX2J1c2luZXNzX3VuaXQgPSBGaWVsZChzdHIsICdBc3NpZ25lZCBUbyBCdXNpbmVzcyBVbml0JykKICAgICAgICBtYW5hZ2VyX2VtYWlsID0gRmllbGQoc3RyLCAnTWFuYWdlciBFbWFpbCcpCiAgICAgICAgcHVyY2hhc2VfZGF0ZSA9IEZpZWxkKGRhdGV0aW1lLmRhdGV0aW1lLCAnUHVyY2hhc2UgZGF0ZScpCiAgICAgICAgc3Vic3RhdHVzID0gRmllbGQoc3RyLCAnU3Vic3RhdHVzJykKICAgICAgICB1X3NoYXJlZCA9IEZpZWxkKHN0ciwgJ1NoYXJlZCcpCiAgICAgICAgdV9sb2FuZXIgPSBGaWVsZChzdHIsICdMb2FuZXInKQogICAgICAgIHVfY2xvdWRfcHJlbWlzZXMgPSBGaWVsZChzdHIsICdDbG91ZCBQcmVtaXNlcycpCiAgICAgICAgdV9iaWFfY29uZmlkZW50aWFsbGl0eSA9IEZpZWxkKHN0ciwgJ0JJQSBDb25maWRlbnRpYWxsaXR5JykKICAgICAgICB1X2JpYV9hdmFpbGFiaWxpdHkgPSBGaWVsZChzdHIsICdCSUEgQXZhaWxhYmlsaXR5JykKICAgICAgICB1X2JpYV9pZCA9IEZpZWxkKHN0ciwgJ0JJQSBJRCcpCiAgICAgICAgdV9iaWFfaW50ZWdyaXR5ID0gRmllbGQoc3RyLCAnQklBIEludGVncml0eScpCiAgICAgICAgdV9iaWFfb3ZlcmFsbCA9IEZpZWxkKHN0ciwgJ0JJQSBPdmVyYWxsJykKICAgICAgICB1X2Nhc3Blcl9zdGF0dXMgPSBGaWVsZChzdHIsICdDYXNwZXIgU3RhdHVzJykKICAgICAgICB1X2FsdGlyaXNfc3RhdHVzID0gRmllbGQoc3RyLCAnQWx0aXJpcyBTdGF0dXMnKQogICAgICAgIGZpcnN0X2RlcGxveWVkID0gRmllbGQoZGF0ZXRpbWUuZGF0ZXRpbWUsICdGaXJzdCBEZXBsb3llZCcpCiAgICAgICAgY3JlYXRlZF9hdCA9IEZpZWxkKGRhdGV0aW1lLmRhdGV0aW1lLCAnQ3JlYXRlZCBBdCcpCiAgICAgICAgY3JlYXRlZF9ieSA9IEZpZWxkKHN0ciwgJ0NyZWF0ZWQgQnknKQogICAgICAgIHN5c191cGRhdGVkX29uID0gRmllbGQoc3RyLCAnVXBkYXRlZCBPbicpCiAgICAgICAgdXNlZF9mb3IgPSBGaWVsZChzdHIsICdVc2VkIEZvcicpCiAgICAgICAgdGVuYWJsZV9hc3NldF9ncm91cCA9IEZpZWxkKHN0ciwgJ1RlbmFibGUgQXNzZXQgR3JvdXAnKQogICAgICAgIGVudmlyb25tZW50ID0gRmllbGQoc3RyLCAnRW52aXJvbm1lbnQnKQogICAgICAgIGNtZGJfYnVzaW5lc3NfZnVuY3Rpb24gPSBGaWVsZChzdHIsICdCdXNpbmVzcyBGdW5jdGlvbicpCiAgICAgICAgbWFuYWdlbWVudF9pcCA9IEZpZWxkKHN0ciwgJ01hbmFnZW1lbnQgSVAnKQogICAgICAgIGVuZF9vZl9zdXBwb3J0ID0gRmllbGQoc3RyLCAnRW5kIE9mIFN1cHBvcnQnKQogICAgICAgIGZpcm13YXJlX3ZlcnNpb24gPSBGaWVsZChzdHIsICdGaXJtd2FyZSBWZXJzaW9uJykKICAgICAgICBtb2RlbF92ZXJzaW9uX251bWJlciA9IEZpZWxkKHN0ciwgJ01vZGVsIFZlcnNpb24gTnVtYmVyJykKICAgICAgICBvcGVyYXRpb25hbF9zdGF0dXMgPSBGaWVsZChzdHIsICdPcGVyYXRpb25hbCBTdGF0dXMnKQogICAgICAgIGhhcmR3YXJlX3N0YXR1cyA9IEZpZWxkKHN0ciwgJ0hhcmR3YXJlIFN0YXR1cycpCiAgICAgICAgdmVuZG9yID0gRmllbGQoc3RyLCAnVmVuZG9yJykKICAgICAgICB1X251bWJlciA9IEZpZWxkKHN0ciwgJ1UgTnVtYmVyJykKICAgICAgICBzdXBwb3J0X2dyb3VwID0gRmllbGQoc3RyLCAnU3VwcG9ydCBHcm91cCcpCgogICAgZGVmIF9faW5pdF9fKHNlbGYsICphcmdzLCAqKmt3YXJncyk6CiAgICAgICAgc3VwZXIoKS5fX2luaXRfXyhjb25maWdfZmlsZV9wYXRoPWdldF9sb2NhbF9jb25maWdfZmlsZShfX2ZpbGVfXyksICphcmdzLCAqKmt3YXJncykKCiAgICAjIHB5bGludDogZGlzYWJsZT1SMDkxMixSMDkxNSxSMDkxNAogICAgZGVmIGNyZWF0ZV9zbm93X2RldmljZShzZWxmLAogICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VfcmF3LAogICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZV90eXBlPSdjbWRiX2NpX2NvbXB1dGVyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgc25vd19sb2NhdGlvbl90YWJsZV9kaWN0PU5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoX2lwcz1UcnVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICBzbm93X2RlcGFydG1lbnRfdGFibGVfZGljdD1Ob25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICB1c2Vyc190YWJsZV9kaWN0PU5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHNub3dfbmljc190YWJsZV9kaWN0PU5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJzX3VzZXJuYW1lX2RpY3Q9Tm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgc25vd19hbG1fYXNzZXRfdGFibGVfZGljdD1Ob25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICBzbm93X3VzZXJfZ3JvdXBzX3RhYmxlX2RpY3Q9Tm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGFuaWVzX3RhYmxlX2RpY3Q9Tm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgaXBzX3RhYmxlX2RpY3Q9Tm9uZSk6CiAgICAgICAgZ290X25pYyA9IEZhbHNlCiAgICAgICAgZ290X3NlcmlhbCA9IEZhbHNlCiAgICAgICAgaWYgdXNlcnNfdXNlcm5hbWVfZGljdCBpcyBOb25lOgogICAgICAgICAgICB1c2Vyc191c2VybmFtZV9kaWN0ID0gZGljdCgpCiAgICAgICAgaWYgc25vd191c2VyX2dyb3Vwc190YWJsZV9kaWN0IGlzIE5vbmU6CiAgICAgICAgICAgIHNub3dfdXNlcl9ncm91cHNfdGFibGVfZGljdCA9IGRpY3QoKQogICAgICAgIGlmIGNvbXBhbmllc190YWJsZV9kaWN0IGlzIE5vbmU6CiAgICAgICAgICAgIGNvbXBhbmllc190YWJsZV9kaWN0ID0gZGljdCgpCiAgICAgICAgaWYgc25vd19sb2NhdGlvbl90YWJsZV9kaWN0IGlzIE5vbmU6CiAgICAgICAgICAgIHNub3dfbG9jYXRpb25fdGFibGVfZGljdCA9IGRpY3QoKQogICAgICAgIGlmIHNub3dfbmljc190YWJsZV9kaWN0IGlzIE5vbmU6CiAgICAgICAgICAgIHNub3dfbmljc190YWJsZV9kaWN0ID0gZGljdCgpCiAgICAgICAgaWYgaXBzX3RhYmxlX2RpY3QgaXMgTm9uZToKICAgICAgICAgICAgaXBzX3RhYmxlX2RpY3QgPSBkaWN0KCkKICAgICAgICBpZiBzbm93X2FsbV9hc3NldF90YWJsZV9kaWN0IGlzIE5vbmU6CiAgICAgICAgICAgIHNub3dfYWxtX2Fzc2V0X3RhYmxlX2RpY3QgPSBkaWN0KCkKICAgICAgICBpZiB1c2Vyc190YWJsZV9kaWN0IGlzIE5vbmU6CiAgICAgICAgICAgIHVzZXJzX3RhYmxlX2RpY3QgPSBkaWN0KCkKICAgICAgICBpZiBzbm93X2RlcGFydG1lbnRfdGFibGVfZGljdCBpcyBOb25lOgogICAgICAgICAgICBzbm93X2RlcGFydG1lbnRfdGFibGVfZGljdCA9IGRpY3QoKQogICAgICAgIHRyeToKICAgICAgICAgICAgZGV2aWNlID0gc2VsZi5fbmV3X2RldmljZV9hZGFwdGVyKCkKICAgICAgICAgICAgZGV2aWNlX2lkID0gZGV2aWNlX3Jhdy5nZXQoJ3N5c19pZCcpCiAgICAgICAgICAgIGlmIG5vdCBkZXZpY2VfaWQ6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gZ2V0dGluZyBpZCBhdCB7ZGV2aWNlX3Jhd30nKQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgZGV2aWNlLmlkID0gc3RyKGRldmljZV9pZCkKICAgICAgICAgICAgZGV2aWNlLnRhYmxlX3R5cGUgPSB0YWJsZV90eXBlCiAgICAgICAgICAgIGRldmljZS5jYXRlZ29yeSA9IGRldmljZV9yYXcuZ2V0KCdjYXRlZ29yeScpCiAgICAgICAgICAgIG5hbWUgPSBkZXZpY2VfcmF3LmdldCgnbmFtZScpCiAgICAgICAgICAgIGRldmljZS5uYW1lID0gbmFtZQogICAgICAgICAgICBjbGFzc19uYW1lID0gZGV2aWNlX3Jhdy5nZXQoJ3N5c19jbGFzc19uYW1lJykKICAgICAgICAgICAgZGV2aWNlLnVfY2xvdWRfcHJlbWlzZXMgPSBkZXZpY2VfcmF3LmdldCgndV9jbG91ZF9wcmVtaXNlcycpCiAgICAgICAgICAgIGRldmljZS51X2JpYV9jb25maWRlbnRpYWxsaXR5ID0gZGV2aWNlX3Jhdy5nZXQoJ3VfYmlhX2NvbmZpZGVudGlhbGxpdHknKQogICAgICAgICAgICBkZXZpY2UudV9iaWFfYXZhaWxhYmlsaXR5ID0gZGV2aWNlX3Jhdy5nZXQoJ3VfYmlhX2F2YWlsYWJpbGl0eScpCiAgICAgICAgICAgIGRldmljZS51X2JpYV9pZCA9IGRldmljZV9yYXcuZ2V0KCd1X2JpYV9pZCcpCiAgICAgICAgICAgIGRldmljZS51X2JpYV9pbnRlZ3JpdHkgPSBkZXZpY2VfcmF3LmdldCgndV9iaWFfaW50ZWdyaXR5JykKICAgICAgICAgICAgZGV2aWNlLnVfYmlhX292ZXJhbGwgPSBkZXZpY2VfcmF3LmdldCgndV9iaWFfb3ZlcmFsbCcpCiAgICAgICAgICAgIGlmIHNlbGYuX19leGNsdWRlX3ZtX3RhYmxlcyBpcyBUcnVlIGFuZCBjbGFzc19uYW1lIGFuZCAnY21kYl9jaV92bScgaW4gY2xhc3NfbmFtZToKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIGRldmljZS5jbGFzc19uYW1lID0gY2xhc3NfbmFtZQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpcF9hZGRyZXNzZXMgPSBkZXZpY2VfcmF3LmdldCgnaXBfYWRkcmVzcycpCiAgICAgICAgICAgICAgICBpZiBmZXRjaF9pcHMgYW5kIGlwX2FkZHJlc3NlcyBhbmQgbm90IGFueShlbGVtIGluIGlwX2FkZHJlc3NlcyBmb3IgZWxlbSBpbiBbJ0RIQ1AnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcqJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU3RhY2snLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd4JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnWCddKToKICAgICAgICAgICAgICAgICAgICBpcF9hZGRyZXNzZXMgPSBpcF9hZGRyZXNzZXMuc3BsaXQoJy8nKQogICAgICAgICAgICAgICAgICAgIGlwX2FkZHJlc3NlcyA9IFtpcC5zdHJpcCgpIGZvciBpcCBpbiBpcF9hZGRyZXNzZXNdCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGlwX2FkZHJlc3NlcyA9IE5vbmUKICAgICAgICAgICAgICAgIG1hY19hZGRyZXNzID0gZGV2aWNlX3Jhdy5nZXQoJ21hY19hZGRyZXNzJykKICAgICAgICAgICAgICAgIGlmIG1hY19hZGRyZXNzIG9yIGlwX2FkZHJlc3NlczoKICAgICAgICAgICAgICAgICAgICBnb3RfbmljID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgIGRldmljZS5hZGRfbmljKG1hY19hZGRyZXNzLCBpcF9hZGRyZXNzZXMpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gZ2V0dGluZyBOSUMgYXQge2RldmljZV9yYXd9JywgZXhjX2luZm89VHJ1ZSkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc25vd19zdXBwb3J0X2dyb3VwX3ZhbHVlID0gc25vd191c2VyX2dyb3Vwc190YWJsZV9kaWN0LmdldCgKICAgICAgICAgICAgICAgICAgICAoZGV2aWNlX3Jhdy5nZXQoJ3N1cHBvcnRfZ3JvdXAnKSBvciB7fSkuZ2V0KCd2YWx1ZScpKQogICAgICAgICAgICAgICAgaWYgc25vd19zdXBwb3J0X2dyb3VwX3ZhbHVlOgogICAgICAgICAgICAgICAgICAgIGRldmljZS5zdXBwb3J0X2dyb3VwID0gc25vd19zdXBwb3J0X2dyb3VwX3ZhbHVlLmdldCgnbmFtZScpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gYWRkaW5nIHN1cHBvcnQgZ3JvdXAgdG8ge2RldmljZV9yYXd9JywgZXhjX2luZm89VHJ1ZSkKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG1hY191ID0gZGV2aWNlX3Jhdy5nZXQoJ3VfbWFjX2FkZHJlc3MnKQogICAgICAgICAgICAgICAgaWYgbWFjX3U6CiAgICAgICAgICAgICAgICAgICAgZGV2aWNlLmFkZF9uaWMobWFjPW1hY191KQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihmJ1Byb2JsZW0gZ2V0dGluZyBtYWMgMiBmb3Ige2RldmljZV9yYXd9JykKICAgICAgICAgICAgZGV2aWNlLmZpZ3VyZV9vcygKICAgICAgICAgICAgICAgIChkZXZpY2VfcmF3LmdldCgnb3MnKSBvciAnJykgKyAnICcgKyAoZGV2aWNlX3Jhdy5nZXQoJ29zX2FkZHJlc3Nfd2lkdGgnKSBvciAnJykgKyAnICcgKwogICAgICAgICAgICAgICAgKGRldmljZV9yYXcuZ2V0KCdvc19kb21haW4nKSBvciAnJykgKwogICAgICAgICAgICAgICAgJyAnICsgKGRldmljZV9yYXcuZ2V0KCdvc19zZXJ2aWNlX3BhY2snKSBvciAnJykgKyAnICcgKyAoZGV2aWNlX3Jhdy5nZXQoJ29zX3ZlcnNpb24nKSBvciAnJykpCiAgICAgICAgICAgIGRldmljZV9tb2RlbCA9IE5vbmUKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbW9kZWxfbnVtYmVyID0gZGV2aWNlX3Jhdy5nZXQoJ21vZGVsX251bWJlcicpCiAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKG1vZGVsX251bWJlciwgZGljdCk6CiAgICAgICAgICAgICAgICAgICAgZGV2aWNlX21vZGVsID0gbW9kZWxfbnVtYmVyLmdldCgndmFsdWUnKQogICAgICAgICAgICAgICAgICAgIGRldmljZS5kZXZpY2VfbW9kZWwgPSBkZXZpY2VfbW9kZWwKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYnUHJvYmxlbSBnZXR0aW5nIG1vZGVsIGF0IHtkZXZpY2VfcmF3fScsIGV4Y19pbmZvPVRydWUpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRldmljZV9zZXJpYWwgPSBkZXZpY2VfcmF3LmdldCgnc2VyaWFsX251bWJlcicpCiAgICAgICAgICAgICAgICBpZiAoZGV2aWNlX3NlcmlhbCBvciAnJykuc3RhcnRzd2l0aCgnVk13YXJlJyk6CiAgICAgICAgICAgICAgICAgICAgZGV2aWNlX3NlcmlhbCArPSBkZXZpY2VfbW9kZWwgb3IgJycKICAgICAgICAgICAgICAgIGlmIG5vdCBhbnkoYmFkX3NlcmlhbCBpbiBkZXZpY2Vfc2VyaWFsIGZvciBiYWRfc2VyaWFsIGluCiAgICAgICAgICAgICAgICAgICAgICAgICAgIFsnUGVuZGluZyBEaXNjb3ZlcnknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1ZpcnR1YWwgTWFjaGluZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnVk13YXJlIFZpcnR1YWwgUGxhdGZvcm0nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0FUJlQnLCAndW5rbm93bicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnSW5zdGFuY2UnXSk6CiAgICAgICAgICAgICAgICAgICAgaWYgZGV2aWNlX3NlcmlhbDoKICAgICAgICAgICAgICAgICAgICAgICAgZ290X3NlcmlhbCA9IFRydWUKICAgICAgICAgICAgICAgICAgICBkZXZpY2UuZGV2aWNlX3NlcmlhbCA9IGRldmljZV9zZXJpYWwKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYnUHJvYmxlbSBnZXR0aW5nIHNlcmlhbCBhdCB7ZGV2aWNlX3Jhd30nLCBleGNfaW5mbz1UcnVlKQogICAgICAgICAgICAjIHB5bGludDogZGlzYWJsZT1SMTcxNAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByYW1fbWIgPSBkZXZpY2VfcmF3LmdldCgncmFtJywgJycpCiAgICAgICAgICAgICAgICBpZiByYW1fbWIgIT0gJycgYW5kIHJhbV9tYiAhPSAnLTEnIGFuZCByYW1fbWIgIT0gLTE6CiAgICAgICAgICAgICAgICAgICAgZGV2aWNlLnRvdGFsX3BoeXNpY2FsX21lbW9yeSA9IGludChyYW1fbWIpIC8gMTAyNC4wCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gZ2V0dGluZyByYW0gYXQge2RldmljZV9yYXd9JywgZXhjX2luZm89VHJ1ZSkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaG9zdF9uYW1lID0gZGV2aWNlX3Jhdy5nZXQoJ2hvc3RfbmFtZScpIG9yIGRldmljZV9yYXcuZ2V0KCdmcWRuJykgb3IgZGV2aWNlX3Jhdy5nZXQoJ3VfZnFkbicpCiAgICAgICAgICAgICAgICBpZiBob3N0X25hbWUgYW5kIG5hbWUgYW5kIG5hbWUubG93ZXIoKSBpbiBob3N0X25hbWUubG93ZXIoKToKICAgICAgICAgICAgICAgICAgICBkZXZpY2UuaG9zdG5hbWUgPSBob3N0X25hbWUKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYnUHJvYmxlbSBnZXR0aW5nIGhvc3RuYW1lIGluIHtkZXZpY2VfcmF3fScsIGV4Y19pbmZvPVRydWUpCiAgICAgICAgICAgIGRldmljZS5kZXNjcmlwdGlvbiA9IGRldmljZV9yYXcuZ2V0KCdzaG9ydF9kZXNjcmlwdGlvbicpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNub3dfZGVwYXJ0bWVudCA9IHNub3dfZGVwYXJ0bWVudF90YWJsZV9kaWN0LmdldCgKICAgICAgICAgICAgICAgICAgICAoZGV2aWNlX3Jhdy5nZXQoJ2RlcGFydG1lbnQnKSBvciB7fSkuZ2V0KCd2YWx1ZScpKQogICAgICAgICAgICAgICAgaWYgc25vd19kZXBhcnRtZW50OgogICAgICAgICAgICAgICAgICAgIGRldmljZS5zbm93X2RlcGFydG1lbnQgPSBzbm93X2RlcGFydG1lbnQuZ2V0KCduYW1lJykKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYnUHJvYmxlbSBhZGRpbmcgYXNzaWduZWRfdG8gdG8ge2RldmljZV9yYXd9JywgZXhjX2luZm89VHJ1ZSkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc25vd19hc3NldCA9IHNub3dfYWxtX2Fzc2V0X3RhYmxlX2RpY3QuZ2V0KChkZXZpY2VfcmF3LmdldCgnYXNzZXQnKSBvciB7fSkuZ2V0KCd2YWx1ZScpKQogICAgICAgICAgICAgICAgaW5zdGFsbF9zdGF0dXMgPSBOb25lCiAgICAgICAgICAgICAgICBpZiBzbm93X2Fzc2V0OgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFsbF9zdGF0dXMgPSBJTlNUQUxMX1NUQVRVU19ESUNULmdldChzbm93X2Fzc2V0LmdldCgnaW5zdGFsbF9zdGF0dXMnKSkKICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gZ2V0dGluZyBpbnN0YWxsIHN0YXR1cyBmb3Ige2RldmljZV9yYXd9JywgZXhjX2luZm89VHJ1ZSkKICAgICAgICAgICAgICAgICAgICBkZXZpY2UudV9sb2FuZXIgPSBzbm93X2Fzc2V0LmdldCgndV9sb2FuZXInKQogICAgICAgICAgICAgICAgICAgIGRldmljZS51X3NoYXJlZCA9IHNub3dfYXNzZXQuZ2V0KCd1X3NoYXJlZCcpCiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2UuZmlyc3RfZGVwbG95ZWQgPSBwYXJzZV9kYXRlKHNub3dfYXNzZXQuZ2V0KCd1X2ZpcnN0X2RlcGxveWVkJykpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZidQcm9ibGVtIGdldHRpbmcgZmlyc3QgZGVwbG95ZWQgYXQge2RldmljZV9yYXd9JywgZXhjX2luZm89VHJ1ZSkKICAgICAgICAgICAgICAgICAgICBkZXZpY2UudV9hbHRpcmlzX3N0YXR1cyA9IHNub3dfYXNzZXQuZ2V0KCd1X2FsdGlyaXNfc3RhdHVzJykKICAgICAgICAgICAgICAgICAgICBkZXZpY2UudV9jYXNwZXJfc3RhdHVzID0gc25vd19hc3NldC5nZXQoJ3VfY2FzcGVyX3N0YXR1cycpCiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2Uuc3Vic3RhdHVzID0gc25vd19hc3NldC5nZXQoJ3N1YnN0YXR1cycpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZidQcm9ibGVtIGFkZGluZyBoYXJkd2FyZSBzdGF0dXMgdG8ge2RldmljZV9yYXd9JywgZXhjX2luZm89VHJ1ZSkKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5wdXJjaGFzZV9kYXRlID0gcGFyc2VfZGF0ZShzbm93X2Fzc2V0LmdldCgncHVyY2hhc2VfZGF0ZScpKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYnUHJvYmxlbSBhZGRpbmcgcHVyY2hhc2UgZGF0ZSB0byB7ZGV2aWNlX3Jhd30nLCBleGNfaW5mbz1UcnVlKQogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgc25vd19sb2NhdGlvbiA9IHNub3dfbG9jYXRpb25fdGFibGVfZGljdC5nZXQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc25vd19hc3NldC5nZXQoJ2xvY2F0aW9uJykgb3Ige30pLmdldCgndmFsdWUnKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgc25vd19sb2NhdGlvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5zbm93X2xvY2F0aW9uID0gc25vd19sb2NhdGlvbi5nZXQoJ25hbWUnKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYnUHJvYmxlbSBhZGRpbmcgYXNzaWduZWRfdG8gdG8ge2RldmljZV9yYXd9JywgZXhjX2luZm89VHJ1ZSkKCiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBzbm93X25pY3MgPSBzbm93X25pY3NfdGFibGVfZGljdC5nZXQoZGV2aWNlX3Jhdy5nZXQoJ3N5c19pZCcpKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHNub3dfbmljcywgbGlzdCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3Igc25vd19uaWMgaW4gc25vd19uaWNzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlLmFkZF9uaWMobWFjPXNub3dfbmljLmdldCgnbWFjX2FkZHJlc3MnKSwgaXBzPVtzbm93X25pYy5nZXQoJ2lwX2FkZHJlc3MnKV0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihmJ1Byb2JsZW0gd2l0aCBzbm93IG5pYyB7c25vd19uaWN9JykKICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gYWRkaW5nIGFzc2lnbmVkX3RvIHRvIHtkZXZpY2VfcmF3fScsIGV4Y19pbmZvPVRydWUpCiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBzbm93X2lwcyA9IGlwc190YWJsZV9kaWN0LmdldChkZXZpY2VfcmF3LmdldCgnc3lzX2lkJykpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc25vd19pcHMsIGxpc3QpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHNub3dfaXAgaW4gc25vd19pcHM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2UuYWRkX25pYyhpcHM9W3Nub3dfaXAuZ2V0KCd1X2FkZHJlc3MnKV0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihmJ1Byb2JsZW0gd2l0aCBzbm93IGlwcyB7c25vd19pcHN9JykKICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gYWRkaW5nIGFzc2lnbmVkX3RvIHRvIHtkZXZpY2VfcmF3fScsIGV4Y19pbmZvPVRydWUpCiAgICAgICAgICAgICAgICBpZiBub3QgaW5zdGFsbF9zdGF0dXMgb3Igc2VsZi5fX3VzZV9jaV90YWJsZV9mb3JfaW5zdGFsbF9zdGF0dXM6CiAgICAgICAgICAgICAgICAgICAgaW5zdGFsbF9zdGF0dXMgPSBJTlNUQUxMX1NUQVRVU19ESUNULmdldChkZXZpY2VfcmF3LmdldCgnaW5zdGFsbF9zdGF0dXMnKSkKICAgICAgICAgICAgICAgIGlmIHNlbGYuX19leGNsdWRlX2Rpc3Bvc2VkX2RldmljZXMgYW5kIGluc3RhbGxfc3RhdHVzIFwKICAgICAgICAgICAgICAgICAgICAgICAgYW5kIGluc3RhbGxfc3RhdHVzIGluIFsnRGlzcG9zZWQnLCAnRGVjb21taXNzaW9uZWQnXToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAgICAgZGV2aWNlLmluc3RhbGxfc3RhdHVzID0gaW5zdGFsbF9zdGF0dXMKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLl9faW5zdGFsbF9zdGF0dXNfZXhjbHVkZV9saXN0IGFuZCBkZXZpY2VfcmF3LmdldCgnaW5zdGFsbF9zdGF0dXMnKSBhbmQgc3RyKGRldmljZV9yYXcuZ2V0KCdpbnN0YWxsX3N0YXR1cycpKSBpbiBzZWxmLl9faW5zdGFsbF9zdGF0dXNfZXhjbHVkZV9saXN0OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gd2l0aCBpbnN0YWxsIHN0YXR1cyBleGNsdWRlIGxpc3QnKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZidQcm9ibGVtIGF0IGFzc2V0IHRhYmxlIGluZm9ybWF0aW9uIHtkZXZpY2VfcmF3fScsIGV4Y19pbmZvPVRydWUpCgogICAgICAgICAgICBvd25lZF9ieSA9IHVzZXJzX3RhYmxlX2RpY3QuZ2V0KChkZXZpY2VfcmF3LmdldCgnb3duZWRfYnknKSBvciB7fSkuZ2V0KCd2YWx1ZScpKSBvciB7fQogICAgICAgICAgICBpZiBvd25lZF9ieToKICAgICAgICAgICAgICAgIGRldmljZS5vd25lciA9IG93bmVkX2J5LmdldCgnbmFtZScpCiAgICAgICAgICAgICAgICBpZiBvd25lZF9ieS5nZXQoJ2VtYWlsJyk6CiAgICAgICAgICAgICAgICAgICAgZGV2aWNlLmVtYWlsID0gb3duZWRfYnkuZ2V0KCdlbWFpbCcpCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBhc3NpZ25lZF90byA9IHVzZXJzX3RhYmxlX2RpY3QuZ2V0KChkZXZpY2VfcmF3LmdldCgnYXNzaWduZWRfdG8nKSBvciB7fSkuZ2V0KCd2YWx1ZScpKQogICAgICAgICAgICAgICAgaWYgYXNzaWduZWRfdG86CiAgICAgICAgICAgICAgICAgICAgZGV2aWNlLmFzc2lnbmVkX3RvID0gYXNzaWduZWRfdG8uZ2V0KCduYW1lJykKICAgICAgICAgICAgICAgICAgICBkZXZpY2UuZW1haWwgPSBhc3NpZ25lZF90by5nZXQoJ2VtYWlsJykKICAgICAgICAgICAgICAgICAgICBkZXZpY2UuYXNzaWduZWRfdG9fY291bnRyeSA9IGFzc2lnbmVkX3RvLmdldCgnY291bnRyeScpCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlLmFzc2lnbmVkX3RvX2RpdmlzaW9uID0gYXNzaWduZWRfdG8uZ2V0KCd1X2RpdmlzaW9uJykKICAgICAgICAgICAgICAgICAgICBkZXZpY2UuYXNzaWduZWRfdG9fYnVzaW5lc3NfdW5pdCA9IGFzc2lnbmVkX3RvLmdldCgndV9idXNpbmVzc191bml0JykKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIG1hbmFnZXJfdmFsdWUgPSAoYXNzaWduZWRfdG8uZ2V0KCdtYW5hZ2VyJykgb3Ige30pLmdldCgndmFsdWUnKQogICAgICAgICAgICAgICAgICAgICAgICBtYW5hZ2VyX3JhdyA9IHVzZXJzX3RhYmxlX2RpY3QuZ2V0KHVzZXJzX3VzZXJuYW1lX2RpY3QuZ2V0KG1hbmFnZXJfdmFsdWUpKSBvciB7fQogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2UubWFuYWdlcl9lbWFpbCA9IG1hbmFnZXJfcmF3LmdldCgnZW1haWwnKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIGdldHRpbmcgbWFuYWdlciB7ZGV2aWNlX3Jhd30nKQogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgYXNzaWduZWRfdG9fbG9jYXRpb25fdmFsdWUgPSAoYXNzaWduZWRfdG8uZ2V0KCdsb2NhdGlvbicpIG9yIHt9KS5nZXQoJ3ZhbHVlJykKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlLmFzc2lnbmVkX3RvX2xvY2F0aW9uID0gKHNub3dfbG9jYXRpb25fdGFibGVfZGljdC5nZXQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NpZ25lZF90b19sb2NhdGlvbl92YWx1ZSkgb3Ige30pLmdldCgnbmFtZScpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihmJ1Byb2JsZW0gZ2V0dGluZyBhc3NpbmcgdG8gbG9jYXRpb24gaW4ge2RldmljZV9yYXd9JykKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIGFkZGluZyBhc3NpZ25lZF90byB0byB7ZGV2aWNlX3Jhd30nKQoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHZlbmRvcl9saW5rID0gKGRldmljZV9yYXcuZ2V0KCd2ZW5kb3InKSBvciB7fSkuZ2V0KCd2YWx1ZScpCiAgICAgICAgICAgICAgICAgICAgaWYgdmVuZG9yX2xpbmsgYW5kIGNvbXBhbmllc190YWJsZV9kaWN0LmdldCh2ZW5kb3JfbGluayk6CiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS52ZW5kb3IgPSBjb21wYW5pZXNfdGFibGVfZGljdC5nZXQodmVuZG9yX2xpbmspLmdldCgnbmFtZScpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIGdldHRpbmcgdmVuZG9yIGZvciB7ZGV2aWNlX3Jhd30nKQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG1hbnVmYWN0dXJlcl9saW5rID0gKGRldmljZV9yYXcuZ2V0KCdtYW51ZmFjdHVyZXInKSBvciB7fSkuZ2V0KCd2YWx1ZScpCiAgICAgICAgICAgICAgICAgICAgaWYgbWFudWZhY3R1cmVyX2xpbmsgYW5kIGNvbXBhbmllc190YWJsZV9kaWN0LmdldChtYW51ZmFjdHVyZXJfbGluayk6CiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5kZXZpY2VfbWFudWZhY3R1cmVyID0gY29tcGFuaWVzX3RhYmxlX2RpY3QuZ2V0KG1hbnVmYWN0dXJlcl9saW5rKS5nZXQoJ25hbWUnKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZS5kZXZpY2VfbWFudWZhY3R1cmVyID0gZGV2aWNlX3Jhdy5nZXQoJ3VfbWFudWZhY3R1cmVyX25hbWUnKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnUHJvYmxlbSBnZXR0aW5nIG1hbnVmYWN0dXJlciBmb3Ige2RldmljZV9yYXd9JykKICAgICAgICAgICAgICAgIGNwdV9tYW51ZmFjdHVyZXIgPSBOb25lCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgY3B1X21hbnVmYWN0dXJlcl9saW5rID0gKGRldmljZV9yYXcuZ2V0KCdjcHVfbWFudWZhY3R1cmVyJykgb3Ige30pLmdldCgndmFsdWUnKQogICAgICAgICAgICAgICAgICAgIGlmIGNwdV9tYW51ZmFjdHVyZXJfbGluayBhbmQgY29tcGFuaWVzX3RhYmxlX2RpY3QuZ2V0KGNwdV9tYW51ZmFjdHVyZXJfbGluayk6CiAgICAgICAgICAgICAgICAgICAgICAgIGNwdV9tYW51ZmFjdHVyZXIgPSBjb21wYW5pZXNfdGFibGVfZGljdC5nZXQoY3B1X21hbnVmYWN0dXJlcl9saW5rKS5nZXQoJ25hbWUnKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnUHJvYmxlbSBnZXR0aW5nIG1hbnVmYWN0dXJlciBmb3Ige2RldmljZV9yYXd9JykKICAgICAgICAgICAgICAgIGdoeiA9IGRldmljZV9yYXcuZ2V0KCdjcHVfc3BlZWQnKQogICAgICAgICAgICAgICAgaWYgZ2h6OgogICAgICAgICAgICAgICAgICAgIGdoeiA9IGZsb2F0KGdoeikgLyAxMDI0LjAKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZ2h6ID0gTm9uZQogICAgICAgICAgICAgICAgZGV2aWNlLmFkZF9jcHUobmFtZT1kZXZpY2VfcmF3LmdldCgnY3B1X25hbWUnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcmVzPWludChkZXZpY2VfcmF3LmdldCgnY3B1X2NvdW50JykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBkZXZpY2VfcmF3LmdldCgnY3B1X2NvdW50JykgZWxzZSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29yZXNfdGhyZWFkPWludChkZXZpY2VfcmF3LmdldCgnY3B1X2NvcmVfdGhyZWFkJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBkZXZpY2VfcmF3LmdldCgnY3B1X2NvcmVfdGhyZWFkJykgZWxzZSBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2h6PWdoeiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hbnVmYWN0dXJlcj1jcHVfbWFudWZhY3R1cmVyKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihmJ1Byb2JsZW0gYWRkaW5nIGNwdSBzdHVmZiB0byB7ZGV2aWNlX3Jhd30nKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkZXZpY2UuZGlzY292ZXJ5X3NvdXJjZSA9IGRldmljZV9yYXcuZ2V0KCdkaXNjb3Zlcnlfc291cmNlJykKICAgICAgICAgICAgICAgIGRldmljZS5maXJzdF9kaXNjb3ZlcmVkID0gcGFyc2VfZGF0ZShkZXZpY2VfcmF3LmdldCgnZmlyc3RfZGlzY292ZXJlZCcpKQogICAgICAgICAgICAgICAgbGFzdF9kaXNjb3ZlcmVkID0gcGFyc2VfZGF0ZShkZXZpY2VfcmF3LmdldCgnbGFzdF9kaXNjb3ZlcmVkJykpCiAgICAgICAgICAgICAgICBkZXZpY2UubGFzdF9kaXNjb3ZlcmVkID0gbGFzdF9kaXNjb3ZlcmVkCiAgICAgICAgICAgICAgICBzeXNfdXBkYXRlZF9vbiA9IHBhcnNlX2RhdGUoZGV2aWNlX3Jhdy5nZXQoJ3N5c191cGRhdGVkX29uJykpCiAgICAgICAgICAgICAgICBkZXZpY2Uuc3lzX3VwZGF0ZWRfb24gPSBzeXNfdXBkYXRlZF9vbgogICAgICAgICAgICAgICAgaWYgbGFzdF9kaXNjb3ZlcmVkIGFuZCBzeXNfdXBkYXRlZF9vbjoKICAgICAgICAgICAgICAgICAgICBkZXZpY2UubGFzdF9zZWVuID0gbWF4KHN5c191cGRhdGVkX29uLCBsYXN0X2Rpc2NvdmVyZWQpCiAgICAgICAgICAgICAgICBlbGlmIGxhc3RfZGlzY292ZXJlZCBvciBzeXNfdXBkYXRlZF9vbjoKICAgICAgICAgICAgICAgICAgICBkZXZpY2UubGFzdF9zZWVuID0gbGFzdF9kaXNjb3ZlcmVkIG9yIHN5c191cGRhdGVkX29uCiAgICAgICAgICAgICAgICBkZXZpY2UuY3JlYXRlZF9hdCA9IHBhcnNlX2RhdGUoKGRldmljZV9yYXcuZ2V0KCdzeXNfY3JlYXRlZF9vbicpKSkKICAgICAgICAgICAgICAgIGRldmljZS5jcmVhdGVkX2J5ID0gZGV2aWNlX3Jhdy5nZXQoJ3N5c19jcmVhdGVkX2J5JykKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIGFkZGRpbmcgc291cmNlIHN0dWZmIHRvIHtkZXZpY2VfcmF3fScpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIGRldmljZV9yYXcuZ2V0KCdkaXNrX3NwYWNlJyk6CiAgICAgICAgICAgICAgICAgICAgZGV2aWNlLmFkZF9oZCh0b3RhbF9zaXplPWZsb2F0KGRldmljZV9yYXcuZ2V0KCdkaXNrX3NwYWNlJykpKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihmJ1Byb2JsZW0gYWRkaW5nIGRpc2sgc3R1ZmYgdG8ge2RldmljZV9yYXd9JykKICAgICAgICAgICAgZGV2aWNlLmRvbWFpbiA9IGRldmljZV9yYXcuZ2V0KCdkbnNfZG9tYWluJykKICAgICAgICAgICAgZGV2aWNlLnVzZWRfZm9yID0gZGV2aWNlX3Jhdy5nZXQoJ3VzZWRfZm9yJykKICAgICAgICAgICAgZGV2aWNlLnRlbmFibGVfYXNzZXRfZ3JvdXAgPSBkZXZpY2VfcmF3LmdldCgndV90ZW5hYmxlX2Fzc2V0X2dyb3VwJykKICAgICAgICAgICAgZGV2aWNlLmVudmlyb25tZW50ID0gZGV2aWNlX3Jhdy5nZXQoJ3VfZW52aXJvbm1lbnQnKQogICAgICAgICAgICBkZXZpY2UuY21kYl9idXNpbmVzc19mdW5jdGlvbiA9IGRldmljZV9yYXcuZ2V0KCd1X2NtZGJfYnVzaW5lc3NfZnVuY3Rpb24nKQogICAgICAgICAgICBkZXZpY2UubWFuYWdlbWVudF9pcCA9IGRldmljZV9yYXcuZ2V0KCd1X21hbmFnZW1lbnRfaXAnKQogICAgICAgICAgICBkZXZpY2UuZW5kX29mX3N1cHBvcnQgPSBkZXZpY2VfcmF3LmdldCgndV9lbmRfb2Zfc3VwcG9ydCcpCiAgICAgICAgICAgIGRldmljZS5maXJtd2FyZV92ZXJzaW9uID0gZGV2aWNlX3Jhdy5nZXQoJ3VfZmlybXdhcmVfdmVyc2lvbicpCiAgICAgICAgICAgIGRldmljZS5tb2RlbF92ZXJzaW9uX251bWJlciA9IGRldmljZV9yYXcuZ2V0KCd1X21vZGVsX3ZlcnNpb25fbnVtYmVyJykKICAgICAgICAgICAgZGV2aWNlLm9wZXJhdGlvbmFsX3N0YXR1cyA9IElOU1RBTExfU1RBVFVTX0RJQ1QuZ2V0KGRldmljZV9yYXcuZ2V0KCdvcGVyYXRpb25hbF9zdGF0dXMnKSkKICAgICAgICAgICAgZGV2aWNlLmhhcmR3YXJlX3N0YXR1cyA9IGRldmljZV9yYXcuZ2V0KCdoYXJkd2FyZV9zdGF0dXMnKQogICAgICAgICAgICBkZXZpY2UudV9udW1iZXIgPSBkZXZpY2VfcmF3LmdldCgndV9udW1iZXInKQogICAgICAgICAgICBkZXZpY2Uuc2V0X3JhdyhkZXZpY2VfcmF3KQogICAgICAgICAgICBpZiBub3QgZ290X3NlcmlhbCBhbmQgbm90IGdvdF9uaWMgYW5kIHNlbGYuX19leGNsdWRlX25vX3N0cm9uZ19pZGVudGlmaWVyOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgcmV0dXJuIGRldmljZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIHdpdGggZmV0Y2hpbmcgU2VydmljZU5vdyBEZXZpY2Uge2RldmljZV9yYXd9JykKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgX2dldF9jbGllbnRfaWQoc2VsZiwgY2xpZW50X2NvbmZpZyk6CiAgICAgICAgcmV0dXJuIGNsaWVudF9jb25maWdbJ2RvbWFpbiddCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIF90ZXN0X3JlYWNoYWJpbGl0eShjbGllbnRfY29uZmlnKToKICAgICAgICByZXR1cm4gUkVTVENvbm5lY3Rpb24udGVzdF9yZWFjaGFiaWxpdHkoY2xpZW50X2NvbmZpZy5nZXQoJ2RvbWFpbicpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBodHRwc19wcm94eT1jbGllbnRfY29uZmlnLmdldCgnaHR0cHNfcHJveHknKSkKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgZ2V0X2Nvbm5lY3Rpb24oY2xpZW50X2NvbmZpZyk6CiAgICAgICAgaHR0cHNfcHJveHkgPSBjbGllbnRfY29uZmlnLmdldCgnaHR0cHNfcHJveHknKQogICAgICAgIGlmIGh0dHBzX3Byb3h5IGFuZCBodHRwc19wcm94eS5zdGFydHN3aXRoKCdodHRwOi8vJyk6CiAgICAgICAgICAgIGh0dHBzX3Byb3h5ID0gJ2h0dHBzOi8vJyArIGh0dHBzX3Byb3h5W2xlbignaHR0cDovLycpOl0KICAgICAgICBjb25uZWN0aW9uID0gU2VydmljZU5vd0Nvbm5lY3Rpb24oCiAgICAgICAgICAgIGRvbWFpbj1jbGllbnRfY29uZmlnWydkb21haW4nXSwgdmVyaWZ5X3NzbD1jbGllbnRfY29uZmlnWyd2ZXJpZnlfc3NsJ10sCiAgICAgICAgICAgIHVzZXJuYW1lPWNsaWVudF9jb25maWdbJ3VzZXJuYW1lJ10sCiAgICAgICAgICAgIHBhc3N3b3JkPWNsaWVudF9jb25maWdbJ3Bhc3N3b3JkJ10sIGh0dHBzX3Byb3h5PWh0dHBzX3Byb3h5KQogICAgICAgIHdpdGggY29ubmVjdGlvbjoKICAgICAgICAgICAgcGFzcyAgIyBjaGVjayB0aGF0IHRoZSBjb25uZWN0aW9uIGNyZWRlbnRpYWxzIGFyZSB2YWxpZAogICAgICAgIHJldHVybiBjb25uZWN0aW9uCgogICAgZGVmIF9jb25uZWN0X2NsaWVudChzZWxmLCBjbGllbnRfY29uZmlnKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLmdldF9jb25uZWN0aW9uKGNsaWVudF9jb25maWcpCiAgICAgICAgZXhjZXB0IFJFU1RFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbWVzc2FnZSA9ICdFcnJvciBjb25uZWN0aW5nIHRvIGNsaWVudCB3aXRoIGRvbWFpbiB7MH0sIHJlYXNvbjogezF9Jy5mb3JtYXQoCiAgICAgICAgICAgICAgICBjbGllbnRfY29uZmlnWydkb21haW4nXSwgc3RyKGUpKQogICAgICAgICAgICBsb2dnZXIud2FybmluZyhtZXNzYWdlLCBleGNfaW5mbz1UcnVlKQogICAgICAgICAgICByYWlzZSBDbGllbnRDb25uZWN0aW9uRXhjZXB0aW9uKG1lc3NhZ2UpCgogICAgZGVmIF9xdWVyeV9kZXZpY2VzX2J5X2NsaWVudChzZWxmLCBjbGllbnRfbmFtZSwgY2xpZW50X2RhdGEpOgogICAgICAgICIiIgogICAgICAgIEdldCBhbGwgZGV2aWNlcyBmcm9tIGEgc3BlY2lmaWMgU2VydmljZU5vdyBkb21haW4KCiAgICAgICAgOnBhcmFtIHN0ciBjbGllbnRfbmFtZTogVGhlIG5hbWUgb2YgdGhlIGNsaWVudAogICAgICAgIDpwYXJhbSBvYmogY2xpZW50X2RhdGE6IFRoZSBkYXRhIHRoYXQgcmVwcmVzZW50IGEgU2VydmljZU5vdyBjb25uZWN0aW9uCgogICAgICAgIDpyZXR1cm46IEEganNvbiB3aXRoIGFsbCB0aGUgYXR0cmlidXRlcyByZXR1cm5lZCBmcm9tIHRoZSBTZXJ2aWNlTm93IFNlcnZlcgogICAgICAgICIiIgogICAgICAgIHdpdGggY2xpZW50X2RhdGE6CiAgICAgICAgICAgIHlpZWxkIGZyb20gY2xpZW50X2RhdGEuZ2V0X2RldmljZV9saXN0KGZldGNoX3VzZXJzX2luZm9fZm9yX2RldmljZXM9c2VsZi5fX2ZldGNoX3VzZXJzX2luZm9fZm9yX2RldmljZXMpCgogICAgZGVmIF9xdWVyeV91c2Vyc19ieV9jbGllbnQoc2VsZiwga2V5LCBkYXRhKToKICAgICAgICBpZiBzZWxmLl9fZmV0Y2hfdXNlcnM6CiAgICAgICAgICAgIHdpdGggZGF0YToKICAgICAgICAgICAgICAgIHlpZWxkIGZyb20gZGF0YS5nZXRfdXNlcl9saXN0KCkKCiAgICBkZWYgX2NsaWVudHNfc2NoZW1hKHNlbGYpOgogICAgICAgICIiIgogICAgICAgIFRoZSBzY2hlbWEgU2VydmljZU5vd0FkYXB0ZXIgZXhwZWN0cyBmcm9tIGNvbmZpZ3MKCiAgICAgICAgOnJldHVybjogSlNPTiBzY2hlbWUKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAnaXRlbXMnOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJ25hbWUnOiAnZG9tYWluJywKICAgICAgICAgICAgICAgICAgICAndGl0bGUnOiAnU2VydmljZU5vdyBEb21haW4nLAogICAgICAgICAgICAgICAgICAgICd0eXBlJzogJ3N0cmluZycKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJ25hbWUnOiAndXNlcm5hbWUnLAogICAgICAgICAgICAgICAgICAgICd0aXRsZSc6ICdVc2VyIE5hbWUnLAogICAgICAgICAgICAgICAgICAgICd0eXBlJzogJ3N0cmluZycKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJ25hbWUnOiAncGFzc3dvcmQnLAogICAgICAgICAgICAgICAgICAgICd0aXRsZSc6ICdQYXNzd29yZCcsCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnOiAnc3RyaW5nJywKICAgICAgICAgICAgICAgICAgICAnZm9ybWF0JzogJ3Bhc3N3b3JkJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAnbmFtZSc6ICd2ZXJpZnlfc3NsJywKICAgICAgICAgICAgICAgICAgICAndGl0bGUnOiAnVmVyaWZ5IFNTTCcsCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnOiAnYm9vbCcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJ25hbWUnOiAnaHR0cHNfcHJveHknLAogICAgICAgICAgICAgICAgICAgICd0aXRsZSc6ICdIVFRQUyBQcm94eScsCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnOiAnc3RyaW5nJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICAncmVxdWlyZWQnOiBbCiAgICAgICAgICAgICAgICAnZG9tYWluJywKICAgICAgICAgICAgICAgICd1c2VybmFtZScsCiAgICAgICAgICAgICAgICAncGFzc3dvcmQnLAogICAgICAgICAgICAgICAgJ3ZlcmlmeV9zc2wnCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICd0eXBlJzogJ2FycmF5JwogICAgICAgIH0KCiAgICBAYWRkX3J1bGUoJ2NyZWF0ZV9pbmNpZGVudCcsIG1ldGhvZHM9WydQT1NUJ10pCiAgICBkZWYgY3JlYXRlX3NlcnZpY2Vfbm93X2luY2lkZW50KHNlbGYpOgogICAgICAgIGlmIHNlbGYuZ2V0X21ldGhvZCgpICE9ICdQT1NUJzoKICAgICAgICAgICAgcmV0dXJuIHJldHVybl9lcnJvcignTWVkaG9kIG5vdCBzdXBwb3J0ZWQnLCA0MDUpCiAgICAgICAgc2VydmljZV9ub3dfZGljdCA9IHNlbGYuZ2V0X3JlcXVlc3RfZGF0YV9hc19vYmplY3QoKQogICAgICAgIHN1Y2Nlc3MgPSBGYWxzZQogICAgICAgIGZvciBjbGllbnRfaWQgaW4gc2VsZi5fY2xpZW50czoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgY29ubiA9IHNlbGYuZ2V0X2Nvbm5lY3Rpb24oc2VsZi5fZ2V0X2NsaWVudF9jb25maWdfYnlfY2xpZW50X2lkKGNsaWVudF9pZCkpCiAgICAgICAgICAgICAgICB3aXRoIGNvbm46CiAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IHN1Y2Nlc3Mgb3IgY29ubi5jcmVhdGVfc2VydmljZV9ub3dfaW5jaWRlbnQoc2VydmljZV9ub3dfZGljdCkKICAgICAgICAgICAgICAgICAgICBpZiBzdWNjZXNzIGlzIFRydWU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnJywgMjAwCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnQ291bGQgbm90IGNvbm5lY3QgdG8ge2NsaWVudF9pZH0nKQogICAgICAgIHJldHVybiAnRmFpbHVyZScsIDQwMAoKICAgIEBhZGRfcnVsZSgnY3JlYXRlX2NvbXB1dGVyJywgbWV0aG9kcz1bJ1BPU1QnXSkKICAgIGRlZiBjcmVhdGVfc2VydmljZV9ub3dfY29tcHV0ZXIoc2VsZik6CiAgICAgICAgaWYgc2VsZi5nZXRfbWV0aG9kKCkgIT0gJ1BPU1QnOgogICAgICAgICAgICByZXR1cm4gcmV0dXJuX2Vycm9yKCdNZXRob2Qgbm90IHN1cHBvcnRlZCcsIDQwNSkKICAgICAgICByZXF1ZXN0X2pzb24gPSBzZWxmLmdldF9yZXF1ZXN0X2RhdGFfYXNfb2JqZWN0KCkKICAgICAgICBzZXJ2aWNlX25vd19kaWN0ID0gcmVxdWVzdF9qc29uLmdldCgnc25vdycpCiAgICAgICAgc3VjY2VzcyA9IEZhbHNlCiAgICAgICAgZm9yIGNsaWVudF9pZCBpbiBzZWxmLl9jbGllbnRzOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBjb25uID0gc2VsZi5nZXRfY29ubmVjdGlvbihzZWxmLl9nZXRfY2xpZW50X2NvbmZpZ19ieV9jbGllbnRfaWQoY2xpZW50X2lkKSkKICAgICAgICAgICAgICAgIHdpdGggY29ubjoKICAgICAgICAgICAgICAgICAgICByZXN1bHRfc3RhdHVzLCBkZXZpY2VfcmF3ID0gY29ubi5jcmVhdGVfc2VydmljZV9ub3dfY29tcHV0ZXIoc2VydmljZV9ub3dfZGljdCkKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gc3VjY2VzcyBvciByZXN1bHRfc3RhdHVzCiAgICAgICAgICAgICAgICAgICAgaWYgc3VjY2VzcyBpcyBUcnVlOgogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2UgPSBzZWxmLmNyZWF0ZV9zbm93X2RldmljZShkZXZpY2VfcmF3PWRldmljZV9yYXcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoX2lwcz1zZWxmLl9fZmV0Y2hfaXBzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZV90eXBlPSdjbWRiX2NpX2NvbXB1dGVyJykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZGV2aWNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlX2lkID0gZGV2aWNlLmlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VfZGljdCA9IGRldmljZS50b19kaWN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3NhdmVfZGF0YV9mcm9tX3BsdWdpbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGllbnRfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeydyYXcnOiBbXSwgJ3BhcnNlZCc6IFtkZXZpY2VfZGljdF19LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVudGl0eVR5cGUuRGV2aWNlcywgRmFsc2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9zYXZlX2ZpZWxkX25hbWVzX3RvX2RiKEVudGl0eVR5cGUuRGV2aWNlcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvX2NvcnJlbGF0ZSA9IHJlcXVlc3RfanNvbi5nZXQoJ3RvX2Njb3JyZWxhdGUnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZSh0b19jb3JyZWxhdGUsIGRpY3QpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvX2NvcnJlbGF0ZV9wbHVnaW5fdW5pcXVlX25hbWUgPSB0b19jb3JyZWxhdGUuZ2V0KCd0b19jb3JyZWxhdGVfcGx1Z2luX3VuaXF1ZV9uYW1lJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b19jb3JyZWxhdGVfZGV2aWNlX2lkID0gdG9fY29ycmVsYXRlLmdldCgnZGV2aWNlX2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0b19jb3JyZWxhdGVfcGx1Z2luX3VuaXF1ZV9uYW1lIGFuZCB0b19jb3JyZWxhdGVfZGV2aWNlX2lkOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWxhdGlvbl9wYXJhbSA9IENvcnJlbGF0aW9uUmVzdWx0KGFzc29jaWF0ZWRfYWRhcHRlcnM9Wyh0b19jb3JyZWxhdGVfcGx1Z2luX3VuaXF1ZV9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b19jb3JyZWxhdGVfZGV2aWNlX2lkKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc2VsZi5wbHVnaW5fdW5pcXVlX25hbWUsIGRldmljZV9pZCldLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE9eydyZWFzb24nOiAnU2VydmljZU5vdyBEZXZpY2UgQ3JlYXRpb24nfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFzb249Q29ycmVsYXRpb25SZWFzb24uU2VydmljZU5vd0NyZWF0aW9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxpbmtfYWRhcHRlcnMoRW50aXR5VHlwZS5EZXZpY2VzLCBjb3JyZWxhdGlvbl9wYXJhbSkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnLCAyMDAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidDb3VsZCBub3QgY29ubmVjdCB0byB7Y2xpZW50X2lkfScpCiAgICAgICAgcmV0dXJuICdGYWlsdXJlJywgNDAwCgogICAgZGVmIF9wYXJzZV91c2Vyc19yYXdfZGF0YShzZWxmLCByYXdfZGF0YSk6CiAgICAgICAgZm9yIHVzZXJfcmF3IGluIHJhd19kYXRhOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB1c2VyID0gc2VsZi5fbmV3X3VzZXJfYWRhcHRlcigpCiAgICAgICAgICAgICAgICBzeXNfaWQgPSB1c2VyX3Jhdy5nZXQoJ3N5c19pZCcpCiAgICAgICAgICAgICAgICBpZiBub3Qgc3lzX2lkOgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYnQmFkIHVzZXIgd2l0aCBubyBpZCB7dXNlcl9yYXd9JykKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgdXNlci5pZCA9IHN5c19pZAogICAgICAgICAgICAgICAgZm91bmRfd2hpdGVsaXN0ID0gRmFsc2UKICAgICAgICAgICAgICAgIG1haWwgPSB1c2VyX3Jhdy5nZXQoJ2VtYWlsJykKICAgICAgICAgICAgICAgIGlmIHNlbGYuX19lbWFpbF93aGl0ZWxpc3Q6CiAgICAgICAgICAgICAgICAgICAgZm9yIHdoaWVsaXN0X21haWwgaW4gc2VsZi5fX2VtYWlsX3doaXRlbGlzdDoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgd2hpZWxpc3RfbWFpbCBpbiBtYWlsOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmRfd2hpdGVsaXN0ID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBmb3VuZF93aGl0ZWxpc3Q6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICB1c2VyLm1haWwgPSBtYWlsCiAgICAgICAgICAgICAgICB1c2VyLmVtcGxveWVlX251bWJlciA9IHVzZXJfcmF3LmdldCgnZW1wbG95ZWVfbnVtYmVyJykKICAgICAgICAgICAgICAgIHVzZXIudXNlcl9jb3VudHJ5ID0gdXNlcl9yYXcuZ2V0KCdjb3VudHJ5JykKICAgICAgICAgICAgICAgIHVzZXIuZmlyc3RfbmFtZSA9IHVzZXJfcmF3LmdldCgnZmlyc3RfbmFtZScpCiAgICAgICAgICAgICAgICBhY3RpdmUgPSB1c2VyX3Jhdy5nZXQoJ2FjdGl2ZScpCiAgICAgICAgICAgICAgICBpZiBzZWxmLl9fZmV0Y2hfb25seV9hY3RpdmVfdXNlcnMgYW5kIGFjdGl2ZSAhPSAndHJ1ZSc6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIHVzZXIuYWN0aXZlID0gYWN0aXZlCiAgICAgICAgICAgICAgICB1c2VyLmxhc3RfbmFtZSA9IHVzZXJfcmF3LmdldCgnbGFzdF9uYW1lJykKICAgICAgICAgICAgICAgIHVzZXIudXNlcm5hbWUgPSB1c2VyX3Jhdy5nZXQoJ25hbWUnKQogICAgICAgICAgICAgICAgdXBkYXRlZF9vbiA9IHBhcnNlX2RhdGUodXNlcl9yYXcuZ2V0KCdzeXNfdXBkYXRlZF9vbicpKQogICAgICAgICAgICAgICAgdXNlci51cGRhdGVkX29uID0gdXBkYXRlZF9vbgogICAgICAgICAgICAgICAgbGFzdF9sb2dvbiA9IHBhcnNlX2RhdGUodXNlcl9yYXcuZ2V0KCdsYXN0X2xvZ2luX3RpbWUnKSkKICAgICAgICAgICAgICAgIHVzZXIubGFzdF9sb2dvbiA9IGxhc3RfbG9nb24KICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBsYXN0X2xvZ29uIGFuZCB1cGRhdGVkX29uOgogICAgICAgICAgICAgICAgICAgICAgICB1c2VyLmxhc3Rfc2VlbiA9IG1heChsYXN0X2xvZ29uLCB1cGRhdGVkX29uKQogICAgICAgICAgICAgICAgICAgIGVsaWYgbGFzdF9sb2dvbiBvciB1cGRhdGVkX29uOgogICAgICAgICAgICAgICAgICAgICAgICB1c2VyLmxhc3Rfc2VlbiA9IGxhc3RfbG9nb24gb3IgdXBkYXRlZF9vbgogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnUHJvYmxlbSBnZXR0aW5nIGxhc3Qgc2VlbiBmb3Ige3VzZXJfcmF3fScpCiAgICAgICAgICAgICAgICB1c2VyLnVzZXJfdGl0bGUgPSB1c2VyX3Jhdy5nZXQoJ3RpdGxlJykKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICB1c2VyLnVzZXJfbWFuYWdlciA9ICh1c2VyX3Jhdy5nZXQoJ21hbmFnZXJfZnVsbCcpIG9yIHt9KS5nZXQoJ25hbWUnKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gZ2V0dGluZyBtYW5hZ2VyIGZvciB7dXNlcl9yYXd9JywgZXhjX2luZm89VHJ1ZSkKICAgICAgICAgICAgICAgIHVzZXIuc25vd19zb3VyY2UgPSB1c2VyX3Jhdy5nZXQoJ3NvdXJjZScpCiAgICAgICAgICAgICAgICB1c2VyLnNub3dfcm9sZXMgPSB1c2VyX3Jhdy5nZXQoJ3JvbGVzJykKICAgICAgICAgICAgICAgIHVzZXIudXNlcl90ZWxlcGhvbmVfbnVtYmVyID0gdXNlcl9yYXcuZ2V0KCdwaG9uZScpCiAgICAgICAgICAgICAgICB1c2VyLnNldF9yYXcodXNlcl9yYXcpCiAgICAgICAgICAgICAgICB5aWVsZCB1c2VyCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmJ1Byb2JsZW0gZ2V0dGluZyB1c2VyIHt1c2VyX3Jhd30nLCBleGNfaW5mbz1UcnVlKQoKICAgIGRlZiBfcGFyc2VfcmF3X2RhdGEoc2VsZiwgZGV2aWNlc19yYXdfZGF0YSk6CiAgICAgICAgZm9yIHRhYmxlX2RldmljZXNfZGF0YSBpbiBkZXZpY2VzX3Jhd19kYXRhOgogICAgICAgICAgICB1c2Vyc190YWJsZV9kaWN0ID0gdGFibGVfZGV2aWNlc19kYXRhLmdldChVU0VSU19UQUJMRV9LRVkpCiAgICAgICAgICAgIHVzZXJzX3VzZXJuYW1lX2RpY3QgPSB0YWJsZV9kZXZpY2VzX2RhdGEuZ2V0KFVTRVJTX1VTRVJOQU1FX0tFWSkKICAgICAgICAgICAgc25vd19kZXBhcnRtZW50X3RhYmxlX2RpY3QgPSB0YWJsZV9kZXZpY2VzX2RhdGEuZ2V0KERFUEFSVE1FTlRfVEFCTEVfS0VZKQogICAgICAgICAgICBzbm93X2xvY2F0aW9uX3RhYmxlX2RpY3QgPSB0YWJsZV9kZXZpY2VzX2RhdGEuZ2V0KExPQ0FUSU9OX1RBQkxFX0tFWSkKICAgICAgICAgICAgc25vd191c2VyX2dyb3Vwc190YWJsZV9kaWN0ID0gdGFibGVfZGV2aWNlc19kYXRhLmdldChVU0VSX0dST1VQU19UQUJMRV9LRVkpCiAgICAgICAgICAgIHNub3dfbmljc190YWJsZV9kaWN0ID0gdGFibGVfZGV2aWNlc19kYXRhLmdldChOSUNfVEFCTEVfS0VZKQogICAgICAgICAgICBzbm93X2FsbV9hc3NldF90YWJsZV9kaWN0ID0gdGFibGVfZGV2aWNlc19kYXRhLmdldChBTE1fQVNTRVRfVEFCTEUpCiAgICAgICAgICAgIGNvbXBhbmllc190YWJsZV9kaWN0ID0gdGFibGVfZGV2aWNlc19kYXRhLmdldChDT01QQU5ZX1RBQkxFKQogICAgICAgICAgICBpcHNfdGFibGVfZGljdCA9IHRhYmxlX2RldmljZXNfZGF0YS5nZXQoSVBTX1RBQkxFKQogICAgICAgICAgICBmb3IgZGV2aWNlX3JhdyBpbiB0YWJsZV9kZXZpY2VzX2RhdGFbREVWSUNFU19LRVldOgogICAgICAgICAgICAgICAgZGV2aWNlID0gc2VsZi5jcmVhdGVfc25vd19kZXZpY2UoZGV2aWNlX3Jhdz1kZXZpY2VfcmF3LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc25vd19kZXBhcnRtZW50X3RhYmxlX2RpY3Q9c25vd19kZXBhcnRtZW50X3RhYmxlX2RpY3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbm93X2xvY2F0aW9uX3RhYmxlX2RpY3Q9c25vd19sb2NhdGlvbl90YWJsZV9kaWN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc25vd19hbG1fYXNzZXRfdGFibGVfZGljdD1zbm93X2FsbV9hc3NldF90YWJsZV9kaWN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc25vd19uaWNzX3RhYmxlX2RpY3Q9c25vd19uaWNzX3RhYmxlX2RpY3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2Vyc190YWJsZV9kaWN0PXVzZXJzX3RhYmxlX2RpY3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2Vyc191c2VybmFtZV9kaWN0PXVzZXJzX3VzZXJuYW1lX2RpY3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wYW5pZXNfdGFibGVfZGljdD1jb21wYW5pZXNfdGFibGVfZGljdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNub3dfdXNlcl9ncm91cHNfdGFibGVfZGljdD1zbm93X3VzZXJfZ3JvdXBzX3RhYmxlX2RpY3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpcHNfdGFibGVfZGljdD1pcHNfdGFibGVfZGljdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoX2lwcz1zZWxmLl9fZmV0Y2hfaXBzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVfdHlwZT10YWJsZV9kZXZpY2VzX2RhdGFbREVWSUNFX1RZUEVfTkFNRV9LRVldKQogICAgICAgICAgICAgICAgaWYgZGV2aWNlOgogICAgICAgICAgICAgICAgICAgIHlpZWxkIGRldmljZQoKICAgIEBjbGFzc21ldGhvZAogICAgZGVmIGFkYXB0ZXJfcHJvcGVydGllcyhjbHMpOgogICAgICAgIHJldHVybiBbQWRhcHRlclByb3BlcnR5LkFzc2V0c10KCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBfZGJfY29uZmlnX3NjaGVtYShjbHMpIC0+IGRpY3Q6CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgIml0ZW1zIjogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICduYW1lJzogJ2ZldGNoX3VzZXJzX2luZm9fZm9yX2RldmljZXMnLAogICAgICAgICAgICAgICAgICAgICd0eXBlJzogJ2Jvb2wnLAogICAgICAgICAgICAgICAgICAgICd0aXRsZSc6ICdGZXRjaCB1c2VycyBkYXRhJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAnbmFtZSc6ICdmZXRjaF91c2VycycsCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnOiAnYm9vbCcsCiAgICAgICAgICAgICAgICAgICAgJ3RpdGxlJzogJ0NyZWF0ZSB1c2VycycKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJ25hbWUnOiAnZmV0Y2hfaXBzJywKICAgICAgICAgICAgICAgICAgICAndHlwZSc6ICdib29sJywKICAgICAgICAgICAgICAgICAgICAndGl0bGUnOiAnRmV0Y2ggSVAgYWRkcmVzc2VzJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAnbmFtZSc6ICdleGNsdWRlX2Rpc3Bvc2VkX2RldmljZXMnLAogICAgICAgICAgICAgICAgICAgICd0aXRsZSc6ICdFeGNsdWRlIGRpc3Bvc2VkIGFuZCBkZWNvbW1pc3Npb25lZCBkZXZpY2VzJywKICAgICAgICAgICAgICAgICAgICAndHlwZSc6ICdib29sJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAnbmFtZSc6ICdleGNsdWRlX25vX3N0cm9uZ19pZGVudGlmaWVyJywKICAgICAgICAgICAgICAgICAgICAndGl0bGUnOiAnRG8gbm90IGZldGNoIGRldmljZXMgd2l0aG91dCBJUCBhZGRyZXNzLCBNQUMgYWRkcmVzcyBhbmQgc2VyaWFsIG51bWJlcicsCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnOiAnYm9vbCcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJ25hbWUnOiAndXNlX2NpX3RhYmxlX2Zvcl9pbnN0YWxsX3N0YXR1cycsCiAgICAgICAgICAgICAgICAgICAgJ3RpdGxlJzogJ1VzZSBDTURCX0NJIHRhYmxlIGluc3RlYWQgb2YgQUxNIEFTU0VUIHRhYmxlIGZvciBpbnN0YWxsIHN0YXR1cycsCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnOiAnYm9vbCcKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJ25hbWUnOiAnZXhjbHVkZV92bV90YWJsZXMnLAogICAgICAgICAgICAgICAgICAgICd0eXBlJzogJ2Jvb2wnLAogICAgICAgICAgICAgICAgICAgICd0aXRsZSc6ICdFeGNsdWRlIFZNcyB0YWJsZXMnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICduYW1lJzogJ2VtYWlsX3doaXRlbGlzdCcsCiAgICAgICAgICAgICAgICAgICAgJ3RpdGxlJzogJ1VzZXJzIEVtYWlsIHdoaXRlbGlzdCcsCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnOiAnc3RyaW5nJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAnbmFtZSc6ICdmZXRjaF9vbmx5X2FjdGl2ZV91c2VycycsCiAgICAgICAgICAgICAgICAgICAgJ3R5cGUnOiAnYm9vbCcsCiAgICAgICAgICAgICAgICAgICAgJ3RpdGxlJzogJ0ZldGNoIG9ubHkgYWN0aXZlIHVzZXJzJwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAnbmFtZSc6ICdpbnN0YWxsX3N0YXR1c19leGNsdWRlX2xpc3QnLAogICAgICAgICAgICAgICAgICAgICd0aXRsZSc6ICdJbnN0YWxsIHN0YXR1cyBudW1iZXIgZXhjbHVkZSBsaXN0JywKICAgICAgICAgICAgICAgICAgICAndHlwZSc6ICdzdHJpbmcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJyZXF1aXJlZCI6IFsKICAgICAgICAgICAgICAgICdmZXRjaF91c2VycycsCiAgICAgICAgICAgICAgICAnZmV0Y2hfaXBzJywgJ3VzZV9jaV90YWJsZV9mb3JfaW5zdGFsbF9zdGF0dXMnLAogICAgICAgICAgICAgICAgJ2V4Y2x1ZGVfZGlzcG9zZWRfZGV2aWNlcycsCiAgICAgICAgICAgICAgICAnZmV0Y2hfdXNlcnNfaW5mb19mb3JfZGV2aWNlcycsCiAgICAgICAgICAgICAgICAnZXhjbHVkZV9ub19zdHJvbmdfaWRlbnRpZmllcicsCiAgICAgICAgICAgICAgICAnZXhjbHVkZV92bV90YWJsZXMnLAogICAgICAgICAgICAgICAgJ2ZldGNoX29ubHlfYWN0aXZlX3VzZXJzJwogICAgICAgICAgICBdLAogICAgICAgICAgICAicHJldHR5X25hbWUiOiAiU2VydmljZU5vdyBDb25maWd1cmF0aW9uIiwKICAgICAgICAgICAgInR5cGUiOiAiYXJyYXkiCiAgICAgICAgfQoKICAgIEBjbGFzc21ldGhvZAogICAgZGVmIF9kYl9jb25maWdfZGVmYXVsdChjbHMpOgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICdmZXRjaF91c2Vycyc6IFRydWUsCiAgICAgICAgICAgICdmZXRjaF9pcHMnOiBUcnVlLAogICAgICAgICAgICAnZmV0Y2hfdXNlcnNfaW5mb19mb3JfZGV2aWNlcyc6IFRydWUsCiAgICAgICAgICAgICdleGNsdWRlX2Rpc3Bvc2VkX2RldmljZXMnOiBGYWxzZSwKICAgICAgICAgICAgJ2V4Y2x1ZGVfbm9fc3Ryb25nX2lkZW50aWZpZXInOiBGYWxzZSwKICAgICAgICAgICAgJ3VzZV9jaV90YWJsZV9mb3JfaW5zdGFsbF9zdGF0dXMnOiBGYWxzZSwKICAgICAgICAgICAgJ2V4Y2x1ZGVfdm1fdGFibGVzJzogRmFsc2UsCiAgICAgICAgICAgICdlbWFpbF93aGl0ZWxpc3QnOiBOb25lLAogICAgICAgICAgICAnZmV0Y2hfb25seV9hY3RpdmVfdXNlcnMnOiBGYWxzZSwKICAgICAgICAgICAgJ2luc3RhbGxfc3RhdHVzX2V4Y2x1ZGVfbGlzdCc6IE5vbmUKICAgICAgICB9CgogICAgZGVmIF9vbl9jb25maWdfdXBkYXRlKHNlbGYsIGNvbmZpZyk6CiAgICAgICAgc2VsZi5fX2ZldGNoX3VzZXJzID0gY29uZmlnWydmZXRjaF91c2VycyddCiAgICAgICAgc2VsZi5fX2ZldGNoX2lwcyA9IGNvbmZpZ1snZmV0Y2hfaXBzJ10KICAgICAgICBzZWxmLl9fZmV0Y2hfdXNlcnNfaW5mb19mb3JfZGV2aWNlcyA9IGNvbmZpZ1snZmV0Y2hfdXNlcnNfaW5mb19mb3JfZGV2aWNlcyddCiAgICAgICAgc2VsZi5fX2V4Y2x1ZGVfZGlzcG9zZWRfZGV2aWNlcyA9IGNvbmZpZ1snZXhjbHVkZV9kaXNwb3NlZF9kZXZpY2VzJ10KICAgICAgICBzZWxmLl9fZXhjbHVkZV9ub19zdHJvbmdfaWRlbnRpZmllciA9IGNvbmZpZ1snZXhjbHVkZV9ub19zdHJvbmdfaWRlbnRpZmllciddCiAgICAgICAgc2VsZi5fX3VzZV9jaV90YWJsZV9mb3JfaW5zdGFsbF9zdGF0dXMgPSBjb25maWdbJ3VzZV9jaV90YWJsZV9mb3JfaW5zdGFsbF9zdGF0dXMnXQogICAgICAgIHNlbGYuX19leGNsdWRlX3ZtX3RhYmxlcyA9IGNvbmZpZ1snZXhjbHVkZV92bV90YWJsZXMnXQogICAgICAgIHNlbGYuX19lbWFpbF93aGl0ZWxpc3QgPSBjb25maWdbJ2VtYWlsX3doaXRlbGlzdCddLnNwbGl0KCcsJykgaWYgY29uZmlnLmdldCgnZW1haWxfd2hpdGVsaXN0JykgZWxzZSBOb25lCiAgICAgICAgc2VsZi5fX2ZldGNoX29ubHlfYWN0aXZlX3VzZXJzID0gY29uZmlnLmdldCgnZmV0Y2hfb25seV9hY3RpdmVfdXNlcnMnKSBvciBGYWxzZQogICAgICAgIHNlbGYuX19pbnN0YWxsX3N0YXR1c19leGNsdWRlX2xpc3QgPSBjb25maWcuZ2V0KCdpbnN0YWxsX3N0YXR1c19leGNsdWRlX2xpc3QnKS5zcGxpdCgnLCcpIFwKICAgICAgICAgICAgaWYgY29uZmlnLmdldCgnaW5zdGFsbF9zdGF0dXNfZXhjbHVkZV9saXN0JykgZWxzZSBOb25lCgogICAgZGVmIG91dHNpZGVfcmVhc29uX3RvX2xpdmUoc2VsZikgLT4gYm9vbDoKICAgICAgICAiIiIKICAgICAgICBUaGlzIGFkYXB0ZXIgbWlnaHQgYmUgY2FsbGVkIGZyb20gb3V0c2lkZSwgbGV0IGl0IGxpdmUKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gVHJ1ZQo=',
    f'{CORTEX}/axonius-libs/src/libs/axonius-py/axonius/clients/service_now/connection.py': b'aW1wb3J0IGlvCmltcG9ydCBqc29uCmltcG9ydCBsb2dnaW5nCgpmcm9tIGF4b25pdXMuY2xpZW50cy5yZXN0LmNvbm5lY3Rpb24gaW1wb3J0IFJFU1RDb25uZWN0aW9uCmZyb20gYXhvbml1cy5jbGllbnRzLnJlc3QuZXhjZXB0aW9uIGltcG9ydCBSRVNURXhjZXB0aW9uCmZyb20gYXhvbml1cy5jbGllbnRzLnNlcnZpY2Vfbm93IGltcG9ydCBjb25zdHMKZnJvbSBheG9uaXVzLmNvbnN0cyBpbXBvcnQgcmVwb3J0X2NvbnN0cwoKbG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoZidheG9uaXVzLntfX25hbWVfX30nKQoKCmNsYXNzIFNlcnZpY2VOb3dDb25uZWN0aW9uKFJFU1RDb25uZWN0aW9uKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCAqYXJncywgKiprd2FyZ3MpOgogICAgICAgICIiIiBJbml0aWFsaXplcyBhIGNvbm5lY3Rpb24gdG8gU2VydmljZU5vdyB1c2luZyBpdHMgcmVzdCBBUEkKCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5fX3VzZXJzX3RhYmxlID0gZGljdCgpCiAgICAgICAgc2VsZi5fX251bWJlcl9vZl9vZmZzZXRzID0gY29uc3RzLk5VTUJFUl9PRl9PRkZTRVRTCiAgICAgICAgc2VsZi5fX29mZnNldF9zaXplID0gY29uc3RzLk9GRlNFVF9TSVpFCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXyh1cmxfYmFzZV9wcmVmaXg9J2FwaS9ub3cvJywgKmFyZ3MsICoqa3dhcmdzKQogICAgICAgIHNlbGYuX3Blcm1hbmVudF9oZWFkZXJzID0geydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbid9CiAgICAgICAgc2VsZi5fX251bWJlcl9vZl9pbmNpZGVudHMgPSAwCiAgICAgICAgc2VsZi5fX251bWJlcl9vZl9uZXdfY29tcHV0ZXJzID0gMAoKICAgIGRlZiBfY29ubmVjdChzZWxmKToKICAgICAgICBpZiBzZWxmLl91c2VybmFtZSBpcyBub3QgTm9uZSBhbmQgc2VsZi5fcGFzc3dvcmQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHNlbGYuX2dldCgndGFibGUvY21kYl9jaV9jb21wdXRlcicsIHVybF9wYXJhbXM9eydzeXNwYXJtX2xpbWl0JzogMX0sIGRvX2Jhc2ljX2F1dGg9VHJ1ZSkKICAgICAgICBlbHNlOgogICAgICAgICAgICByYWlzZSBSRVNURXhjZXB0aW9uKCdObyB1c2VyIG5hbWUgb3IgcGFzc3dvcmQnKQoKICAgIGRlZiBfdXBsb2FkX2Nzdl90b190YWJsZShzZWxmLCB0YWJsZV9uYW1lLCB0YWJsZV9zeXNfaWQsIGNzdl9zdHJpbmcpOgogICAgICAgIGNzdl9ieXRlcyA9IGlvLkJ5dGVzSU8oY3N2X3N0cmluZy5lbmNvZGUoJ3V0Zi04JykpCiAgICAgICAgc2VsZi5fcG9zdCgnYXR0YWNobWVudC9maWxlJywKICAgICAgICAgICAgICAgICAgIHVybF9wYXJhbXM9eyd0YWJsZV9uYW1lJzogdGFibGVfbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0YWJsZV9zeXNfaWQnOiB0YWJsZV9zeXNfaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZmlsZV9uYW1lJzogJ3JlcG9ydC5jc3YnfSwKICAgICAgICAgICAgICAgICAgIGZpbGVzX3BhcmFtPXsnZmlsZSc6ICgncmVwb3J0LmNzdicsIGNzdl9ieXRlcywgJ3RleHQvY3N2JywgeydFeHBpcmVzJzogJzAnfSl9LAogICAgICAgICAgICAgICAgICAgZXh0cmFfaGVhZGVycz17J0NvbnRlbnQtVHlwZSc6IE5vbmV9KQoKICAgIGRlZiBnZXRfdXNlcl9saXN0KHNlbGYpOgogICAgICAgIHVzZXJzX3RhYmxlID0gW10KICAgICAgICB0cnk6CiAgICAgICAgICAgIHVzZXJzX3RhYmxlID0gbGlzdChzZWxmLl9fZ2V0X2RldmljZXNfZnJvbV90YWJsZShjb25zdHMuVVNFUlNfVEFCTEUpKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIGdldHRpbmcgdXNlcnMnKQogICAgICAgIHVzZXJzX3RhYmxlX2RpY3QgPSBkaWN0KCkKICAgICAgICBmb3IgdXNlciBpbiB1c2Vyc190YWJsZToKICAgICAgICAgICAgaWYgdXNlci5nZXQoJ3N5c19pZCcpOgogICAgICAgICAgICAgICAgdXNlcnNfdGFibGVfZGljdFt1c2VyLmdldCgnc3lzX2lkJyldID0gdXNlcgogICAgICAgIGZvciB1c2VyIGluIHVzZXJzX3RhYmxlX2RpY3QudmFsdWVzKCk6CiAgICAgICAgICAgIHVzZXJfdG9feWllbGQgPSB1c2VyLmNvcHkoKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiAodXNlci5nZXQoJ21hbmFnZXInKSBvciB7fSkuZ2V0KCd2YWx1ZScpOgogICAgICAgICAgICAgICAgICAgIHVzZXJfdG9feWllbGRbJ21hbmFnZXJfZnVsbCddID0gdXNlcnNfdGFibGVfZGljdC5nZXQodXNlci5nZXQoJ21hbmFnZXInKS5nZXQoJ3ZhbHVlJykpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnUHJvYmxlbSBnZXR0aW5nIG1hbmFnZXIgZm9yIHVzZXIge3VzZXJ9JykKICAgICAgICAgICAgeWllbGQgdXNlcl90b195aWVsZAoKICAgICMgcHlsaW50OiBkaXNhYmxlPXRvby1tYW55LWJyYW5jaGVzLCB0b28tbWFueS1zdGF0ZW1lbnRzLCB0b28tbWFueS1sb2NhbHMsIHRvby1tYW55LW5lc3RlZC1ibG9ja3MKICAgICMgcHlsaW50OiBkaXNhYmxlPWFyZ3VtZW50cy1kaWZmZXIKICAgIGRlZiBnZXRfZGV2aWNlX2xpc3Qoc2VsZiwgZmV0Y2hfdXNlcnNfaW5mb19mb3JfZGV2aWNlcz1GYWxzZSk6CiAgICAgICAgdGFibGVzX2RldmljZXMgPSBbXQogICAgICAgIHVzZXJzX3RhYmxlID0gW10KICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIGZldGNoX3VzZXJzX2luZm9fZm9yX2RldmljZXM6CiAgICAgICAgICAgICAgICB1c2Vyc190YWJsZSA9IGxpc3Qoc2VsZi5fX2dldF9kZXZpY2VzX2Zyb21fdGFibGUoY29uc3RzLlVTRVJTX1RBQkxFKSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHVzZXJzX3RhYmxlID0gW10KICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnUHJvYmxlbSBnZXR0aW5nIHVzZXJzJykKCiAgICAgICAgbG9jYXRpb25fdGFibGUgPSBbXQogICAgICAgIHRyeToKICAgICAgICAgICAgbG9jYXRpb25fdGFibGUgPSBsaXN0KHNlbGYuX19nZXRfZGV2aWNlc19mcm9tX3RhYmxlKGNvbnN0cy5MT0NBVElPTlNfVEFCTEUpKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIGdldHRpbmcgbG9jYXRpb24nKQogICAgICAgIHVzZXJfZ3JvdXBzX3RhYmxlID0gW10KICAgICAgICB0cnk6CiAgICAgICAgICAgIHVzZXJfZ3JvdXBzX3RhYmxlID0gbGlzdChzZWxmLl9fZ2V0X2RldmljZXNfZnJvbV90YWJsZShjb25zdHMuVVNFUl9HUk9VUFNfVEFCTEUpKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIGdldHRpbmcgdXNlcnMgZ3JvdXBzJykKICAgICAgICBuaWNzX3RhYmxlID0gW10KICAgICAgICB0cnk6CiAgICAgICAgICAgIG5pY3NfdGFibGUgPSBsaXN0KHNlbGYuX19nZXRfZGV2aWNlc19mcm9tX3RhYmxlKGNvbnN0cy5OSUNfVEFCTEVfS0VZKSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnUHJvYmxlbSBnZXR0aW5nIG5pY3MnKQoKICAgICAgICBkZXBhcnRtZW50c190YWJsZSA9IFtdCiAgICAgICAgdHJ5OgogICAgICAgICAgICBkZXBhcnRtZW50c190YWJsZSA9IGxpc3Qoc2VsZi5fX2dldF9kZXZpY2VzX2Zyb21fdGFibGUoY29uc3RzLkRFUEFSVE1FTlRTX1RBQkxFKSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnUHJvYmxlbSBnZXR0aW5nIGRlcGFydG1lbnRzJykKICAgICAgICBjb21wYW5pZXNfdGFibGUgPSBbXQogICAgICAgIHRyeToKICAgICAgICAgICAgY29tcGFuaWVzX3RhYmxlID0gbGlzdChzZWxmLl9fZ2V0X2RldmljZXNfZnJvbV90YWJsZShjb25zdHMuQ09NUEFOWV9UQUJMRSkpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbihmJ1Byb2JsZW0gZ2V0dGluZyBjb21wYW5pZXMnKQogICAgICAgIGlwc190YWJsZSA9IFtdCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpcHNfdGFibGUgPSBsaXN0KHNlbGYuX19nZXRfZGV2aWNlc19mcm9tX3RhYmxlKGNvbnN0cy5JUFNfVEFCTEUpKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIGdldHRpbmcgaXBzJykKICAgICAgICB1c2Vyc190YWJsZV9kaWN0ID0gZGljdCgpCiAgICAgICAgdXNlcnNfdXNlcm5hbWVfZGljdCA9IGRpY3QoKQogICAgICAgIGZvciB1c2VyIGluIHVzZXJzX3RhYmxlOgogICAgICAgICAgICBpZiB1c2VyLmdldCgnc3lzX2lkJyk6CiAgICAgICAgICAgICAgICB1c2Vyc190YWJsZV9kaWN0W3VzZXIuZ2V0KCdzeXNfaWQnKV0gPSB1c2VyCiAgICAgICAgICAgICAgICBpZiB1c2VyLmdldCgnbmFtZScpOgogICAgICAgICAgICAgICAgICAgIHVzZXJzX3VzZXJuYW1lX2RpY3RbdXNlci5nZXQoJ3VzZXJfbmFtZScpXSA9IHVzZXIuZ2V0KCdzeXNfaWQnKQoKICAgICAgICBsb2NhdGlvbl90YWJsZV9kaWN0ID0gZGljdCgpCiAgICAgICAgZm9yIGxvY2F0aW9uIGluIGxvY2F0aW9uX3RhYmxlOgogICAgICAgICAgICBpZiBsb2NhdGlvbi5nZXQoJ3N5c19pZCcpOgogICAgICAgICAgICAgICAgbG9jYXRpb25fdGFibGVfZGljdFtsb2NhdGlvbi5nZXQoJ3N5c19pZCcpXSA9IGxvY2F0aW9uCiAgICAgICAgdXNlcl9ncm91cHNfZGljdCA9IGRpY3QoKQogICAgICAgIGZvciB1c2VyX2dyb3VwX3JhdyBpbiB1c2VyX2dyb3Vwc190YWJsZToKICAgICAgICAgICAgaWYgdXNlcl9ncm91cF9yYXcuZ2V0KCdzeXNfaWQnKToKICAgICAgICAgICAgICAgIHVzZXJfZ3JvdXBzX2RpY3RbdXNlcl9ncm91cF9yYXcuZ2V0KCdzeXNfaWQnKV0gPSB1c2VyX2dyb3VwX3JhdwoKICAgICAgICBuaWNfdGFibGVfZGljdCA9IGRpY3QoKQogICAgICAgIHRyeToKICAgICAgICAgICAgZm9yIG5pYyBpbiBuaWNzX3RhYmxlOgogICAgICAgICAgICAgICAgaWYgKG5pYy5nZXQoJ2NtZGJfY2knKSBvciB7fSkuZ2V0KCd2YWx1ZScpOgogICAgICAgICAgICAgICAgICAgIGlmIChuaWMuZ2V0KCdjbWRiX2NpJykgb3Ige30pLmdldCgndmFsdWUnKSBub3QgaW4gbmljX3RhYmxlX2RpY3Q6CiAgICAgICAgICAgICAgICAgICAgICAgIG5pY190YWJsZV9kaWN0WyhuaWMuZ2V0KCdjbWRiX2NpJykgb3Ige30pLmdldCgndmFsdWUnKV0gPSBbXQogICAgICAgICAgICAgICAgICAgIG5pY190YWJsZV9kaWN0WyhuaWMuZ2V0KCdjbWRiX2NpJykgb3Ige30pLmdldCgndmFsdWUnKV0uYXBwZW5kKG5pYykKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnUHJvYmxlbSBidWlsZGluZyBuaWMgZGljdCcpCiAgICAgICAgZGVwYXJ0bWVudF90YWJsZV9kaWN0ID0gZGljdCgpCiAgICAgICAgZm9yIGRlcGFydG1lbnQgaW4gZGVwYXJ0bWVudHNfdGFibGU6CiAgICAgICAgICAgIGlmIGRlcGFydG1lbnQuZ2V0KCdzeXNfaWQnKToKICAgICAgICAgICAgICAgIGRlcGFydG1lbnRfdGFibGVfZGljdFtkZXBhcnRtZW50LmdldCgnc3lzX2lkJyldID0gZGVwYXJ0bWVudAoKICAgICAgICBhbG1fYXNzZXRfdGFibGUgPSBbXQogICAgICAgIHRyeToKICAgICAgICAgICAgYWxtX2Fzc2V0X3RhYmxlID0gbGlzdChzZWxmLl9fZ2V0X2RldmljZXNfZnJvbV90YWJsZShjb25zdHMuQUxNX0FTU0VUX1RBQkxFKSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnUHJvYmxlbSBnZXR0aW5nIGxvY2F0aW9uJykKICAgICAgICBhbG1fYXNzZXRfdGFibGVfZGljdCA9IGRpY3QoKQogICAgICAgIGZvciBhbG1fYXNzZXQgaW4gYWxtX2Fzc2V0X3RhYmxlOgogICAgICAgICAgICBpZiBhbG1fYXNzZXQuZ2V0KCdzeXNfaWQnKToKICAgICAgICAgICAgICAgIGFsbV9hc3NldF90YWJsZV9kaWN0W2FsbV9hc3NldC5nZXQoJ3N5c19pZCcpXSA9IGFsbV9hc3NldAoKICAgICAgICBjb21wYW5pZXNfdGFibGVfZGljdCA9IGRpY3QoKQogICAgICAgIGZvciBjb21wYW55IGluIGNvbXBhbmllc190YWJsZToKICAgICAgICAgICAgaWYgY29tcGFueS5nZXQoJ3N5c19pZCcpOgogICAgICAgICAgICAgICAgY29tcGFuaWVzX3RhYmxlX2RpY3RbY29tcGFueS5nZXQoJ3N5c19pZCcpXSA9IGNvbXBhbnkKCiAgICAgICAgaXBzX3RhYmxlX2RpY3QgPSBkaWN0KCkKICAgICAgICB0cnk6CiAgICAgICAgICAgIGZvciBpcF9kYXRhIGluIGlwc190YWJsZToKICAgICAgICAgICAgICAgIGlmIChpcF9kYXRhLmdldCgndV9jb25maWd1cmF0aW9uX2l0ZW0nKSBvciB7fSkuZ2V0KCd2YWx1ZScpOgogICAgICAgICAgICAgICAgICAgIGlmIChpcF9kYXRhLmdldCgndV9jb25maWd1cmF0aW9uX2l0ZW0nKSBvciB7fSkuZ2V0KCd2YWx1ZScpIG5vdCBpbiBpcHNfdGFibGVfZGljdDoKICAgICAgICAgICAgICAgICAgICAgICAgaXBzX3RhYmxlX2RpY3RbKGlwX2RhdGEuZ2V0KCd1X2NvbmZpZ3VyYXRpb25faXRlbScpIG9yIHt9KS5nZXQoJ3ZhbHVlJyldID0gW10KICAgICAgICAgICAgICAgICAgICBpcHNfdGFibGVfZGljdFsoaXBfZGF0YS5nZXQoJ3VfY29uZmlndXJhdGlvbl9pdGVtJykgb3Ige30pLmdldCgndmFsdWUnKV0uYXBwZW5kKGlwX2RhdGEpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgbG9nZ2VyLmV4Y2VwdGlvbignUHJvYmxlbSBwYXJzaW5nIGlwcyB0YWJsZScpCiAgICAgICAgc2VsZi5fX3VzZXJzX3RhYmxlID0gdXNlcnNfdGFibGVfZGljdAogICAgICAgIGZvciB0YWJsZV9kZXRhaWxzIGluIGNvbnN0cy5UQUJMRVNfREVUQUlMUzoKICAgICAgICAgICAgbmV3X3RhYmxlX2RldGFpbHMgPSB0YWJsZV9kZXRhaWxzLmNvcHkoKQogICAgICAgICAgICB0YWJsZV9kZXZpY2VzID0ge2NvbnN0cy5ERVZJQ0VTX0tFWTogc2VsZi5fX2dldF9kZXZpY2VzX2Zyb21fdGFibGUodGFibGVfZGV0YWlsc1tjb25zdHMuVEFCTEVfTkFNRV9LRVldKX0KICAgICAgICAgICAgbmV3X3RhYmxlX2RldGFpbHMudXBkYXRlKHRhYmxlX2RldmljZXMpCiAgICAgICAgICAgIG5ld190YWJsZV9kZXRhaWxzW2NvbnN0cy5VU0VSU19UQUJMRV9LRVldID0gdXNlcnNfdGFibGVfZGljdAogICAgICAgICAgICBuZXdfdGFibGVfZGV0YWlsc1tjb25zdHMuVVNFUlNfVVNFUk5BTUVfS0VZXSA9IHVzZXJzX3VzZXJuYW1lX2RpY3QKICAgICAgICAgICAgbmV3X3RhYmxlX2RldGFpbHNbY29uc3RzLkxPQ0FUSU9OX1RBQkxFX0tFWV0gPSBsb2NhdGlvbl90YWJsZV9kaWN0CiAgICAgICAgICAgIG5ld190YWJsZV9kZXRhaWxzW2NvbnN0cy5VU0VSX0dST1VQU19UQUJMRV9LRVldID0gdXNlcl9ncm91cHNfZGljdAogICAgICAgICAgICBuZXdfdGFibGVfZGV0YWlsc1tjb25zdHMuTklDX1RBQkxFX0tFWV0gPSBuaWNfdGFibGVfZGljdAogICAgICAgICAgICBuZXdfdGFibGVfZGV0YWlsc1tjb25zdHMuREVQQVJUTUVOVF9UQUJMRV9LRVldID0gZGVwYXJ0bWVudF90YWJsZV9kaWN0CiAgICAgICAgICAgIG5ld190YWJsZV9kZXRhaWxzW2NvbnN0cy5BTE1fQVNTRVRfVEFCTEVdID0gYWxtX2Fzc2V0X3RhYmxlX2RpY3QKICAgICAgICAgICAgbmV3X3RhYmxlX2RldGFpbHNbY29uc3RzLkNPTVBBTllfVEFCTEVdID0gY29tcGFuaWVzX3RhYmxlX2RpY3QKICAgICAgICAgICAgbmV3X3RhYmxlX2RldGFpbHNbY29uc3RzLklQU19UQUJMRV0gPSBpcHNfdGFibGVfZGljdAogICAgICAgICAgICB0YWJsZXNfZGV2aWNlcy5hcHBlbmQobmV3X3RhYmxlX2RldGFpbHMpCgogICAgICAgIHJldHVybiB0YWJsZXNfZGV2aWNlcwoKICAgIGRlZiBfX2dldF9kZXZpY2VzX2Zyb21fdGFibGUoc2VsZiwgdGFibGVfbmFtZSwgbnVtYmVyX29mX29mZnNldHM9Tm9uZSk6CiAgICAgICAgbG9nZ2VyLmluZm8oZidGZXRjaGluZyB0YWJsZSB7dGFibGVfbmFtZX0nKQogICAgICAgIGlmIG5vdCBudW1iZXJfb2Zfb2Zmc2V0czoKICAgICAgICAgICAgbnVtYmVyX29mX29mZnNldHMgPSBzZWxmLl9fbnVtYmVyX29mX29mZnNldHMKICAgICAgICBudW1iZXJfb2ZfZXhjZXB0aW9uID0gMAogICAgICAgIGZvciBzeXNwYXJhbV9vZmZzZXQgaW4gcmFuZ2UoMCwgbnVtYmVyX29mX29mZnNldHMpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0YWJsZV9yZXN1bHRzX3BhZ2VkID0gc2VsZi5fZ2V0KGYndGFibGUve3N0cih0YWJsZV9uYW1lKX0nLCBkb19iYXNpY19hdXRoPVRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybF9wYXJhbXM9eydzeXNwYXJtX2xpbWl0Jzogc2VsZi5fX29mZnNldF9zaXplLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3lzcGFybV9vZmZzZXQnOiBzeXNwYXJhbV9vZmZzZXQgKiBzZWxmLl9fb2Zmc2V0X3NpemV9KQogICAgICAgICAgICAgICAgaWYgbGVuKHRhYmxlX3Jlc3VsdHNfcGFnZWQuZ2V0KCdyZXN1bHQnLCBbXSkpID09IDA6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGlmIHN5c3BhcmFtX29mZnNldCAlIDIwID09IDA6CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZidHb3QgdG8gb2ZmZnNldCB7c3lzcGFyYW1fb2Zmc2V0fScpCiAgICAgICAgICAgICAgICB5aWVsZCBmcm9tIHRhYmxlX3Jlc3VsdHNfcGFnZWQuZ2V0KCdyZXN1bHQnLCBbXSkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidHb3QgZXhjZXB0aW9uIGluIG9mZnNldCB7c3lzcGFyYW1fb2Zmc2V0fSB3aXRoIHRhYmxlIHt0YWJsZV9uYW1lfScpCiAgICAgICAgICAgICAgICBudW1iZXJfb2ZfZXhjZXB0aW9uICs9IDEKICAgICAgICAgICAgICAgIGlmIG51bWJlcl9vZl9leGNlcHRpb24gPj0gMzoKICAgICAgICAgICAgICAgICAgICBicmVhawoKICAgIGRlZiBfX2FkZF9kaWN0X3RvX3RhYmxlKHNlbGYsIHRhYmxlX25hbWUsIGRpY3RfZGF0YSk6CiAgICAgICAgcmV0dXJuIHNlbGYuX3Bvc3QoZid0YWJsZS97c3RyKHRhYmxlX25hbWUpfScsIGJvZHlfcGFyYW1zPWRpY3RfZGF0YSkKCiAgICBkZWYgY3JlYXRlX3NlcnZpY2Vfbm93X2luY2lkZW50KHNlbGYsIHNlcnZpY2Vfbm93X2RpY3QpOgogICAgICAgIGltcGFjdCA9IHNlcnZpY2Vfbm93X2RpY3QuZ2V0KCdpbXBhY3QnLCByZXBvcnRfY29uc3RzLlNFUlZJQ0VfTk9XX1NFVkVSSVRZWydlcnJvciddKQogICAgICAgIHNob3J0X2Rlc2NyaXB0aW9uID0gc2VydmljZV9ub3dfZGljdC5nZXQoJ3Nob3J0X2Rlc2NyaXB0aW9uJywgJycpCiAgICAgICAgZGVzY3JpcHRpb24gPSBzZXJ2aWNlX25vd19kaWN0LmdldCgnZGVzY3JpcHRpb24nLCAnJykKICAgICAgICB1X2luY2lkZW50X3R5cGUgPSBzZXJ2aWNlX25vd19kaWN0LmdldCgndV9pbmNpZGVudF90eXBlJykKICAgICAgICB1X3JlcXVlc3RlZF9mb3IgPSBzZXJ2aWNlX25vd19kaWN0LmdldCgndV9yZXF1ZXN0ZWRfZm9yJykKICAgICAgICBhc3NpZ25tZW50X2dyb3VwID0gc2VydmljZV9ub3dfZGljdC5nZXQoJ2Fzc2lnbm1lbnRfZ3JvdXAnKQogICAgICAgIHVfc3ltcHRvbSA9IHNlcnZpY2Vfbm93X2RpY3QuZ2V0KCd1X3N5bXB0b20nKQogICAgICAgIGNtZGJfY2kgPSBzZXJ2aWNlX25vd19kaWN0LmdldCgnY21kYl9jaScpCiAgICAgICAgY2FsbGVyX2lkID0gc2VydmljZV9ub3dfZGljdC5nZXQoJ2NhbGxlcl9pZCcpCiAgICAgICAgY2F0ZWdvcnkgPSBzZXJ2aWNlX25vd19kaWN0LmdldCgnY2F0ZWdvcnknKQogICAgICAgIHN1YmNhdGVnb3J5ID0gc2VydmljZV9ub3dfZGljdC5nZXQoJ3N1YmNhdGVnb3J5JykKICAgICAgICBjc3Zfc3RyaW5nID0gc2VydmljZV9ub3dfZGljdC5nZXQoJ2Nzdl9zdHJpbmcnKQoKICAgICAgICBzZWxmLl9fbnVtYmVyX29mX2luY2lkZW50cyArPSAxCiAgICAgICAgbG9nZ2VyLmluZm8oZidDcmVhdGluZyBzZXJ2aWNlbm93IGluY2lkZW50IG51bSB7c2VsZi5fX251bWJlcl9vZl9pbmNpZGVudHN9OiBpbXBhY3Q9e2ltcGFjdH0sICcKICAgICAgICAgICAgICAgICAgICBmJ3Nob3J0X2Rlc2NyaXB0aW9uPXtzaG9ydF9kZXNjcmlwdGlvbn0sIGRlc2NyaXB0aW9uPXtkZXNjcmlwdGlvbn0nKQogICAgICAgIHRyeToKICAgICAgICAgICAgZmluYWxfZGljdCA9IHsnaW1wYWN0JzogaW1wYWN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICd1cmdlbmN5JzogaW1wYWN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICdzaG9ydF9kZXNjcmlwdGlvbic6IHNob3J0X2Rlc2NyaXB0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICdkZXNjcmlwdGlvbic6IGRlc2NyaXB0aW9ufQogICAgICAgICAgICBpZiB1X2luY2lkZW50X3R5cGU6CiAgICAgICAgICAgICAgICBmaW5hbF9kaWN0Wyd1X2luY2lkZW50X3R5cGUnXSA9IHVfaW5jaWRlbnRfdHlwZQogICAgICAgICAgICBpZiB1X3JlcXVlc3RlZF9mb3I6CiAgICAgICAgICAgICAgICBmaW5hbF9kaWN0Wyd1X3JlcXVlc3RlZF9mb3InXSA9IHVfcmVxdWVzdGVkX2ZvcgogICAgICAgICAgICBpZiBhc3NpZ25tZW50X2dyb3VwOgogICAgICAgICAgICAgICAgZmluYWxfZGljdFsnYXNzaWdubWVudF9ncm91cCddID0gYXNzaWdubWVudF9ncm91cAogICAgICAgICAgICBpZiB1X3N5bXB0b206CiAgICAgICAgICAgICAgICBmaW5hbF9kaWN0Wyd1X3N5bXB0b20nXSA9IHVfc3ltcHRvbQogICAgICAgICAgICBpZiBjbWRiX2NpOgogICAgICAgICAgICAgICAgZmluYWxfZGljdFsnY21kYl9jaSddID0gY21kYl9jaQogICAgICAgICAgICBpZiBjYWxsZXJfaWQ6CiAgICAgICAgICAgICAgICBmaW5hbF9kaWN0WydjYWxsZXJfaWQnXSA9IGNhbGxlcl9pZAogICAgICAgICAgICBpZiBjYXRlZ29yeToKICAgICAgICAgICAgICAgIGZpbmFsX2RpY3RbJ2NhdGVnb3J5J10gPSBjYXRlZ29yeQogICAgICAgICAgICBpZiBzdWJjYXRlZ29yeToKICAgICAgICAgICAgICAgIGZpbmFsX2RpY3RbJ3N1YmNhdGVnb3J5J10gPSBzdWJjYXRlZ29yeQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBleHRyYV9maWVsZHMgPSBzZXJ2aWNlX25vd19kaWN0LmdldCgnZXh0cmFfZmllbGRzJykKICAgICAgICAgICAgICAgIGlmIGV4dHJhX2ZpZWxkczoKICAgICAgICAgICAgICAgICAgICBleHRyYV9maWVsZHNfZGljdCA9IGpzb24ubG9hZHMoZXh0cmFfZmllbGRzKQogICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoZXh0cmFfZmllbGRzX2RpY3QsIGRpY3QpOgogICAgICAgICAgICAgICAgICAgICAgICBmaW5hbF9kaWN0LnVwZGF0ZShleHRyYV9maWVsZHNfZGljdCkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidQcm9ibGVtIGdldHRpbmcgZXh0cmEgZmllbGRzJykKICAgICAgICAgICAgaW5jaWRlbnRfdmFsdWUgPSBzZWxmLl9fYWRkX2RpY3RfdG9fdGFibGUoJ2luY2lkZW50JywgZmluYWxfZGljdCkKICAgICAgICAgICAgaWYgY3N2X3N0cmluZyBhbmQgKGluY2lkZW50X3ZhbHVlLmdldCgncmVzdWx0Jykgb3Ige30pLmdldCgnc3lzX2lkJyk6CiAgICAgICAgICAgICAgICBzZWxmLl91cGxvYWRfY3N2X3RvX3RhYmxlKHRhYmxlX25hbWU9J2luY2lkZW50JywgdGFibGVfc3lzX2lkPWluY2lkZW50X3ZhbHVlWydyZXN1bHQnXVsnc3lzX2lkJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNzdl9zdHJpbmc9Y3N2X3N0cmluZykKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICBsb2dnZXIuZXhjZXB0aW9uKGYnRXhjZXB0aW9uIHdoaWxlIGNyZWF0aW5nIGluY2lkZW50IGZvciBudW0ge3NlbGYuX19udW1iZXJfb2ZfaW5jaWRlbnRzfScpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBjcmVhdGVfc2VydmljZV9ub3dfY29tcHV0ZXIoc2VsZiwgY29ubmVjdGlvbl9kaWN0KToKICAgICAgICBjbWRiX2NpX3RhYmxlID0gY29ubmVjdGlvbl9kaWN0LmdldCgnY21kYl9jaV90YWJsZScpIG9yICdjbWRiX2NpX2NvbXB1dGVyJwogICAgICAgIHNlbGYuX19udW1iZXJfb2ZfbmV3X2NvbXB1dGVycyArPSAxCiAgICAgICAgbG9nZ2VyLmluZm8oZidDcmVhdGluZyBzZXJ2aWNlIG5vdyBjb21wdXRlciBudW0ge3NlbGYuX19udW1iZXJfb2ZfbmV3X2NvbXB1dGVyc30nKQogICAgICAgIHRyeToKICAgICAgICAgICAgZGV2aWNlX3JhdyA9IHNlbGYuX19hZGRfZGljdF90b190YWJsZShjbWRiX2NpX3RhYmxlLCBjb25uZWN0aW9uX2RpY3QpWydyZXN1bHQnXQogICAgICAgICAgICByZXR1cm4gVHJ1ZSwgZGV2aWNlX3JhdwogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIGxvZ2dlci5leGNlcHRpb24oZidFeGNlcHRpb24gd2hpbGUgY3JlYXRpbmcgaW5jaWRlbnQgZm9yICcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmJ251bSB7c2VsZi5fX251bWJlcl9vZl9uZXdfY29tcHV0ZXJzfSB3aXRoIGNvbm5lY3Rpb24gZGljdCB7Y29ubmVjdGlvbl9kaWN0fScpCiAgICAgICAgICAgIHJldHVybiBGYWxzZSwgTm9uZQo=',
    f'{CORTEX}/axonius-libs/src/libs/axonius-py/axonius/clients/service_now/consts.py': b'VEFCTEVfTkFNRV9LRVkgPSAndGFibGVfbmFtZScKREVWSUNFX1RZUEVfTkFNRV9LRVkgPSAnZGV2aWNlX3R5cGVfbmFtZScKREVWSUNFU19LRVkgPSAnZGV2aWNlcycKVEFCTEVTX0RFVEFJTFMgPSBbe1RBQkxFX05BTUVfS0VZOiAnY21kYl9jaV9jb21wdXRlcicsIERFVklDRV9UWVBFX05BTUVfS0VZOiAnQ29tcHV0ZXInfSwKICAgICAgICAgICAgICAgICAge1RBQkxFX05BTUVfS0VZOiAnY21kYl9jaV92bScsIERFVklDRV9UWVBFX05BTUVfS0VZOiAnVmlydHVhbCBNYWNoaW5lJ30sCiAgICAgICAgICAgICAgICAgIHtUQUJMRV9OQU1FX0tFWTogJ2NtZGJfY2lfdm1faW5zdGFuY2UnLCBERVZJQ0VfVFlQRV9OQU1FX0tFWTogJ1ZDZW50ZXIgVmlydHVhbCBNYWNoaW5lJ30sCiAgICAgICAgICAgICAgICAgIHtUQUJMRV9OQU1FX0tFWTogJ2NtZGJfY2lfcHJpbnRlcicsIERFVklDRV9UWVBFX05BTUVfS0VZOiAnUHJpbnRlcid9LAogICAgICAgICAgICAgICAgICB7VEFCTEVfTkFNRV9LRVk6ICdjbWRiX2NpX25ldGdlYXInLCBERVZJQ0VfVFlQRV9OQU1FX0tFWTogJ05ldHdvcmsgRGV2aWNlJ31dCk5VTUJFUl9PRl9PRkZTRVRTID0gMTAwMDAwCk9GRlNFVF9TSVpFID0gMjAwClVTRVJTX1RBQkxFID0gJ3N5c191c2VyJwpMT0NBVElPTlNfVEFCTEUgPSAnY21uX2xvY2F0aW9uJwpVU0VSX0dST1VQU19UQUJMRSA9ICdzeXNfdXNlcl9ncm91cCcKREVQQVJUTUVOVFNfVEFCTEUgPSAnY21uX2RlcGFydG1lbnQnClVTRVJTX1RBQkxFX0tFWSA9ICd1c2Vyc190YWJsZScKVVNFUlNfVVNFUk5BTUVfS0VZID0gJ3VzZXJzX3VzZXJuYW1lX2tleScKTklDX1RBQkxFX0tFWSA9ICdjbWRiX2NpX25ldHdvcmtfYWRhcHRlcicKREVQQVJUTUVOVF9UQUJMRV9LRVkgPSAnZGVwYXJ0bWVudF90YWJsZScKTE9DQVRJT05fVEFCTEVfS0VZID0gJ2xvY2F0aW9uX3RhYmxlJwpVU0VSX0dST1VQU19UQUJMRV9LRVkgPSAndXNlcl9ncm91cHNfdGFibGUnCkFMTV9BU1NFVF9UQUJMRSA9ICdhbG1faGFyZHdhcmUnCkNPTVBBTllfVEFCTEUgPSAnY29yZV9jb21wYW55JwpJUFNfVEFCTEUgPSAndV9pcF9hZGRyZXNzJwojIHB5bGludDogZGlzYWJsZT1DMDEwMwpJTlNUQUxMX1NUQVRVU19ESUNUID0geycwJzogJ1JldGlyZWQnLAogICAgICAgICAgICAgICAgICAgICAgICcxJzogJ0RlcGxveWVkJywKICAgICAgICAgICAgICAgICAgICAgICAnMTAnOiAnQ29uc3VtZWQnLAogICAgICAgICAgICAgICAgICAgICAgICcyJzogJ09uIE9yZGVyJywKICAgICAgICAgICAgICAgICAgICAgICAnMyc6ICdBdCBEZXBvdCcsCiAgICAgICAgICAgICAgICAgICAgICAgJzYnOiAnSW4gU3RvY2snLAogICAgICAgICAgICAgICAgICAgICAgICc3JzogJ0Rpc3Bvc2VkJywKICAgICAgICAgICAgICAgICAgICAgICAnOCc6ICdNaXNzaW5nJywKICAgICAgICAgICAgICAgICAgICAgICAnOSc6ICdJbiBUcmFuc2l0JywKICAgICAgICAgICAgICAgICAgICAgICAnNDAnOiAnRGVjb21taXNzaW9uZWQnLAogICAgICAgICAgICAgICAgICAgICAgICcxMDAnOiAnQWJzZW50JywKICAgICAgICAgICAgICAgICAgICAgICAnMjAnOiAnSW4gQnVpbGQnLAogICAgICAgICAgICAgICAgICAgICAgICczMCc6ICdJbiBVc2UnLAogICAgICAgICAgICAgICAgICAgICAgICc0JzogJ1BlbmRpbmcgSW5zdGFsbCcsCiAgICAgICAgICAgICAgICAgICAgICAgJzUnOiAnUGVuZGluZyBSZXBhaXInLAogICAgICAgICAgICAgICAgICAgICAgICc1MCc6ICdSZW1vdmVkJywKICAgICAgICAgICAgICAgICAgICAgICAnNjAnOiAnQWJzZW50J30K',
}


def main():
    print(f'Updating Service Now to e3b07d996d5a612417137f405b6f9f8650b5c310')

    # assert current client
    node_id = core_service.CoreService().node_id
    print(f'Current client: {node_id}')

    # 1. Backup original
    try:
        for path_to_update in FILES_TO_UPDATE.keys():
            bak_path = f'{path_to_update}.bak'
            if os.path.exists(bak_path):
                os.unlink(bak_path)

        for path_to_update in FILES_TO_UPDATE.keys():
            os.rename(path_to_update, f'{path_to_update}.bak')
    except Exception:
        pass

    # 2. write new files
    for path_to_update, b64_contents in FILES_TO_UPDATE.items():
        with open(path_to_update, 'wb') as f:
            f.write(base64.b64decode(b64_contents))

    # 3. Restart adapter
    for i in range(5):
        try:
            subprocess.check_call('./se.sh re service_now',
                                  shell=True, cwd=CORTEX)
            print(f'se.sh succeeded on trial {i}')
            break
        except Exception:
            print(f'Failed se.sh re on trial {i}')
            time.sleep(5)

    print(f'Done!')
    return 0


if __name__ == '__main__':
    sys.exit(main())
