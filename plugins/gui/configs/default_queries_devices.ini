# ::format::
# [name]
# query = filter

[AD Devices]
query = adapters=="active_directory_adapter"

[Disabled AD Devices]
query = adapters_data.active_directory_adapter.device_disabled == true

[Enabled AD Devices]
query = adapters_data.active_directory_adapter.device_disabled == false

[Enabled AD Devices With Password That Never Expires]
query = adapters_data.active_directory_adapter.device_disabled == false and adapters_data.active_directory_adapter.ad_uac_dont_expire_password == true

[AD Devices Last Seen In Past 7 Days]
query = adapters_data.active_directory_adapter.last_seen >= date("NOW - 7d")

[AD Enabled Devices Who Are Unconstrained Delegation]
query = adapters_data.active_directory_adapter.device_disabled == false and adapters_data.active_directory_adapter.ad_delegation_policy == "Trust For Delegation To Any Service"

[AD Enabled Devices Who Are Trusted Delegation]
query = adapters_data.active_directory_adapter.device_disabled == false and adapters_data.active_directory_adapter.ad_delegation_policy == "Trust For Delegation To Specified Services"

[AD Enabled Devices Who Are Not Trusted For Delegation]
query = adapters_data.active_directory_adapter.device_disabled == false and adapters_data.active_directory_adapter.ad_delegation_policy == "Do Not Trust For Delegation"

[AD Enabled NPS Servers]
query = adapters_data.active_directory_adapter.device_disabled == false and adapters_data.active_directory_adapter.ad_dc_is_nps_server == true

[AD Enabled DHCP Servers]
query = adapters_data.active_directory_adapter.device_disabled == false and adapters_data.active_directory_adapter.ad_dc_is_dhcp_server == true

[AD Enabled Devices With Bad Configurations]
query = (adapters_data.active_directory_adapter.device_disabled == false and adapters_data.active_directory_adapter.ad_delegation_policy == "Trust For Delegation To Any Service" and adapters_data.active_directory_adapter.ad_is_dc == false) or (adapters_data.active_directory_adapter.device_disabled == false and adapters_data.active_directory_adapter.ad_uac_dont_expire_password == true)

[AD Enabled Critical Assets]
query = adapters_data.active_directory_adapter.device_disabled == false and (adapters_data.active_directory_adapter.ad_is_dc == true or adapters_data.active_directory_adapter.ad_is_exchange_server == true or adapters_data.active_directory_adapter.ad_dc_is_dhcp_server == true)

[End of Life Windows Devices]
query = (specific_data.data.os.type == "Windows" and specific_data.data.os.major < 6) or (specific_data.data.os.type == "Windows" and specific_data.data.os.major == 6 and specific_data.data.os.minor == 0)
